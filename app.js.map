{
  "version": 3,
  "sources": ["../bin/live-reload.js", "../src/modules/config.ts", "../src/modules/eventBus.ts", "../src/modules/stateManager.ts", "../src/modules/state.ts", "../src/modules/popups-part2.ts", "../src/modules/popups.ts", "../src/app.ts", "../src/modules/boundaryUtils.ts", "../src/modules/dataLoader.ts", "../src/modules/filters.ts", "../src/modules/localStorage.ts", "../src/modules/geolocation.ts", "../src/modules/mapInit.ts", "../src/modules/mapInteractions.ts", "../src/modules/markers.ts", "../src/modules/resourceManager.ts", "../src/modules/poi.ts", "../src/modules/threejs.ts", "../src/modules/toggle3D.ts", "../src/modules/tour.ts"],
  "sourcesContent": ["new EventSource(`${SERVE_ORIGIN}/esbuild`).addEventListener('change', () => location.reload());\r\n", "// Configuration and constants for the Heerlen Interactive Map\r\n\r\nimport type { MapboxOptions } from 'mapbox-gl';\r\n\r\n// Configuration object\r\nexport const CONFIG = {\r\n  MAP: {\r\n    // Woonboulevard Center (eind positie animatie)\r\n    center: [5.949252153400742, 50.89631881636659] as [number, number],\r\n    // Heerlen Centrum: [5.979642, 50.887634]\r\n    zoom: 15.5,\r\n    pitch: 45,\r\n    bearing: -17.6,\r\n    boundary: {\r\n      // Woonboulevard Boundary Center\r\n      center: [5.945293248082578, 50.89864658643648] as [number, number],\r\n      // Heerlen Centrum: [5.977105864037915, 50.88774161029858]\r\n      radius: 1, // 1 km radius\r\n    },\r\n  },\r\n  MARKER_ZOOM: {\r\n    min: 10,\r\n    small: 14,\r\n    medium: 16,\r\n    large: 18,\r\n  },\r\n  ANIMATION: {\r\n    speed: 0.8,\r\n    duration: 2000,\r\n  },\r\n};\r\n\r\n// Mapbox access token\r\nexport const MAPBOX_ACCESS_TOKEN: string =\r\n  'pk.eyJ1IjoicHJvamVjdGhlZXJsZW4iLCJhIjoiY2x4eWVmcXBvMWozZTJpc2FqbWgzcnAyeCJ9.SVOVbBG6o1lHs6TwCudR9g';\r\n\r\n// Map style\r\nexport const MAP_STYLE: string = 'mapbox://styles/projectheerlen/cmi7ahq4700cv01se4sgxfh6p';\r\n\r\n// Local storage key\r\nexport const LOCAL_STORAGE_KEY: string = 'heerlenActiveFilters';\r\n\r\n// Map options\r\nexport const MAP_OPTIONS: MapboxOptions = {\r\n  container: 'map',\r\n  style: MAP_STYLE,\r\n  center: CONFIG.MAP.center,\r\n  zoom: CONFIG.MAP.zoom,\r\n  pitch: CONFIG.MAP.pitch,\r\n  bearing: CONFIG.MAP.bearing,\r\n  antialias: true,\r\n  interactive: true,\r\n  renderWorldCopies: false,\r\n  preserveDrawingBuffer: false,\r\n  maxParallelImageRequests: 16,\r\n  fadeDuration: 0,\r\n};\r\n", "// Event bus for decoupled communication between modules\r\n\r\ntype EventHandler = (data?: any) => void;\r\n\r\n/**\r\n * Simple event bus for decoupled module communication\r\n */\r\nclass EventBus {\r\n  private static instance: EventBus;\r\n  private listeners = new Map<string, Set<EventHandler>>();\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): EventBus {\r\n    if (!EventBus.instance) {\r\n      EventBus.instance = new EventBus();\r\n    }\r\n    return EventBus.instance;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to an event\r\n   */\r\n  on(event: string, handler: EventHandler): () => void {\r\n    if (!this.listeners.has(event)) {\r\n      this.listeners.set(event, new Set());\r\n    }\r\n    \r\n    this.listeners.get(event)!.add(handler);\r\n    \r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.listeners.get(event)?.delete(handler);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Subscribe to an event that will only fire once\r\n   */\r\n  once(event: string, handler: EventHandler): () => void {\r\n    const wrappedHandler = (data?: any) => {\r\n      handler(data);\r\n      this.off(event, wrappedHandler);\r\n    };\r\n    \r\n    return this.on(event, wrappedHandler);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from an event\r\n   */\r\n  off(event: string, handler: EventHandler): void {\r\n    this.listeners.get(event)?.delete(handler);\r\n  }\r\n\r\n  /**\r\n   * Emit an event to all subscribers\r\n   */\r\n  emit(event: string, data?: any): void {\r\n    const handlers = this.listeners.get(event);\r\n    if (handlers) {\r\n      handlers.forEach(handler => {\r\n        try {\r\n          handler(data);\r\n        } catch (error) {\r\n          // Continue with other handlers even if one fails\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the number of listeners for an event\r\n   */\r\n  listenerCount(event: string): number {\r\n    return this.listeners.get(event)?.size || 0;\r\n  }\r\n\r\n  /**\r\n   * Remove all listeners for a specific event\r\n   */\r\n  removeAllListeners(event?: string): void {\r\n    if (event) {\r\n      this.listeners.delete(event);\r\n    } else {\r\n      this.listeners.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all event names that have listeners\r\n   */\r\n  eventNames(): string[] {\r\n    return Array.from(this.listeners.keys());\r\n  }\r\n\r\n  /**\r\n   * Clean up all listeners - useful for preventing memory leaks\r\n   */\r\n  cleanup(): void {\r\n    this.listeners.clear();\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const eventBus = EventBus.getInstance();\r\n\r\n// Common event constants to prevent typos\r\nexport const Events = {\r\n  // Map events\r\n  MAP_LOADED: 'map:loaded',\r\n  MAP_STYLE_CHANGED: 'map:styleChanged',\r\n  \r\n  // Popup events\r\n  POPUP_OPENED: 'popup:opened',\r\n  POPUP_CLOSED: 'popup:closed',\r\n  POPUP_FLIPPED: 'popup:flipped',\r\n  \r\n  // Filter events\r\n  FILTER_CHANGED: 'filter:changed',\r\n  FILTER_CLEARED: 'filter:cleared',\r\n  \r\n  // Marker events\r\n  MARKER_CLICKED: 'marker:clicked',\r\n  MARKER_HOVERED: 'marker:hovered',\r\n  \r\n  // Tour events\r\n  TOUR_STARTED: 'tour:started',\r\n  TOUR_ENDED: 'tour:ended',\r\n  TOUR_STEP_CHANGED: 'tour:stepChanged',\r\n  \r\n  // Geolocation events\r\n  LOCATION_FOUND: 'location:found',\r\n  LOCATION_ERROR: 'location:error',\r\n  BOUNDARY_ENTERED: 'location:boundaryEntered',\r\n  BOUNDARY_EXITED: 'location:boundaryExited',\r\n  \r\n  // Performance events\r\n  PERFORMANCE_WARNING: 'performance:warning',\r\n  RESOURCE_LOADED: 'resource:loaded',\r\n  RESOURCE_ERROR: 'resource:error',\r\n} as const;", "// Centralized state management with event-driven updates\r\n\r\nimport type { Map, Popup } from 'mapbox-gl';\r\nimport type { FeatureCollection } from 'geojson';\r\nimport { eventBus, Events } from './eventBus.js';\r\n\r\ninterface AppState {\r\n  // Map state\r\n  map: Map | null;\r\n  mapLoaded: boolean;\r\n  \r\n  // Popup state\r\n  activePopup: Popup | null;\r\n  \r\n  // Marker state\r\n  markersAdded: boolean;\r\n  modelsAdded: boolean;\r\n  mapLocations: FeatureCollection;\r\n  \r\n  // Filter state\r\n  activeFilters: Set<string>;\r\n}\r\n\r\n/**\r\n * Centralized state manager with reactive updates\r\n */\r\nclass StateManager {\r\n  private static instance: StateManager;\r\n  private state: AppState;\r\n  private subscribers = new Set<(state: AppState) => void>();\r\n\r\n  private constructor() {\r\n    this.state = {\r\n      map: null,\r\n      mapLoaded: false,\r\n      activePopup: null,\r\n      markersAdded: false,\r\n      modelsAdded: false,\r\n      mapLocations: {\r\n        type: 'FeatureCollection',\r\n        features: [],\r\n      },\r\n      activeFilters: new Set(),\r\n    };\r\n  }\r\n\r\n  static getInstance(): StateManager {\r\n    if (!StateManager.instance) {\r\n      StateManager.instance = new StateManager();\r\n    }\r\n    return StateManager.instance;\r\n  }\r\n\r\n  /**\r\n   * Get current state (readonly)\r\n   */\r\n  getState(): Readonly<AppState> {\r\n    return { ...this.state };\r\n  }\r\n\r\n  /**\r\n   * Subscribe to state changes\r\n   */\r\n  subscribe(callback: (state: AppState) => void): () => void {\r\n    this.subscribers.add(callback);\r\n    \r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.subscribers.delete(callback);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update state and notify subscribers\r\n   */\r\n  private setState(updates: Partial<AppState>): void {\r\n    const previousState = { ...this.state };\r\n    \r\n    // Apply updates\r\n    Object.assign(this.state, updates);\r\n    \r\n    // Notify subscribers\r\n    this.subscribers.forEach(callback => {\r\n      try {\r\n        callback(this.state);\r\n      } catch (error) {\r\n        // Continue with other subscribers even if one fails\r\n      }\r\n    });\r\n\r\n    // Emit relevant events\r\n    this.emitStateChangeEvents(previousState, this.state);\r\n  }\r\n\r\n  /**\r\n   * Emit events based on state changes\r\n   */\r\n  private emitStateChangeEvents(previous: AppState, current: AppState): void {\r\n    // Map events\r\n    if (!previous.mapLoaded && current.mapLoaded) {\r\n      eventBus.emit(Events.MAP_LOADED, current.map);\r\n    }\r\n\r\n    // Popup events\r\n    if (previous.activePopup !== current.activePopup) {\r\n      if (current.activePopup) {\r\n        eventBus.emit(Events.POPUP_OPENED, current.activePopup);\r\n      } else if (previous.activePopup) {\r\n        eventBus.emit(Events.POPUP_CLOSED, previous.activePopup);\r\n      }\r\n    }\r\n\r\n    // Filter events\r\n    if (previous.activeFilters !== current.activeFilters) {\r\n      eventBus.emit(Events.FILTER_CHANGED, Array.from(current.activeFilters));\r\n    }\r\n  }\r\n\r\n  // Public state update methods\r\n  setMap(map: Map): void {\r\n    this.setState({ map });\r\n  }\r\n\r\n  setMapLoaded(loaded: boolean): void {\r\n    this.setState({ mapLoaded: loaded });\r\n  }\r\n\r\n  setActivePopup(popup: Popup | null): void {\r\n    this.setState({ activePopup: popup });\r\n  }\r\n\r\n  setMarkersAdded(added: boolean): void {\r\n    this.setState({ markersAdded: added });\r\n  }\r\n\r\n  setModelsAdded(added: boolean): void {\r\n    this.setState({ modelsAdded: added });\r\n  }\r\n\r\n  updateMapLocations(locations: FeatureCollection): void {\r\n    this.setState({ mapLocations: locations });\r\n  }\r\n\r\n  setActiveFilters(filters: Set<string>): void {\r\n    this.setState({ activeFilters: new Set(filters) });\r\n  }\r\n\r\n  addFilter(filter: string): void {\r\n    const newFilters = new Set(this.state.activeFilters);\r\n    newFilters.add(filter);\r\n    this.setState({ activeFilters: newFilters });\r\n  }\r\n\r\n  removeFilter(filter: string): void {\r\n    const newFilters = new Set(this.state.activeFilters);\r\n    newFilters.delete(filter);\r\n    this.setState({ activeFilters: newFilters });\r\n  }\r\n\r\n  clearFilters(): void {\r\n    this.setState({ activeFilters: new Set() });\r\n  }\r\n\r\n  /**\r\n   * Reset state to initial values\r\n   */\r\n  reset(): void {\r\n    this.state = {\r\n      map: null,\r\n      mapLoaded: false,\r\n      activePopup: null,\r\n      markersAdded: false,\r\n      modelsAdded: false,\r\n      mapLocations: {\r\n        type: 'FeatureCollection',\r\n        features: [],\r\n      },\r\n      activeFilters: new Set(),\r\n    };\r\n    \r\n    // Notify subscribers of reset\r\n    this.subscribers.forEach(callback => {\r\n      try {\r\n        callback(this.state);\r\n      } catch (error) {\r\n        // Continue with other subscribers\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clean up all subscribers\r\n   */\r\n  cleanup(): void {\r\n    this.subscribers.clear();\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const stateManager = StateManager.getInstance();\r\n\r\n// Export legacy compatibility functions\r\nexport const state = stateManager.getState();\r\n\r\nexport function setActivePopup(popup: Popup | null): void {\r\n  stateManager.setActivePopup(popup);\r\n}\r\n\r\nexport function setActiveFilters(filters: Set<string>): void {\r\n  stateManager.setActiveFilters(filters);\r\n}", "// Legacy state module - now uses centralized state manager for better performance\r\n\r\n// Re-export from the new state manager for backward compatibility\r\nexport { stateManager, setActivePopup, setActiveFilters } from './stateManager.js';\r\n\r\n// Import the new state manager\r\nimport { stateManager } from './stateManager.js';\r\n\r\n// Simple state getter that returns current state - SIMPLIFIED for reliability\r\nexport const state = {\r\n  get map() { return stateManager.getState().map; },\r\n  get activePopup() { return stateManager.getState().activePopup; },\r\n  get markersAdded() { return stateManager.getState().markersAdded; },\r\n  get modelsAdded() { return stateManager.getState().modelsAdded; },\r\n  get mapLocations() { return stateManager.getState().mapLocations; },\r\n  get activeFilters() { return stateManager.getState().activeFilters; },\r\n  \r\n  // Allow direct setting for compatibility\r\n  set map(value: any) { stateManager.setMap(value); },\r\n  set activePopup(value: any) { stateManager.setActivePopup(value); },\r\n  set markersAdded(value: boolean) { stateManager.setMarkersAdded(value); },\r\n  set modelsAdded(value: boolean) { stateManager.setModelsAdded(value); },\r\n  set mapLocations(value: any) { stateManager.updateMapLocations(value); },\r\n  set activeFilters(value: Set<string>) { stateManager.setActiveFilters(value); }\r\n};\r\n\r\n// Legacy compatibility functions\r\nexport function setMarkersAdded(value: boolean): void {\r\n  stateManager.setMarkersAdded(value);\r\n}\r\n\r\nexport function setModelsAdded(value: boolean): void {\r\n  stateManager.setModelsAdded(value);\r\n}\r\n\r\nexport function setMap(map: any): void {\r\n  stateManager.setMap(map);\r\n}\r\n\r\nexport function getActiveFilters(): Set<string> {\r\n  return stateManager.getState().activeFilters;\r\n}", "// Popup management module - Part 2\r\n// This contains the remaining functions from the original popup.js\r\n\r\nimport type { Map, Popup } from 'mapbox-gl';\r\n\r\nimport { setActivePopup, state } from './state.js';\r\n\r\n// Language detection function\r\nfunction detectLanguage(): 'nl' | 'en' | 'de' {\r\n  const path = window.location.pathname;\r\n  if (path.includes('/en/')) return 'en';\r\n  if (path.includes('/de/')) return 'de';\r\n  return 'nl'; // Default to Dutch\r\n}\r\n\r\n// Popup translations (subset needed for this module)\r\nconst popupTranslations = {\r\n  nl: {\r\n    buttons: {\r\n      back: 'Terug'\r\n    },\r\n    aria: {\r\n      closePopup: 'Sluit popup'\r\n    },\r\n    navigation: {\r\n      confirmTitle: 'Navigeer met Google Maps',\r\n      confirmMessage: 'Je wordt doorgestuurd naar Google Maps. Wil je doorgaan?',\r\n      confirmYes: 'Ja, navigeer',\r\n      confirmNo: 'Blijf hier',\r\n    }\r\n  },\r\n  en: {\r\n    buttons: {\r\n      back: 'Back'\r\n    },\r\n    aria: {\r\n      closePopup: 'Close popup'\r\n    },\r\n    navigation: {\r\n      confirmTitle: 'Navigate with Google Maps',\r\n      confirmMessage: 'You will be redirected to Google Maps. Do you want to continue?',\r\n      confirmYes: 'Yes, navigate',\r\n      confirmNo: 'Stay here',\r\n    }\r\n  },\r\n  de: {\r\n    buttons: {\r\n      back: 'Zur\u00FCck'\r\n    },\r\n    aria: {\r\n      closePopup: 'Popup schlie\u00DFen'\r\n    },\r\n    navigation: {\r\n      confirmTitle: 'Mit Google Maps navigieren',\r\n      confirmMessage: 'Sie werden zu Google Maps weitergeleitet. M\u00F6chten Sie fortfahren?',\r\n      confirmYes: 'Ja, navigieren',\r\n      confirmNo: 'Hier bleiben',\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Beheer top en bottom fade gradients op basis van scroll positie\r\n * @param description - Het scrollbare element (popup-description)\r\n * @param topFade - Het fade gradient element bovenaan\r\n * @param bottomFade - Het fade gradient element onderaan\r\n */\r\nfunction manageDoubleFadeGradient(\r\n  description: HTMLElement,\r\n  topFade: HTMLElement | null,\r\n  bottomFade: HTMLElement | null\r\n): (() => void) | undefined {\r\n  if (!description) return;\r\n\r\n  // Zorg ervoor dat fade elementen een CSS transitie hebben\r\n  if (topFade) (topFade as HTMLElement).style.transition = 'opacity 0.3s ease';\r\n  if (bottomFade) (bottomFade as HTMLElement).style.transition = 'opacity 0.3s ease';\r\n\r\n  // Functie om de fades te updaten op basis van scroll positie\r\n  const updateFades = (): void => {\r\n    // Bereken scroll parameters\r\n    const maxScroll = description.scrollHeight - description.clientHeight;\r\n\r\n    // Als er niets te scrollen valt, verberg beide fades\r\n    if (maxScroll <= 5) {\r\n      if (topFade) (topFade as HTMLElement).style.opacity = '0';\r\n      if (bottomFade) (bottomFade as HTMLElement).style.opacity = '0';\r\n      return;\r\n    }\r\n\r\n    // Bereken relatieve scroll positie (0 tot 1)\r\n    const scrollPercentage = description.scrollTop / maxScroll;\r\n\r\n    // Beheer de BOTTOM fade (zoals eerder)\r\n    if (bottomFade) {\r\n      // Begin bottom fade te laten verdwijnen bij 75% scroll\r\n      let bottomOpacity = 1;\r\n      if (scrollPercentage > 0.75) {\r\n        bottomOpacity = 1 - (scrollPercentage - 0.75) / 0.25;\r\n      }\r\n      (bottomFade as HTMLElement).style.opacity = Math.max(0, Math.min(1, bottomOpacity)).toFixed(\r\n        2\r\n      );\r\n    }\r\n\r\n    // Beheer de TOP fade\r\n    if (topFade) {\r\n      // Top fade moet verdwijnen als we helemaal bovenaan zijn\r\n      // en geleidelijk verschijnen als we naar beneden scrollen\r\n      let topOpacity = 0;\r\n      if (scrollPercentage > 0) {\r\n        // Laat top fade zichtbaar worden bij 25% van maximale scroll area\r\n        topOpacity = Math.min(1, scrollPercentage * 4);\r\n      }\r\n      (topFade as HTMLElement).style.opacity = Math.max(0, Math.min(1, topOpacity)).toFixed(2);\r\n    }\r\n  };\r\n\r\n  // Luister naar scroll events\r\n  description.addEventListener('scroll', updateFades);\r\n\r\n  // Controleer ook bij resize events\r\n  window.addEventListener('resize', updateFades);\r\n\r\n  // Voer direct een initi\u00EBle check uit\r\n  updateFades();\r\n\r\n  // Return cleanup functie voor event listeners\r\n  return () => {\r\n    description.removeEventListener('scroll', updateFades);\r\n    window.removeEventListener('resize', updateFades);\r\n  };\r\n}\r\n\r\n/**\r\n * Show navigation confirmation dialog\r\n */\r\nfunction showNavigationConfirm(lat: string, lng: string, color: string): void {\r\n  const lang = detectLanguage();\r\n  const t = popupTranslations[lang];\r\n\r\n  // Create modal overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'navigation-confirm-overlay';\r\n\r\n  // Create modal\r\n  const modal = document.createElement('div');\r\n  modal.className = 'navigation-confirm-modal';\r\n  modal.innerHTML = `\r\n    <h3 class=\"navigation-confirm-title\">${t.navigation.confirmTitle}</h3>\r\n    <p class=\"navigation-confirm-message\">${t.navigation.confirmMessage}</p>\r\n    <div class=\"navigation-confirm-buttons\">\r\n      <button class=\"navigation-confirm-no button-base\" style=\"background-color: ${color}; border-color: ${color}; color: white;\">${t.navigation.confirmNo}</button>\r\n      <button class=\"navigation-confirm-yes button-base\">${t.navigation.confirmYes}</button>\r\n    </div>\r\n  `;\r\n\r\n  overlay.appendChild(modal);\r\n  document.body.appendChild(overlay);\r\n\r\n  // Animate in\r\n  requestAnimationFrame(() => {\r\n    overlay.style.opacity = '1';\r\n    modal.style.transform = 'scale(1)';\r\n  });\r\n\r\n  // Handle button clicks\r\n  const yesButton = modal.querySelector('.navigation-confirm-yes') as HTMLElement;\r\n  const noButton = modal.querySelector('.navigation-confirm-no') as HTMLElement;\r\n\r\n  const closeModal = () => {\r\n    overlay.style.opacity = '0';\r\n    modal.style.transform = 'scale(0.9)';\r\n    setTimeout(() => {\r\n      document.body.removeChild(overlay);\r\n    }, 300);\r\n  };\r\n\r\n  yesButton.addEventListener('click', () => {\r\n    window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');\r\n    closeModal();\r\n  });\r\n\r\n  noButton.addEventListener('click', closeModal);\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) closeModal();\r\n  });\r\n}\r\n\r\nexport function setupPopupInteractions(popup: Popup, properties: any, coordinates: any): void {\r\n  const popupElement = popup.getElement();\r\n  const popupContent = popupElement.querySelector('.mapboxgl-popup-content') as HTMLElement;\r\n  const popupWrapper = popupElement.querySelector('.popup-wrapper') as HTMLElement;\r\n  const frontContent = popupElement.querySelector('.popup-front .content-wrapper') as HTMLElement;\r\n  const backContent = popupElement.querySelector('.popup-back .content-wrapper') as HTMLElement;\r\n  const description = popupElement.querySelector('.popup-description') as HTMLElement;\r\n  const gradient = popupElement.querySelector('#paint0_linear_3248_5') as any;\r\n  \r\n  // Track cleanup functions for proper memory management\r\n  const cleanupFunctions: Array<() => void> = [];\r\n\r\n  // Zoek alle fade elementen\r\n  const topFade = popupElement.querySelector('.popup-front .fade-top') as HTMLElement;\r\n  const bottomFade = popupElement.querySelector('.popup-front .fade-bottom') as HTMLElement;\r\n\r\n  // Setup voor fade gradients\r\n  if (description) {\r\n    const cleanupFade = manageDoubleFadeGradient(description, topFade, bottomFade);\r\n    if (cleanupFade) cleanupFunctions.push(cleanupFade);\r\n\r\n    // Beheer ook fades op de achterkant\r\n    const backDescription = popupElement.querySelector(\r\n      '.popup-back .popup-descriptionv2'\r\n    ) as HTMLElement;\r\n    const backTopFade = popupElement.querySelector('.popup-back .fade-top') as HTMLElement;\r\n    const backBottomFade = popupElement.querySelector('.popup-back .fade-bottom') as HTMLElement;\r\n\r\n    if (backDescription) {\r\n      const cleanupBackFade = manageDoubleFadeGradient(\r\n        backDescription,\r\n        backTopFade,\r\n        backBottomFade\r\n      );\r\n      if (cleanupBackFade) cleanupFunctions.push(cleanupBackFade);\r\n    }\r\n\r\n    // Beheer opening hours scroll gradients\r\n    const openingHoursList = popupElement.querySelector('.opening-hours-list') as HTMLElement;\r\n    const openingHoursContainer = popupElement.querySelector('.popup-opening-hours') as HTMLElement;\r\n\r\n    if (openingHoursList && openingHoursContainer) {\r\n      const checkOpeningHoursScroll = () => {\r\n        const hasScroll = openingHoursList.scrollHeight > openingHoursList.clientHeight;\r\n        if (hasScroll) {\r\n          openingHoursContainer.classList.add('has-scroll');\r\n        } else {\r\n          openingHoursContainer.classList.remove('has-scroll');\r\n        }\r\n      };\r\n\r\n      // Check bij laden\r\n      setTimeout(checkOpeningHoursScroll, 100);\r\n\r\n      // Check bij window resize\r\n      window.addEventListener('resize', checkOpeningHoursScroll);\r\n      cleanupFunctions.push(() => window.removeEventListener('resize', checkOpeningHoursScroll));\r\n    }\r\n\r\n    // Update fades bij flip\r\n    popupElement.querySelectorAll('.more-info-button').forEach((button) => {\r\n      button.addEventListener('click', () => {\r\n        // Geef wat tijd voor de flip animatie\r\n        setTimeout(() => {\r\n          // Check opening hours scroll na flip\r\n          if (openingHoursList && openingHoursContainer && popupWrapper.classList.contains('is-flipped')) {\r\n            const hasScroll = openingHoursList.scrollHeight > openingHoursList.clientHeight;\r\n            if (hasScroll) {\r\n              openingHoursContainer.classList.add('has-scroll');\r\n            } else {\r\n              openingHoursContainer.classList.remove('has-scroll');\r\n            }\r\n          }\r\n\r\n          // Update de zichtbare fades\r\n          const isFlipped = popupWrapper.classList.contains('is-flipped');\r\n          const visibleDescription = isFlipped ? backDescription : description;\r\n\r\n          if (visibleDescription) {\r\n            const maxScroll = visibleDescription.scrollHeight - visibleDescription.clientHeight;\r\n            if (maxScroll > 5) {\r\n              const scrollPercent = visibleDescription.scrollTop / maxScroll;\r\n\r\n              // Update juiste fades afhankelijk van welke kant zichtbaar is\r\n              if (isFlipped) {\r\n                if (backTopFade)\r\n                  (backTopFade as HTMLElement).style.opacity =\r\n                    scrollPercent > 0 ? Math.min(1, scrollPercent * 4).toFixed(2) : '0';\r\n                if (backBottomFade)\r\n                  (backBottomFade as HTMLElement).style.opacity =\r\n                    scrollPercent > 0.75 ? (1 - (scrollPercent - 0.75) / 0.25).toFixed(2) : '1';\r\n              } else {\r\n                if (topFade)\r\n                  (topFade as HTMLElement).style.opacity =\r\n                    scrollPercent > 0 ? Math.min(1, scrollPercent * 4).toFixed(2) : '0';\r\n                if (bottomFade)\r\n                  (bottomFade as HTMLElement).style.opacity =\r\n                    scrollPercent > 0.75 ? (1 - (scrollPercent - 0.75) / 0.25).toFixed(2) : '1';\r\n              }\r\n            }\r\n          }\r\n        }, 50);\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Animate gradient stops\r\n   */\r\n  function animateGradient(newY1: number, newY2: number, gradient: any): void {\r\n    const startY1 = parseFloat(gradient.y1.baseVal.value);\r\n    const startY2 = parseFloat(gradient.y2.baseVal.value);\r\n    const startTime = Date.now();\r\n\r\n    function step(): void {\r\n      const progress = Math.min((Date.now() - startTime) / 800, 1);\r\n      gradient.y1.baseVal.value = startY1 + (newY1 - startY1) * progress;\r\n      gradient.y2.baseVal.value = startY2 + (newY2 - startY2) * progress;\r\n\r\n      if (progress < 1) {\r\n        requestAnimationFrame(step);\r\n      }\r\n    }\r\n\r\n    requestAnimationFrame(step);\r\n  }\r\n\r\n  /**\r\n   * Adjust popup height to content\r\n   */\r\n  function adjustPopupHeight(): void {\r\n    const contentHeight = Math.max(frontContent.offsetHeight, backContent.offsetHeight);\r\n    popupWrapper.style.height = `${contentHeight}px`;\r\n\r\n    popupElement.querySelectorAll('.popup-side').forEach((side) => {\r\n      (side as HTMLElement).style.height = `${contentHeight}px`;\r\n    });\r\n  }\r\n\r\n  // Set up hover effect on gradient\r\n  if (gradient) {\r\n    popupWrapper.addEventListener('mouseenter', () => {\r\n      animateGradient(30, 282, gradient);\r\n    });\r\n\r\n    popupWrapper.addEventListener('mouseleave', () => {\r\n      animateGradient(0, 252, gradient);\r\n    });\r\n  }\r\n\r\n  // Adjust height\r\n  setTimeout(adjustPopupHeight, 10);\r\n\r\n  // Animate popup appearance\r\n  popupContent.style.opacity = '0';\r\n  popupContent.style.transform = 'rotate(8deg) translateY(2.5rem) /* was 40px */ scale(0.4)';\r\n\r\n  requestAnimationFrame(() => {\r\n    popupContent.style.transition = 'all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)';\r\n    popupContent.style.opacity = '1';\r\n    popupContent.style.transform = 'rotate(0deg) translateY(0) scale(1)';\r\n  });\r\n\r\n  // Handle scrollable description\r\n  if (description) {\r\n    // Wheel event\r\n    description.addEventListener(\r\n      'wheel',\r\n      (event) => {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        description.scrollTop += event.deltaY;\r\n      },\r\n      { passive: false }\r\n    );\r\n\r\n    // Mouse interactions\r\n    description.addEventListener('mouseenter', () => {\r\n      (window as any).map.dragPan.disable();\r\n      (window as any).map.scrollZoom.disable();\r\n    });\r\n\r\n    description.addEventListener('mouseleave', () => {\r\n      (window as any).map.dragPan.enable();\r\n      (window as any).map.scrollZoom.enable();\r\n    });\r\n\r\n    // Mouse drag to scroll\r\n    let isDragging = false;\r\n    let startY: number, startScrollTop: number;\r\n\r\n    description.addEventListener('mousedown', (event) => {\r\n      isDragging = true;\r\n      startY = event.pageY;\r\n      startScrollTop = description.scrollTop;\r\n      description.style.cursor = 'grabbing';\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    });\r\n\r\n    description.addEventListener('mousemove', (event) => {\r\n      if (!isDragging) return;\r\n\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      const deltaY = event.pageY - startY;\r\n      description.scrollTop = startScrollTop - deltaY;\r\n    });\r\n\r\n    const mouseUpHandler = () => {\r\n      isDragging = false;\r\n      description.style.cursor = 'grab';\r\n    };\r\n    document.addEventListener('mouseup', mouseUpHandler);\r\n    \r\n    // Track for cleanup\r\n    cleanupFunctions.push(() => document.removeEventListener('mouseup', mouseUpHandler));\r\n\r\n    description.addEventListener('mouseleave', () => {\r\n      isDragging = false;\r\n      description.style.cursor = 'grab';\r\n    });\r\n\r\n    // Touch interactions\r\n    let touchStartY = 0;\r\n    let touchStartScrollTop = 0;\r\n\r\n    description.addEventListener('touchstart', (event) => {\r\n      touchStartY = event.touches[0].clientY;\r\n      touchStartScrollTop = description.scrollTop;\r\n      event.stopPropagation();\r\n    });\r\n\r\n    description.addEventListener(\r\n      'touchmove',\r\n      (event) => {\r\n        const deltaY = touchStartY - event.touches[0].clientY;\r\n        description.scrollTop = touchStartScrollTop + deltaY;\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n      },\r\n      { passive: false }\r\n    );\r\n  }\r\n\r\n  // Handle impressie button click (for all impressie buttons)\r\n  if (properties.image) {\r\n    popupElement.querySelectorAll('.impressie-button').forEach((button) => {\r\n      button.addEventListener('click', () => {\r\n        // Image popup should only be shown from the main popup, not from AR popups\r\n        if (!properties.link_ar) {\r\n          popupContent.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';\r\n          popupContent.style.transform = 'rotate(-5deg) translateY(2.5rem) /* was 40px */ scale(0.6)';\r\n          popupContent.style.opacity = '0';\r\n\r\n          setTimeout(() => {\r\n            const contentHeight = Math.max(frontContent.offsetHeight, backContent.offsetHeight);\r\n            popup.remove();\r\n            setActivePopup(null);\r\n            showImagePopup(properties, coordinates, contentHeight);\r\n          }, 400);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Handle navigate button click (show confirmation)\r\n  const navigateButton = popupElement.querySelector('.navigate-button') as HTMLElement;\r\n  if (navigateButton) {\r\n    navigateButton.addEventListener('click', () => {\r\n      const lat = navigateButton.getAttribute('data-lat');\r\n      const lng = navigateButton.getAttribute('data-lng');\r\n      const color = navigateButton.getAttribute('data-color') || '#6B46C1';\r\n      if (lat && lng) {\r\n        showNavigationConfirm(lat, lng, color);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Handle info button click (flip card)\r\n  popupElement.querySelectorAll('.more-info-button').forEach((button) => {\r\n    button.addEventListener('click', () => {\r\n      popupWrapper.classList.toggle('is-flipped');\r\n    });\r\n  });\r\n\r\n  // Update this code in the setupPopupInteractions function:\r\n  popupElement.querySelectorAll('.close-button').forEach((button) => {\r\n    button.addEventListener('click', () => {\r\n      popupContent.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';\r\n      popupContent.style.transform = 'rotate(-5deg) translateY(2.5rem) /* was 40px */ scale(0.6)';\r\n      popupContent.style.opacity = '0';\r\n\r\n      // Close any open sidebar items with animation\r\n      const visibleItem = window.$('.locations-map_item.is--show');\r\n      if (visibleItem.length) {\r\n        visibleItem.css({\r\n          opacity: '0',\r\n          transform: 'translateY(2.5rem) /* was 40px */ scale(0.6)',\r\n          transition: 'all 400ms cubic-bezier(0.68, -0.55, 0.265, 1.55)',\r\n        });\r\n      }\r\n\r\n      setTimeout(() => {\r\n        // Clean up all tracked event listeners and resources\r\n        cleanupFunctions.forEach(cleanup => cleanup());\r\n        \r\n        popup.remove();\r\n        setActivePopup(null);\r\n\r\n        // Also remove the is--show class after animation completes\r\n        window.$('.locations-map_item').removeClass('is--show');\r\n\r\n        // Make sure to update geolocation manager state\r\n        if (window.geolocationManager) {\r\n          window.geolocationManager.isPopupOpen = false;\r\n\r\n          // Restore tracking if it was active before\r\n          if (window.geolocationManager.wasTracking) {\r\n            window.geolocationManager.resumeTracking();\r\n          }\r\n        }\r\n      }, 400);\r\n    });\r\n  });\r\n\r\n  // Update height on window resize\r\n  window.addEventListener('resize', adjustPopupHeight);\r\n  cleanupFunctions.push(() => window.removeEventListener('resize', adjustPopupHeight));\r\n}\r\n\r\n/**\r\n * Show a fullscreen image popup\r\n */\r\nexport function showImagePopup(properties: any, coordinates: any, contentHeight: number): void {\r\n  const lang = detectLanguage();\r\n  const t = popupTranslations[lang];\r\n  const isMobile = window.matchMedia('(max-width: 479px)').matches;\r\n\r\n  const popup = new window.mapboxgl.Popup({\r\n    offset: [0, -5],\r\n    className: 'custom-popup',\r\n    closeButton: false,\r\n    maxWidth: 'none',\r\n    closeOnClick: false,\r\n    anchor: 'bottom',\r\n  });\r\n\r\n  // Create popup content\r\n  const html = `\r\n    <style>\r\n      .popup-wrapper {\r\n        height: ${contentHeight}px;\r\n      }\r\n\r\n      .popup-side {\r\n        background-color: ${properties.color || '#6B46C1'};\r\n        clip-path: polygon(calc(100% - 0px) 26.5px, calc(100% - 0px) calc(100% - 26.5px), calc(100% - 0px) calc(100% - 26.5px), calc(100% - 0.34671999999995px) calc(100% - 22.20048px), calc(100% - 1.3505599999999px) calc(100% - 18.12224px), calc(100% - 2.95704px) calc(100% - 14.31976px), calc(100% - 5.11168px) calc(100% - 10.84752px), calc(100% - 7.76px) calc(100% - 7.76px), calc(100% - 10.84752px) calc(100% - 5.11168px), calc(100% - 14.31976px) calc(100% - 2.9570399999999px), calc(100% - 18.12224px) calc(100% - 1.35056px), calc(100% - 22.20048px) calc(100% - 0.34672px), calc(100% - 26.5px) calc(100% - 0px), calc(50% - -32.6px) calc(100% - 0px), calc(50% - -32.6px) calc(100% - 0px), calc(50% - -31.57121px) calc(100% - 0.057139999999947px), calc(50% - -30.56648px) calc(100% - 0.2255199999999px), calc(50% - -29.59427px) calc(100% - 0.50057999999996px), calc(50% - -28.66304px) calc(100% - 0.87775999999991px), calc(50% - -27.78125px) calc(100% - 1.3525px), calc(50% - -26.95736px) calc(100% - 1.92024px), calc(50% - -26.19983px) calc(100% - 2.57642px), calc(50% - -25.51712px) calc(100% - 3.31648px), calc(50% - -24.91769px) calc(100% - 4.13586px), calc(50% - -24.41px) calc(100% - 5.03px), calc(50% - -24.41px) calc(100% - 5.03px), calc(50% - -22.95654px) calc(100% - 7.6045699999999px), calc(50% - -21.23752px) calc(100% - 9.9929599999998px), calc(50% - -19.27298px) calc(100% - 12.17519px), calc(50% - -17.08296px) calc(100% - 14.13128px), calc(50% - -14.6875px) calc(100% - 15.84125px), calc(50% - -12.10664px) calc(100% - 17.28512px), calc(50% - -9.36042px) calc(100% - 18.44291px), calc(50% - -6.46888px) calc(100% - 19.29464px), calc(50% - -3.45206px) calc(100% - 19.82033px), calc(50% - -0.32999999999998px) calc(100% - 20px), calc(50% - -0.32999999999998px) calc(100% - 20px), calc(50% - 2.79179px) calc(100% - 19.82033px), calc(50% - 5.8079199999999px) calc(100% - 19.29464px), calc(50% - 8.69853px) calc(100% - 18.44291px), calc(50% - 11.44376px) calc(100% - 17.28512px), calc(50% - 14.02375px) calc(100% - 15.84125px), calc(50% - 16.41864px) calc(100% - 14.13128px), calc(50% - 18.60857px) calc(100% - 12.17519px), calc(50% - 20.57368px) calc(100% - 9.9929599999999px), calc(50% - 22.29411px) calc(100% - 7.60457px), calc(50% - 23.75px) calc(100% - 5.03px), calc(50% - 23.75px) calc(100% - 5.03px), calc(50% - 24.25769px) calc(100% - 4.1358599999999px), calc(50% - 24.85712px) calc(100% - 3.3164799999998px), calc(50% - 25.53983px) calc(100% - 2.57642px), calc(50% - 26.29736px) calc(100% - 1.92024px), calc(50% - 27.12125px) calc(100% - 1.3525px), calc(50% - 28.00304px) calc(100% - 0.87775999999997px), calc(50% - 28.93427px) calc(100% - 0.50057999999996px), calc(50% - 29.90648px) calc(100% - 0.22552000000002px), calc(50% - 30.91121px) calc(100% - 0.057140000000004px), calc(50% - 31.94px) calc(100% - 0px), 26.5px calc(100% - 0px), 26.5px calc(100% - 0px), 22.20048px calc(100% - 0.34671999999989px), 18.12224px calc(100% - 1.3505599999999px), 14.31976px calc(100% - 2.95704px), 10.84752px calc(100% - 5.1116799999999px), 7.76px calc(100% - 7.76px), 5.11168px calc(100% - 10.84752px), 2.95704px calc(100% - 14.31976px), 1.35056px calc(100% - 18.12224px), 0.34672px calc(100% - 22.20048px), 4.3855735949631E-31px calc(100% - 26.5px), 0px 26.5px, 0px 26.5px, 0.34672px 22.20048px, 1.35056px 18.12224px, 2.95704px 14.31976px, 5.11168px 10.84752px, 7.76px 7.76px, 10.84752px 5.11168px, 14.31976px 2.95704px, 18.12224px 1.35056px, 22.20048px 0.34672px, 26.5px 4.3855735949631E-31px, calc(50% - 26.74px) 0px, calc(50% - 26.74px) 0px, calc(50% - 25.31263px) 0.07137px, calc(50% - 23.91544px) 0.28176px, calc(50% - 22.55581px) 0.62559px, calc(50% - 21.24112px) 1.09728px, calc(50% - 19.97875px) 1.69125px, calc(50% - 18.77608px) 2.40192px, calc(50% - 17.64049px) 3.22371px, calc(50% - 16.57936px) 4.15104px, calc(50% - 15.60007px) 5.17833px, calc(50% - 14.71px) 6.3px, calc(50% - 14.71px) 6.3px, calc(50% - 13.6371px) 7.64798px, calc(50% - 12.446px) 8.89024px, calc(50% - 11.1451px) 10.01826px, calc(50% - 9.7428px) 11.02352px, calc(50% - 8.2475px) 11.8975px, calc(50% - 6.6676px) 12.63168px, calc(50% - 5.0115px) 13.21754px, calc(50% - 3.2876px) 13.64656px, calc(50% - 1.5043px) 13.91022px, calc(50% - -0.32999999999996px) 14px, calc(50% - -0.32999999999998px) 14px, calc(50% - -2.16431px) 13.9105px, calc(50% - -3.94768px) 13.6476px, calc(50% - -5.67177px) 13.2197px, calc(50% - -7.32824px) 12.6352px, calc(50% - -8.90875px) 11.9025px, calc(50% - -10.40496px) 11.03px, calc(50% - -11.80853px) 10.0261px, calc(50% - -13.11112px) 8.8992px, calc(50% - -14.30439px) 7.6577px, calc(50% - -15.38px) 6.31px, calc(50% - -15.38px) 6.31px, calc(50% - -16.27279px) 5.18562px, calc(50% - -17.25432px) 4.15616px, calc(50% - -18.31733px) 3.22714px, calc(50% - -19.45456px) 2.40408px, calc(50% - -20.65875px) 1.6925px, calc(50% - -21.92264px) 1.09792px, calc(50% - -23.23897px) 0.62586px, calc(50% - -24.60048px) 0.28184px, calc(50% - -25.99991px) 0.07138px, calc(50% - -27.43px) 8.9116630386686E-32px, calc(100% - 26.5px) 0px, calc(100% - 26.5px) 0px, calc(100% - 22.20048px) 0.34672px, calc(100% - 18.12224px) 1.35056px, calc(100% - 14.31976px) 2.95704px, calc(100% - 10.84752px) 5.11168px, calc(100% - 7.76px) 7.76px, calc(100% - 5.11168px) 10.84752px, calc(100% - 2.9570399999999px) 14.31976px, calc(100% - 1.35056px) 18.12224px, calc(100% - 0.34671999999995px) 22.20048px, calc(100% - 5.6843418860808E-14px) 26.5px);\r\n      }\r\n\r\n      .close-button {\r\n        background: ${properties.color || '#6B46C1'};\r\n      }\r\n    </style>\r\n    <div class=\"popup-wrapper\">\r\n      <button class=\"close-button\" aria-label=\"${t.aria.closePopup}\"></button>\r\n      <div class=\"popup-side\">\r\n        <div class=\"image-container\">\r\n          <img src=\"${properties.image}\" alt=\"${properties.name}\" class=\"full-image\">\r\n          <div class=\"button-container\">\r\n            <button class=\"back-button\">${t.buttons.back}</button>\r\n          </div>\r\n          <div class=\"location-name\">${properties.name}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Add popup to map\r\n  popup\r\n    .setLngLat(coordinates)\r\n    .setHTML(html)\r\n    .addTo((window as any).map);\r\n  setActivePopup(popup);\r\n\r\n  // Get DOM elements\r\n  const popupElement = popup.getElement();\r\n  const popupContent = popupElement.querySelector('.mapboxgl-popup-content') as HTMLElement;\r\n  const closeButton = popupElement.querySelector('.close-button') as HTMLElement;\r\n  const backButton = popupElement.querySelector('.back-button') as HTMLElement;\r\n\r\n  // Animate popup appearance\r\n  popupContent.style.opacity = '0';\r\n  popupContent.style.transform = 'rotate(8deg) translateY(2.5rem) /* was 40px */ scale(0.4)';\r\n\r\n  requestAnimationFrame(() => {\r\n    popupContent.style.transition = 'all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)';\r\n    popupContent.style.opacity = '1';\r\n    popupContent.style.transform = 'rotate(0deg) translateY(0) scale(1)';\r\n  });\r\n\r\n  // Find gradient for hover effect if it exists\r\n  const svgElement = popupElement.querySelector('svg');\r\n  if (svgElement) {\r\n    const gradient = svgElement.querySelector('linearGradient');\r\n    if (gradient) {\r\n      const popupWrapper = popupElement.querySelector('.popup-wrapper') as HTMLElement;\r\n\r\n      function animateGradient(newY1: number, newY2: number, gradient: any): void {\r\n        const startY1 = parseFloat(gradient.y1.baseVal.value);\r\n        const startY2 = parseFloat(gradient.y2.baseVal.value);\r\n        const startTime = Date.now();\r\n\r\n        function step(): void {\r\n          const progress = Math.min((Date.now() - startTime) / 800, 1);\r\n          gradient.y1.baseVal.value = startY1 + (newY1 - startY1) * progress;\r\n          gradient.y2.baseVal.value = startY2 + (newY2 - startY2) * progress;\r\n\r\n          if (progress < 1) {\r\n            requestAnimationFrame(step);\r\n          }\r\n        }\r\n\r\n        requestAnimationFrame(step);\r\n      }\r\n\r\n      popupWrapper.addEventListener('mouseenter', () => {\r\n        animateGradient(30, 282, gradient);\r\n      });\r\n\r\n      popupWrapper.addEventListener('mouseleave', () => {\r\n        animateGradient(0, 252, gradient);\r\n      });\r\n    }\r\n  }\r\n\r\n  // Handle close button click\r\n  closeButton.addEventListener('click', () => {\r\n    popupContent.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';\r\n    popupContent.style.transform = 'rotate(-5deg) translateY(2.5rem) /* was 40px */ scale(0.6)';\r\n    popupContent.style.opacity = '0';\r\n\r\n    setTimeout(() => {\r\n      popup.remove();\r\n      setActivePopup(null);\r\n    }, 400);\r\n  });\r\n\r\n  // Handle back button click (return to main popup)\r\n  backButton.addEventListener('click', () => {\r\n    popupContent.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';\r\n    popupContent.style.transform = 'rotate(-5deg) translateY(2.5rem) /* was 40px */ scale(0.6)';\r\n    popupContent.style.opacity = '0';\r\n\r\n    setTimeout(async () => {\r\n      popup.remove();\r\n      setActivePopup(null);\r\n\r\n      // Create new main popup\r\n      const mainPopup = new window.mapboxgl.Popup({\r\n        offset: [0, -5],\r\n        className: 'custom-popup',\r\n        closeButton: false,\r\n        maxWidth: 'none',\r\n        closeOnClick: false,\r\n        anchor: 'bottom',\r\n      });\r\n\r\n      const { createPopupContent } = await import('./popups.js');\r\n      const { styles, html } = createPopupContent(properties, coordinates);\r\n      mainPopup.setLngLat(coordinates).setHTML(`${styles}${html}`);\r\n      mainPopup.addTo((window as any).map);\r\n      setActivePopup(mainPopup);\r\n      setupPopupInteractions(mainPopup, properties, coordinates);\r\n\r\n      // Animate new popup appearance\r\n      const newPopupContent = mainPopup\r\n        .getElement()\r\n        .querySelector('.mapboxgl-popup-content') as HTMLElement;\r\n      newPopupContent.style.opacity = '0';\r\n      newPopupContent.style.transform = 'rotate(8deg) translateY(2.5rem) /* was 40px */ scale(0.4)';\r\n\r\n      requestAnimationFrame(() => {\r\n        newPopupContent.style.transition = 'all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)';\r\n        newPopupContent.style.opacity = '1';\r\n        newPopupContent.style.transform = 'rotate(0deg) translateY(0) scale(1)';\r\n      });\r\n    }, 400);\r\n  });\r\n}\r\n\r\n/**\r\n * Close sidebar items\r\n */\r\nexport function closeItem(): void {\r\n  window.$('.locations-map_item').removeClass('is--show');\r\n}\r\n\r\n/**\r\n * Close sidebar items if visible\r\n */\r\nexport function closeItemIfVisible(): void {\r\n  if (window.$('.locations-map_item').hasClass('is--show')) {\r\n    closeItem();\r\n  }\r\n}\r\n", "// Popup management module\r\n\r\nimport type { Feature } from 'geojson';\r\nimport type { Map, Popup } from 'mapbox-gl';\r\n\r\nimport { CONFIG } from './config.js';\r\nimport { setActivePopup, state } from './state.js';\r\nexport { closeItem, closeItemIfVisible, showImagePopup } from './popups-part2.js';\r\n\r\n// Global declarations\r\ndeclare global {\r\n  interface Window {\r\n    mapboxgl: any;\r\n    geolocationManager?: any;\r\n    $: any;\r\n  }\r\n}\r\n\r\n// Language detection function\r\nfunction detectLanguage(): 'nl' | 'en' | 'de' {\r\n  const path = window.location.pathname;\r\n  if (path.includes('/en/')) return 'en';\r\n  if (path.includes('/de/')) return 'de';\r\n  return 'nl'; // Default to Dutch\r\n}\r\n\r\n// Popup translations\r\nconst popupTranslations = {\r\n  nl: {\r\n    buttons: {\r\n      startAR: 'Start AR',\r\n      instruction: 'Instructie',\r\n      back: 'Terug',\r\n      impression: 'Impressie',\r\n      moreInfo: 'Meer info',\r\n      navigate: 'Navigeer',\r\n    },\r\n    titles: {\r\n      instruction: 'Instructie',\r\n    },\r\n    messages: {\r\n      arMobileOnly: 'Deze AR-ervaring is alleen beschikbaar op mobiele apparaten',\r\n      snapchatRequired:\r\n        'Om deze AR ervaring te gebruiken heb je Snapchat nodig. Wil je Snapchat downloaden?',\r\n      defaultARInstruction: 'Bekijk deze AR ervaring op je telefoon of desktop.',\r\n    },\r\n    aria: {\r\n      closePopup: 'Sluit popup',\r\n      website: 'Website',\r\n      instagram: 'Instagram',\r\n      facebook: 'Facebook',\r\n      navigate: 'Navigeer naar locatie',\r\n    },\r\n    navigation: {\r\n      confirmTitle: 'Navigeer met Google Maps',\r\n      confirmMessage: 'Je wordt doorgestuurd naar Google Maps. Wil je doorgaan?',\r\n      confirmYes: 'Ja, navigeer',\r\n      confirmNo: 'Blijf hier',\r\n    },\r\n  },\r\n  en: {\r\n    buttons: {\r\n      startAR: 'Start AR',\r\n      instruction: 'Instruction',\r\n      back: 'Back',\r\n      impression: 'Impression',\r\n      moreInfo: 'More info',\r\n      navigate: 'Navigate',\r\n    },\r\n    titles: {\r\n      instruction: 'Instruction',\r\n    },\r\n    messages: {\r\n      arMobileOnly: 'This AR experience is only available on mobile devices',\r\n      snapchatRequired:\r\n        'You need Snapchat to use this AR experience. Would you like to download Snapchat?',\r\n      defaultARInstruction: 'View this AR experience on your phone or desktop.',\r\n    },\r\n    aria: {\r\n      closePopup: 'Close popup',\r\n      website: 'Website',\r\n      instagram: 'Instagram',\r\n      facebook: 'Facebook',\r\n      navigate: 'Navigate to location',\r\n    },\r\n    navigation: {\r\n      confirmTitle: 'Navigate with Google Maps',\r\n      confirmMessage: 'You will be redirected to Google Maps. Do you want to continue?',\r\n      confirmYes: 'Yes, navigate',\r\n      confirmNo: 'Stay here',\r\n    },\r\n  },\r\n  de: {\r\n    buttons: {\r\n      startAR: 'AR starten',\r\n      instruction: 'Anleitung',\r\n      back: 'Zur\u00FCck',\r\n      impression: 'Eindruck',\r\n      moreInfo: 'Mehr Info',\r\n      navigate: 'Navigieren',\r\n    },\r\n    titles: {\r\n      instruction: 'Anleitung',\r\n    },\r\n    messages: {\r\n      arMobileOnly: 'Diese AR-Erfahrung ist nur auf mobilen Ger\u00E4ten verf\u00FCgbar',\r\n      snapchatRequired:\r\n        'Sie ben\u00F6tigen Snapchat f\u00FCr diese AR-Erfahrung. M\u00F6chten Sie Snapchat herunterladen?',\r\n      defaultARInstruction: 'Sehen Sie sich diese AR-Erfahrung auf Ihrem Telefon oder Desktop an.',\r\n    },\r\n    aria: {\r\n      closePopup: 'Popup schlie\u00DFen',\r\n      website: 'Webseite',\r\n      instagram: 'Instagram',\r\n      facebook: 'Facebook',\r\n      navigate: 'Zum Standort navigieren',\r\n    },\r\n    navigation: {\r\n      confirmTitle: 'Mit Google Maps navigieren',\r\n      confirmMessage: 'Sie werden zu Google Maps weitergeleitet. M\u00F6chten Sie fortfahren?',\r\n      confirmYes: 'Ja, navigieren',\r\n      confirmNo: 'Hier bleiben',\r\n    },\r\n  },\r\n};\r\n\r\n/**\r\n * Main function to create and show a popup for a location\r\n * @param location - The location feature object\r\n * @param map - The mapbox map instance\r\n */\r\nexport async function createPopup(location: any, map: Map): Promise<Popup> {\r\n  const coordinates = location.geometry.coordinates.slice();\r\n  const { properties } = location;\r\n  const isAR = properties.type === 'ar';\r\n\r\n  // Calculate offset based on screen size - adjusted for fluid scaling popup\r\n  // Mobile (\u2264479px): smaller popup, smaller offset\r\n  // Tablet (480px-991px): medium popup, medium offset\r\n  // Desktop (\u2265992px): larger popup due to fluid scaling, larger offset\r\n  let offset: [number, number];\r\n  if (window.matchMedia('(max-width: 479px)').matches) {\r\n    offset = [0, 200]; // Small screens\r\n  } else if (window.matchMedia('(max-width: 991px)').matches) {\r\n    offset = [0, 220]; // Medium screens - more centered\r\n  } else {\r\n    offset = [0, 260]; // Large screens - more centered\r\n  }\r\n\r\n  // Fly to marker\r\n  map.flyTo({\r\n    center: coordinates,\r\n    offset,\r\n    duration: 800,\r\n    essential: true,\r\n  });\r\n\r\n  // Handle existing sidebar items\r\n  const visibleItem = window.$('.locations-map_item.is--show');\r\n  if (visibleItem.length) {\r\n    visibleItem.css({\r\n      opacity: '0',\r\n      transform: 'translateY(2.5rem) scale(0.6)', /* was 40px */\r\n    });\r\n  }\r\n\r\n  // Handle existing popup\r\n  if (state.activePopup) {\r\n    const popupContent = state.activePopup.getElement().querySelector('.mapboxgl-popup-content');\r\n    if (popupContent) {\r\n      (popupContent as HTMLElement).style.transition =\r\n        'all 400ms cubic-bezier(0.68, -0.55, 0.265, 1.55)';\r\n      (popupContent as HTMLElement).style.transform = 'rotate(-5deg) translateY(1.25rem) scale(0.8)'; /* was 20px */\r\n      (popupContent as HTMLElement).style.opacity = '0';\r\n    }\r\n  }\r\n\r\n  // Wait for animations to complete\r\n  await new Promise((resolve) => setTimeout(resolve, 400));\r\n\r\n  // Remove existing popup\r\n  if (state.activePopup) {\r\n    state.activePopup.remove();\r\n    setActivePopup(null);\r\n  }\r\n\r\n  // Extra cleanup: ensure all popup elements are removed from DOM\r\n  const existingPopups = document.querySelectorAll('.mapboxgl-popup');\r\n  existingPopups.forEach((popup) => popup.remove());\r\n\r\n  // Small delay to ensure DOM is clean before creating new popup\r\n  await new Promise((resolve) => setTimeout(resolve, 50));\r\n\r\n  // Only show sidebar for non-AR markers\r\n  if (!isAR) {\r\n    // Reset all sidebar items\r\n    window.$('.locations-map_item').removeClass('is--show').css({\r\n      display: 'none',\r\n      transform: 'translateY(2.5rem) scale(0.6)', /* was 40px */\r\n      opacity: '0',\r\n    });\r\n\r\n    // Show sidebar\r\n    window.$('.locations-map_wrapper').addClass('is--show');\r\n\r\n    // Show current sidebar item\r\n    const currentItem = window.$('.locations-map_item').eq(properties.arrayID);\r\n    currentItem.css({\r\n      display: 'block',\r\n      opacity: '0',\r\n      transform: 'translateY(2.5rem) scale(0.6)', /* was 40px */\r\n    });\r\n\r\n    // Force reflow\r\n    currentItem[0].offsetHeight;\r\n\r\n    // Animate sidebar item appearance\r\n    requestAnimationFrame(() => {\r\n      currentItem\r\n        .css({\r\n          transition: 'all 400ms cubic-bezier(0.68, -0.55, 0.265, 1.55)',\r\n          opacity: '1',\r\n          transform: 'translateY(0) scale(1)',\r\n        })\r\n        .addClass('is--show');\r\n    });\r\n  } else {\r\n    // For AR markers, hide the sidebar if visible\r\n    window.$('.locations-map_wrapper').removeClass('is--show');\r\n    window.$('.locations-map_item').removeClass('is--show');\r\n  }\r\n\r\n  // Create new popup\r\n  const popup = new window.mapboxgl.Popup({\r\n    offset: {\r\n      bottom: [0, -5],\r\n      top: [0, 0],\r\n      left: [0, 0],\r\n      right: [0, 0],\r\n    },\r\n    className: 'custom-popup',\r\n    closeButton: false,\r\n    maxWidth: 'none', // Removed fixed width - now controlled by CSS clamp()\r\n    closeOnClick: false,\r\n    anchor: 'bottom',\r\n  });\r\n\r\n  // Update geolocation manager state and PAUSE TRACKING\r\n  if (window.geolocationManager) {\r\n    window.geolocationManager.isPopupOpen = true;\r\n\r\n    // Explicitly pause location tracking when popup is opened\r\n    if (window.geolocationManager.geolocateControl) {\r\n      // Store tracking state to restore later if needed\r\n      window.geolocationManager.wasTracking =\r\n        window.geolocationManager.geolocateControl._watchState === 'ACTIVE_LOCK';\r\n\r\n      // Disable auto-centering on user location\r\n      window.geolocationManager.pauseTracking();\r\n    }\r\n  }\r\n\r\n  // Create and add popup content\r\n  const { styles, html } = createPopupContent(properties, coordinates);\r\n  popup.setLngLat(coordinates).setHTML(`${styles}${html}`).addTo(map);\r\n  setActivePopup(popup);\r\n\r\n  // Add popup close handler to restore tracking\r\n  popup.on('close', () => {\r\n    if (window.geolocationManager) {\r\n      window.geolocationManager.isPopupOpen = false;\r\n\r\n      // Restore tracking if it was active before\r\n      if (window.geolocationManager.wasTracking) {\r\n        window.geolocationManager.resumeTracking();\r\n      }\r\n    }\r\n  });\r\n\r\n  // Setup popup interactions\r\n  const { setupPopupInteractions } = await import('./popups-part2.js');\r\n  setupPopupInteractions(popup, properties, coordinates);\r\n\r\n  return popup;\r\n}\r\n\r\nexport function closeActivePopup(): void {\r\n  if (state.activePopup) {\r\n    state.activePopup.remove();\r\n    setActivePopup(null);\r\n  }\r\n}\r\n\r\n//! ============= POPUP MANAGEMENT =============\r\n\r\n/**\r\n * Detecteert apparaattype en geeft de juiste AR-link terug\r\n * @param properties - De properties van het feature met links\r\n * @return Object met de juiste link en een boolean of het beschikbaar is\r\n */\r\nexport function getARLinkForDevice(properties: any): any {\r\n  // Detecteer of gebruiker op mobiel apparaat zit\r\n  const isMobile =\r\n    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||\r\n    window.innerWidth <= 768;\r\n\r\n  // Logica voor welke link te gebruiken\r\n  if (isMobile) {\r\n    return {\r\n      link: properties.link_ar_mobile,\r\n      available: !!properties.link_ar_mobile,\r\n      deviceType: 'mobile',\r\n    };\r\n  }\r\n  return {\r\n    link: properties.link_ar_desktop,\r\n    available: !!properties.link_ar_desktop,\r\n    deviceType: 'desktop',\r\n  };\r\n}\r\n\r\n/**\r\n * Genereert HTML voor AR-knop gebaseerd op apparaattype\r\n * @param properties - De properties van het feature\r\n * @param buttonClass - CSS class voor de knop\r\n * @param buttonText - Tekst voor de knop (optional, will use translation if not provided)\r\n * @return HTML voor de knop\r\n */\r\nexport function createARButton(\r\n  properties: any,\r\n  buttonClass: string = 'impressie-button button-base',\r\n  buttonText?: string\r\n): string {\r\n  const lang = detectLanguage();\r\n  const t = popupTranslations[lang];\r\n  const linkInfo = getARLinkForDevice(properties);\r\n  const actualButtonText = buttonText || t.buttons.startAR;\r\n\r\n  if (!linkInfo.available) {\r\n    // Link niet beschikbaar voor dit apparaat\r\n    if (linkInfo.deviceType === 'desktop') {\r\n      return `<button class=\"${buttonClass} disabled\" disabled title=\"${t.messages.arMobileOnly}\">\r\n                ${actualButtonText} <span class=\"mobile-only\">\uD83D\uDCF1</span>\r\n              </button>`;\r\n    }\r\n    return ''; // Geen knop tonen als er geen link is voor mobiel\r\n  }\r\n\r\n  // Voor mobile Snapchat links, gebruik speciale handler\r\n  if (linkInfo.deviceType === 'mobile' && linkInfo.link.startsWith('snapchat://')) {\r\n    return `<button class=\"${buttonClass}\" onclick=\"handleSnapchatLink('${linkInfo.link}')\">${actualButtonText}</button>`;\r\n  }\r\n\r\n  // Voor alle andere links, gebruik normale window.open\r\n  return `<button class=\"${buttonClass}\" onclick=\"window.open('${linkInfo.link}', '_blank')\">${actualButtonText}</button>`;\r\n}\r\n\r\n// Functie om Snapchat links te behandelen met fallback voor niet-ge\u00EFnstalleerde app\r\nexport function handleSnapchatLink(snapchatUri: string): void {\r\n  const lang = detectLanguage();\r\n  const t = popupTranslations[lang];\r\n\r\n  // Snapchat App Store/Google Play links\r\n  const appStoreLink = 'https://apps.apple.com/app/snapchat/id447188370';\r\n  const playStoreLink = 'https://play.google.com/store/apps/details?id=com.snapchat.android';\r\n\r\n  // Controleer of we op iOS of Android zijn\r\n  const isAndroid = /Android/i.test(navigator.userAgent);\r\n  const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);\r\n  const storeLink = isAndroid ? playStoreLink : appStoreLink;\r\n\r\n  // Probeer Snapchat te openen, met fallback\r\n  const now = Date.now();\r\n  const timeoutDuration = 1000; // 1 seconde wachttijd\r\n\r\n  // Poging om Snapchat te openen\r\n  window.location.href = snapchatUri;\r\n\r\n  // Check of de app is geopend na 1 seconde\r\n  setTimeout(function () {\r\n    // Als we nog steeds op dezelfde pagina zijn na 1 seconde,\r\n    // dan is de app waarschijnlijk niet ge\u00EFnstalleerd\r\n    if (Date.now() - now < timeoutDuration + 100) {\r\n      // Toon een melding en bied de mogelijkheid om Snapchat te downloaden\r\n      if (confirm(t.messages.snapchatRequired)) {\r\n        window.location.href = storeLink;\r\n      }\r\n    }\r\n  }, timeoutDuration);\r\n}\r\n\r\n// Helper function to convert hex to rgba for more stable gradients\r\nfunction hexToRgba(hex: string, alpha: number = 1): string {\r\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n  if (result) {\r\n    const r = parseInt(result[1], 16);\r\n    const g = parseInt(result[2], 16);\r\n    const b = parseInt(result[3], 16);\r\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n  }\r\n  // Fallback to transparent\r\n  return `rgba(0, 0, 0, 0)`;\r\n}\r\n\r\n/**\r\n * Generate opening hours HTML if data is available\r\n */\r\nfunction generateOpeningHours(properties: any): string {\r\n  const days = [\r\n    { key: 'maandag', label: 'Maandag' },\r\n    { key: 'dinsdag', label: 'Dinsdag' },\r\n    { key: 'woensdag', label: 'Woensdag' },\r\n    { key: 'donderdag', label: 'Donderdag' },\r\n    { key: 'vrijdag', label: 'Vrijdag' },\r\n    { key: 'zaterdag', label: 'Zaterdag' },\r\n    { key: 'zondag', label: 'Zondag' },\r\n  ];\r\n\r\n  // Check if any opening hours data exists\r\n  const hasOpeningHours = days.some((day) => properties[day.key] && properties[day.key].trim() !== '');\r\n\r\n  if (!hasOpeningHours) {\r\n    return '';\r\n  }\r\n\r\n  // Generate the opening hours HTML\r\n  let html = '<div class=\"popup-opening-hours\">';\r\n  html += '<h4 class=\"opening-hours-title\">Openingstijden</h4>';\r\n  html += '<div class=\"opening-hours-fade-top\"></div>';\r\n  html += '<div class=\"opening-hours-list\">';\r\n\r\n  days.forEach((day) => {\r\n    const hours = properties[day.key];\r\n    if (hours && hours.trim() !== '') {\r\n      html += `<div class=\"opening-hours-row\">`;\r\n      html += `<span class=\"day-label\">${day.label}:</span>`;\r\n      html += `<span class=\"hours-value\">${hours}</span>`;\r\n      html += `</div>`;\r\n    }\r\n  });\r\n\r\n  html += '</div>';\r\n  html += '<div class=\"opening-hours-fade-bottom\"></div>';\r\n  html += '</div>';\r\n\r\n  return html;\r\n}\r\n\r\nexport function createPopupContent(properties: any, coordinates?: [number, number]): { styles: string; html: string } {\r\n  const isAR = properties.type === 'ar';\r\n  const lang = detectLanguage();\r\n  const t = popupTranslations[lang];\r\n\r\n  // Common styles\r\n  const styles = `\r\n    <style>\r\n      .popup-side {\r\n        background-color: ${properties.color || '#6B46C1'};\r\n        clip-path: polygon(calc(100% - 0px) 26.5px, calc(100% - 0px) calc(100% - 26.5px), calc(100% - 0px) calc(100% - 26.5px), calc(100% - 0.34671999999995px) calc(100% - 22.20048px), calc(100% - 1.3505599999999px) calc(100% - 18.12224px), calc(100% - 2.95704px) calc(100% - 14.31976px), calc(100% - 5.11168px) calc(100% - 10.84752px), calc(100% - 7.76px) calc(100% - 7.76px), calc(100% - 10.84752px) calc(100% - 5.11168px), calc(100% - 14.31976px) calc(100% - 2.9570399999999px), calc(100% - 18.12224px) calc(100% - 1.35056px), calc(100% - 22.20048px) calc(100% - 0.34672px), calc(100% - 26.5px) calc(100% - 0px), calc(50% - -32.6px) calc(100% - 0px), calc(50% - -32.6px) calc(100% - 0px), calc(50% - -31.57121px) calc(100% - 0.057139999999947px), calc(50% - -30.56648px) calc(100% - 0.2255199999999px), calc(50% - -29.59427px) calc(100% - 0.50057999999996px), calc(50% - -28.66304px) calc(100% - 0.87775999999991px), calc(50% - -27.78125px) calc(100% - 1.3525px), calc(50% - -26.95736px) calc(100% - 1.92024px), calc(50% - -26.19983px) calc(100% - 2.57642px), calc(50% - -25.51712px) calc(100% - 3.31648px), calc(50% - -24.91769px) calc(100% - 4.13586px), calc(50% - -24.41px) calc(100% - 5.03px), calc(50% - -24.41px) calc(100% - 5.03px), calc(50% - -22.95654px) calc(100% - 7.6045699999999px), calc(50% - -21.23752px) calc(100% - 9.9929599999998px), calc(50% - -19.27298px) calc(100% - 12.17519px), calc(50% - -17.08296px) calc(100% - 14.13128px), calc(50% - -14.6875px) calc(100% - 15.84125px), calc(50% - -12.10664px) calc(100% - 17.28512px), calc(50% - -9.36042px) calc(100% - 18.44291px), calc(50% - -6.46888px) calc(100% - 19.29464px), calc(50% - -3.45206px) calc(100% - 19.82033px), calc(50% - -0.32999999999998px) calc(100% - 20px), calc(50% - -0.32999999999998px) calc(100% - 20px), calc(50% - 2.79179px) calc(100% - 19.82033px), calc(50% - 5.8079199999999px) calc(100% - 19.29464px), calc(50% - 8.69853px) calc(100% - 18.44291px), calc(50% - 11.44376px) calc(100% - 17.28512px), calc(50% - 14.02375px) calc(100% - 15.84125px), calc(50% - 16.41864px) calc(100% - 14.13128px), calc(50% - 18.60857px) calc(100% - 12.17519px), calc(50% - 20.57368px) calc(100% - 9.9929599999999px), calc(50% - 22.29411px) calc(100% - 7.60457px), calc(50% - 23.75px) calc(100% - 5.03px), calc(50% - 23.75px) calc(100% - 5.03px), calc(50% - 24.25769px) calc(100% - 4.1358599999999px), calc(50% - 24.85712px) calc(100% - 3.3164799999998px), calc(50% - 25.53983px) calc(100% - 2.57642px), calc(50% - 26.29736px) calc(100% - 1.92024px), calc(50% - 27.12125px) calc(100% - 1.3525px), calc(50% - 28.00304px) calc(100% - 0.87775999999997px), calc(50% - 28.93427px) calc(100% - 0.50057999999996px), calc(50% - 29.90648px) calc(100% - 0.22552000000002px), calc(50% - 30.91121px) calc(100% - 0.057140000000004px), calc(50% - 31.94px) calc(100% - 0px), 26.5px calc(100% - 0px), 26.5px calc(100% - 0px), 22.20048px calc(100% - 0.34671999999989px), 18.12224px calc(100% - 1.3505599999999px), 14.31976px calc(100% - 2.95704px), 10.84752px calc(100% - 5.1116799999999px), 7.76px calc(100% - 7.76px), 5.11168px calc(100% - 10.84752px), 2.95704px calc(100% - 14.31976px), 1.35056px calc(100% - 18.12224px), 0.34672px calc(100% - 22.20048px), 4.3855735949631E-31px calc(100% - 26.5px), 0px 26.5px, 0px 26.5px, 0.34672px 22.20048px, 1.35056px 18.12224px, 2.95704px 14.31976px, 5.11168px 10.84752px, 7.76px 7.76px, 10.84752px 5.11168px, 14.31976px 2.95704px, 18.12224px 1.35056px, 22.20048px 0.34672px, 26.5px 4.3855735949631E-31px, calc(50% - 26.74px) 0px, calc(50% - 26.74px) 0px, calc(50% - 25.31263px) 0.07137px, calc(50% - 23.91544px) 0.28176px, calc(50% - 22.55581px) 0.62559px, calc(50% - 21.24112px) 1.09728px, calc(50% - 19.97875px) 1.69125px, calc(50% - 18.77608px) 2.40192px, calc(50% - 17.64049px) 3.22371px, calc(50% - 16.57936px) 4.15104px, calc(50% - 15.60007px) 5.17833px, calc(50% - 14.71px) 6.3px, calc(50% - 14.71px) 6.3px, calc(50% - 13.6371px) 7.64798px, calc(50% - 12.446px) 8.89024px, calc(50% - 11.1451px) 10.01826px, calc(50% - 9.7428px) 11.02352px, calc(50% - 8.2475px) 11.8975px, calc(50% - 6.6676px) 12.63168px, calc(50% - 5.0115px) 13.21754px, calc(50% - 3.2876px) 13.64656px, calc(50% - 1.5043px) 13.91022px, calc(50% - -0.32999999999996px) 14px, calc(50% - -0.32999999999998px) 14px, calc(50% - -2.16431px) 13.9105px, calc(50% - -3.94768px) 13.6476px, calc(50% - -5.67177px) 13.2197px, calc(50% - -7.32824px) 12.6352px, calc(50% - -8.90875px) 11.9025px, calc(50% - -10.40496px) 11.03px, calc(50% - -11.80853px) 10.0261px, calc(50% - -13.11112px) 8.8992px, calc(50% - -14.30439px) 7.6577px, calc(50% - -15.38px) 6.31px, calc(50% - -15.38px) 6.31px, calc(50% - -16.27279px) 5.18562px, calc(50% - -17.25432px) 4.15616px, calc(50% - -18.31733px) 3.22714px, calc(50% - -19.45456px) 2.40408px, calc(50% - -20.65875px) 1.6925px, calc(50% - -21.92264px) 1.09792px, calc(50% - -23.23897px) 0.62586px, calc(50% - -24.60048px) 0.28184px, calc(50% - -25.99991px) 0.07138px, calc(50% - -27.43px) 8.9116630386686E-32px, calc(100% - 26.5px) 0px, calc(100% - 26.5px) 0px, calc(100% - 22.20048px) 0.34672px, calc(100% - 18.12224px) 1.35056px, calc(100% - 14.31976px) 2.95704px, calc(100% - 10.84752px) 5.11168px, calc(100% - 7.76px) 7.76px, calc(100% - 5.11168px) 10.84752px, calc(100% - 2.9570399999999px) 14.31976px, calc(100% - 1.35056px) 18.12224px, calc(100% - 0.34671999999995px) 22.20048px, calc(100% - 5.6843418860808E-14px) 26.5px);\r\n      }\r\n       \r\n    \r\n.fade-bottom {\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 3.5em;\r\n  /* Gebruik dezelfde kleur als de popup maar met transparantie */\r\n  background: linear-gradient(to top, ${properties.color ? hexToRgba(properties.color, 1) : 'transparent'} 0%, transparent 100%);\r\n  pointer-events: none;\r\n  z-index: 10;\r\n  transition: opacity 0.3s ease;\r\n}\r\n\r\n.popup-side.ar .fade-bottom {\r\n  background: linear-gradient(to top, ${hexToRgba(properties.arkleur || '#fff200', 1)} 0%, ${hexToRgba(properties.arkleur || '#fff200', 0)} 100%);\r\n}\r\n\r\n/* CSS voor de top fade gradient */\r\n.fade-top {\r\n  position: absolute;\r\n  top: -0.5em;\r\n  left: 0;\r\n  right: 0;\r\n  height: 3.5em;\r\n  /* Gespiegelde gradient vergeleken met de bottom fade */\r\n  background: linear-gradient(to bottom, ${properties.color ? hexToRgba(properties.color, 1) : 'transparent'} 0%, transparent 100%);\r\n  pointer-events: none;\r\n  z-index: 10;\r\n  transition: opacity 0.3s ease;\r\n}\r\n\r\n/* Voor AR-popups een aparte styling */\r\n.popup-side.ar .fade-top {\r\n  background: linear-gradient(to bottom, ${hexToRgba(properties.arkleur || '#fff200', 1)} 0%, ${hexToRgba(properties.arkleur || '#fff200', 0)} 100%);\r\n}\r\n\r\n    .close-button {\r\n      background: ${properties.color || '#6B46C1'};\r\n    }\r\n    \r\n    /* Stijlen voor AR popup - met zwarte tekst */\r\n    .popup-side.ar {\r\n      background-color: ${properties.arkleur || '#fff200'};\r\n      color: #000000;\r\n    }\r\n    \r\n    .close-button.ar {\r\n      background: ${properties.arkleur || '#fff200'};\r\n    }\r\n    \r\n    /* Kleur aanpassingen voor AR elementen */\r\n    .popup-side.ar .popup-title {\r\n      color: #000000;\r\n    }\r\n    \r\n    .popup-side.ar .popup-description {\r\n      color: #000000;\r\n    }\r\n    \r\n    /* Knoppen in AR popup */\r\n    .popup-side.ar .button-base {\r\n      color: #000000;\r\n      border-color: #000000;\r\n    }\r\n    \r\n    /* Styling voor achterkant van de popup */\r\n    .popup-side.ar.popup-back {\r\n      color: #000000;\r\n      background-color: ${properties.arkleur || '#fff200'};\r\n    }\r\n    \r\n    /* Zwarte tekst in AR popup details */\r\n    .popup-side.ar .popup-title.details {\r\n      color: #000000;\r\n    }\r\n    \r\n    /* Maak ook de 'X' in de sluitknop zwart */\r\n    .close-button.ar::before,\r\n    .close-button.ar::after {\r\n      background-color: #000000;\r\n    }\r\n    \r\n    ${\r\n      isAR\r\n        ? `\r\n      .ar-button {\r\n        border: 2px solid black;\r\n        font-weight: bold;\r\n        color: #000000;\r\n      }\r\n      .ar-description {\r\n        font-size: 0.9em;\r\n        margin-top: 10px;\r\n        color: #000000;\r\n      }\r\n    `\r\n        : ''\r\n    }\r\n  </style>\r\n  `;\r\n\r\n  // Different HTML structure for AR vs regular locations\r\n  if (isAR) {\r\n    return {\r\n      styles,\r\n      html: `\r\n      <div class=\"popup-wrapper\">\r\n        <button class=\"close-button ar\" aria-label=\"${t.aria.closePopup}\"></button>\r\n        <div class=\"popup-side ar popup-front\">\r\n          <svg class=\"popup-border-overlay\" viewBox=\"0 0 364.22 252\" preserveAspectRatio=\"xMidYMid slice\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M0 227.13V240.82C0 246.99 5 252 11.18 252H19.2C25.38 252 30.38 246.99 30.38 240.82C30.38 246.99 35.4 252 41.56 252H49.6C55.75 252 60.75 247.01 60.76 240.85C60.79 247.01 65.79 252 71.94 252H79.98C86.15 252 91.16 246.99 91.16 240.82C91.16 246.99 96.16 252 102.34 252H110.36C116.53 252 121.53 247.01 121.54 240.84C121.55 247.01 126.55 252 132.72 252H140.74C146.35 252 150.99 247.87 151.79 242.48C152.6 247.87 157.24 252 162.85 252H170.87C177.04 252 182.04 247 182.05 240.84C182.06 247 187.06 252 193.23 252H201.25C207.03 252 211.78 247.62 212.36 242C212.95 247.62 217.7 252 223.48 252H231.5C237.68 252 242.68 246.99 242.68 240.82C242.68 246.99 247.69 252 253.86 252H261.89C268.05 252 273.05 247.01 273.06 240.85C273.08 247.01 278.08 252 284.24 252H292.27C298.44 252 303.45 246.99 303.45 240.82C303.45 246.99 308.46 252 314.63 252H322.66C328.82 252 333.82 247.01 333.83 240.84C333.85 247.01 338.85 252 345.01 252H353.04C359.21 252 364.22 246.99 364.22 240.82V227.13C364.22 220.95 359.21 215.95 353.04 215.95C359.21 215.95 364.22 210.94 364.22 204.77V191.07C364.22 184.9 359.21 179.89 353.04 179.89C359.21 179.89 364.22 174.89 364.22 168.71V155.02C364.22 149.52 360.25 144.96 355.02 144.03C360.25 143.09 364.22 138.53 364.22 133.03V119.34C364.22 113.17 359.22 108.17 353.06 108.16C359.22 108.16 364.22 103.15 364.22 96.98V83.29C364.22 77.11 359.21 72.11 353.04 72.11C359.21 72.11 364.22 67.1 364.22 60.93V47.23C364.22 41.06 359.21 36.05 353.04 36.05C359.21 36.05 364.22 31.05 364.22 24.87V11.18C364.22 5.01 359.21 0 353.04 0H345.01C338.85 0 333.85 4.99 333.83 11.16C333.82 4.99 328.82 0 322.66 0H314.63C308.46 0 303.45 5.01 303.45 11.18C303.45 5.01 298.44 0 292.27 0H284.24C278.08 0 273.08 4.99 273.06 11.16C273.05 4.99 268.05 0 261.89 0H253.86C247.69 0 242.68 5.01 242.68 11.18C242.68 5.01 237.68 0 231.5 0H223.48C217.7 0 212.95 4.38 212.36 10C211.78 4.38 207.03 0 201.25 0H193.23C187.06 0 182.06 5 182.05 11.16C182.04 5 177.04 0 170.87 0H162.85C157.24 0 152.6 4.13 151.79 9.52C150.99 4.13 146.35 0 140.74 0H132.72C126.55 0 121.55 4.99 121.54 11.16C121.53 4.99 116.53 0 110.36 0H102.34C96.16 0 91.16 5.01 91.16 11.18C91.16 5.01 86.15 0 79.98 0H71.94C65.79 0 60.79 4.99 60.76 11.16C60.75 4.99 55.75 0 49.6 0H41.56C35.4 0 30.38 5.01 30.38 11.18C30.38 5.01 25.38 0 19.2 0H11.18C5 0 0 5.01 0 11.18V24.87C0 31.05 5 36.05 11.18 36.05C5 36.05 0 41.06 0 47.23V60.93C0 67.1 5 72.11 11.18 72.11C5 72.11 0 77.11 0 83.29V96.98C0 103.15 4.99 108.15 11.16 108.16C4.99 108.17 0 113.17 0 119.34V133.03C0 138.53 3.97 143.09 9.19 144.03C3.97 144.96 0 149.52 0 155.02V168.71C0 174.89 5 179.89 11.18 179.89C5 179.89 0 184.9 0 191.07V204.77C0 210.94 5 215.95 11.18 215.95C5 215.95 0 220.95 0 227.13ZM333.83 24.89C333.85 31.06 338.85 36.05 345.01 36.05C338.85 36.05 333.85 41.05 333.83 47.21C333.82 41.05 328.82 36.05 322.66 36.05C328.82 36.05 333.82 31.06 333.83 24.89ZM333.83 60.95C333.85 67.11 338.85 72.11 345.01 72.11C338.85 72.11 333.85 77.1 333.83 83.27C333.82 77.1 328.82 72.11 322.66 72.11C328.82 72.11 333.82 67.11 333.83 60.95ZM333.83 119.32C333.82 113.16 328.83 108.17 322.68 108.16C328.83 108.16 333.82 103.16 333.83 97C333.85 103.16 338.83 108.15 344.99 108.16C338.83 108.17 333.85 113.16 333.83 119.32ZM343.03 144.03C337.81 144.96 333.84 149.51 333.83 155C333.82 149.51 329.86 144.96 324.64 144.03C329.86 143.09 333.82 138.54 333.83 133.05C333.83 138.54 337.81 143.09 343.03 144.03ZM333.83 168.73C333.85 174.9 338.85 179.89 345.01 179.89C338.85 179.89 333.85 184.89 333.83 191.05C333.82 184.89 328.82 179.89 322.66 179.89C328.82 179.89 333.82 174.9 333.83 168.73ZM333.83 204.79C333.85 210.95 338.85 215.95 345.01 215.95C338.85 215.95 333.85 220.94 333.83 227.11C333.82 220.94 328.82 215.95 322.66 215.95C328.82 215.95 333.82 210.95 333.83 204.79ZM303.45 24.87C303.45 31.05 308.46 36.05 314.63 36.05C308.46 36.05 303.45 41.06 303.45 47.23C303.45 41.06 298.44 36.05 292.27 36.05C298.44 36.05 303.45 31.05 303.45 24.87ZM303.45 60.93C303.45 67.1 308.46 72.11 314.63 72.11C308.46 72.11 303.45 77.11 303.45 83.29C303.45 77.11 298.44 72.11 292.27 72.11C298.44 72.11 303.45 67.1 303.45 60.93ZM303.45 119.34C303.45 113.17 298.45 108.17 292.29 108.16C298.45 108.16 303.45 103.15 303.45 96.98C303.45 103.15 308.45 108.15 314.61 108.16C308.45 108.17 303.45 113.17 303.45 119.34ZM312.64 144.03C307.42 144.96 303.45 149.52 303.45 155.02C303.45 149.52 299.48 144.96 294.25 144.03C299.48 143.09 303.45 138.53 303.45 133.03C303.45 138.53 307.42 143.09 312.64 144.03ZM303.45 168.71C303.45 174.89 308.46 179.89 314.63 179.89C308.46 179.89 303.45 184.9 303.45 191.07C303.45 184.9 298.44 179.89 292.27 179.89C298.44 179.89 303.45 174.89 303.45 168.71ZM303.45 204.77C303.45 210.94 308.46 215.95 314.63 215.95C308.46 215.95 303.45 220.95 303.45 227.13C303.45 220.95 298.44 215.95 292.27 215.95C298.44 215.95 303.45 210.94 303.45 204.77ZM273.06 24.9C273.08 31.06 278.08 36.05 284.24 36.05C278.08 36.05 273.08 41.05 273.06 47.21C273.05 41.05 268.05 36.05 261.89 36.05C268.05 36.05 273.05 31.06 273.06 24.9ZM273.06 60.95C273.08 67.11 278.08 72.11 284.24 72.11C278.08 72.11 273.08 77.1 273.06 83.26C273.05 77.1 268.05 72.11 261.89 72.11C268.05 72.11 273.05 67.11 273.06 60.95ZM273.06 119.31C273.05 113.16 268.06 108.17 261.91 108.16C268.06 108.16 273.05 103.16 273.06 97.01C273.08 103.16 278.07 108.15 284.22 108.16C278.07 108.17 273.08 113.16 273.06 119.31ZM282.26 144.03C277.04 144.96 273.08 149.51 273.06 154.99C273.05 149.51 269.09 144.96 263.87 144.03C269.09 143.09 273.05 138.54 273.06 133.06C273.08 138.54 277.04 143.09 282.26 144.03ZM273.06 168.74C273.08 174.9 278.08 179.89 284.24 179.89C278.08 179.89 273.08 184.89 273.06 191.05C273.05 184.89 268.05 179.89 261.89 179.89C268.05 179.89 273.05 174.9 273.06 168.74ZM273.06 204.79C273.08 210.95 278.08 215.95 284.24 215.95C278.08 215.95 273.08 220.94 273.06 227.1C273.05 220.94 268.05 215.95 261.89 215.95C268.05 215.95 273.05 210.95 273.06 204.79ZM242.68 24.87C242.68 31.05 247.69 36.05 253.86 36.05C247.69 36.05 242.68 41.06 242.68 47.23C242.68 41.06 237.68 36.05 231.5 36.05C237.68 36.05 242.68 31.05 242.68 24.87ZM242.68 60.93C242.68 67.1 247.69 72.11 253.86 72.11C247.69 72.11 242.68 77.11 242.68 83.29C242.68 77.11 237.68 72.11 231.5 72.11C237.68 72.11 242.68 67.1 242.68 60.93ZM242.68 119.34C242.68 113.17 237.69 108.17 231.52 108.16C237.69 108.16 242.68 103.15 242.68 96.98C242.68 103.15 247.68 108.15 253.84 108.16C247.68 108.17 242.68 113.17 242.68 119.34ZM251.87 144.03C246.65 144.96 242.68 149.52 242.68 155.02C242.68 149.52 238.71 144.96 233.49 144.03C238.71 143.09 242.68 138.53 242.68 133.03C242.68 138.53 246.65 143.09 251.87 144.03ZM242.68 168.71C242.68 174.89 247.69 179.89 253.86 179.89C247.69 179.89 242.68 184.9 242.68 191.07C242.68 184.9 237.68 179.89 231.5 179.89C237.68 179.89 242.68 174.89 242.68 168.71ZM242.68 204.77C242.68 210.94 247.69 215.95 253.86 215.95C247.69 215.95 242.68 220.95 242.68 227.13C242.68 220.95 237.68 215.95 231.5 215.95C237.68 215.95 242.68 210.94 242.68 204.77ZM212.36 26.05C212.95 31.68 217.7 36.05 223.48 36.05C217.7 36.05 212.95 40.43 212.36 46.05C211.78 40.43 207.03 36.05 201.25 36.05C207.03 36.05 211.78 31.68 212.36 26.05ZM212.36 62.11C212.95 67.73 217.7 72.11 223.48 72.11C217.7 72.11 212.95 76.48 212.36 82.11C211.78 76.48 207.03 72.11 201.25 72.11C207.03 72.11 211.78 67.73 212.36 62.11ZM212.36 118.16C211.78 112.54 207.04 108.17 201.28 108.16C207.04 108.16 211.78 103.78 212.36 98.16C212.95 103.78 217.69 108.15 223.46 108.16C217.69 108.17 212.95 112.54 212.36 118.16ZM221.49 144.03C216.64 144.89 212.88 148.88 212.36 153.85C211.86 148.88 208.1 144.89 203.24 144.03C208.1 143.16 211.86 139.17 212.36 134.2C212.88 139.17 216.64 143.16 221.49 144.03ZM212.36 169.89C212.95 175.52 217.7 179.89 223.48 179.89C217.7 179.89 212.95 184.27 212.36 189.89C211.78 184.27 207.03 179.89 201.25 179.89C207.03 179.89 211.78 175.52 212.36 169.89ZM212.36 205.95C212.95 211.57 217.7 215.95 223.48 215.95C217.7 215.95 212.95 220.32 212.36 225.95C211.78 220.32 207.03 215.95 201.25 215.95C207.03 215.95 211.78 211.57 212.36 205.95ZM182.05 24.89C182.06 31.06 187.06 36.05 193.23 36.05C187.06 36.05 182.06 41.05 182.05 47.22C182.04 41.05 177.04 36.05 170.87 36.05C177.04 36.05 182.04 31.06 182.05 24.89ZM182.05 60.95C182.06 67.11 187.06 72.11 193.23 72.11C187.06 72.11 182.06 77.1 182.05 83.27C182.04 77.1 177.04 72.11 170.87 72.11C177.04 72.11 182.04 67.11 182.05 60.95ZM182.05 119.32C182.04 113.16 177.05 108.17 170.9 108.16C177.05 108.16 182.04 103.16 182.05 97C182.06 103.16 187.05 108.15 193.22 108.16C187.05 108.17 182.06 113.16 182.05 119.32ZM191.24 144.03C186.03 144.96 182.06 149.51 182.05 155C182.04 149.51 178.09 144.96 172.86 144.03C178.09 143.09 182.04 138.54 182.05 133.05C182.06 138.54 186.03 143.09 191.24 144.03ZM182.05 168.73C182.06 174.9 187.06 179.89 193.23 179.89C187.06 179.89 182.06 184.89 182.05 191.05C182.04 184.89 177.04 179.89 170.87 179.89C177.04 179.89 182.04 174.9 182.05 168.73ZM182.05 204.79C182.06 210.95 187.06 215.95 193.23 215.95C187.06 215.95 182.06 220.94 182.05 227.11C182.04 220.94 177.04 215.95 170.87 215.95C177.04 215.95 182.04 210.95 182.05 204.79ZM151.79 26.53C152.6 31.92 157.24 36.05 162.85 36.05C157.24 36.05 152.6 40.18 151.79 45.57C150.99 40.18 146.35 36.05 140.74 36.05C146.35 36.05 150.99 31.92 151.79 26.53ZM151.79 62.59C152.6 67.98 157.24 72.11 162.85 72.11C157.24 72.11 152.6 76.24 151.79 81.63C150.99 76.24 146.35 72.11 140.74 72.11C146.35 72.11 150.99 67.98 151.79 62.59ZM151.79 117.68C151 112.3 146.36 108.17 140.76 108.16C146.36 108.16 151 104.02 151.79 98.64C152.6 104.02 157.23 108.15 162.84 108.16C157.23 108.17 152.6 112.3 151.79 117.68ZM160.86 144.03C156.18 144.86 152.5 148.62 151.79 153.35C151.1 148.62 147.41 144.86 142.73 144.03C147.41 143.19 151.1 139.43 151.79 134.7C152.5 139.43 156.18 143.19 160.86 144.03ZM151.79 170.37C152.6 175.76 157.24 179.89 162.85 179.89C157.24 179.89 152.6 184.02 151.79 189.41C150.99 184.02 146.35 179.89 140.74 179.89C146.35 179.89 150.99 175.76 151.79 170.37ZM151.79 206.43C152.6 211.82 157.24 215.95 162.85 215.95C157.24 215.95 152.6 220.08 151.79 225.47C150.99 220.08 146.35 215.95 140.74 215.95C146.35 215.95 150.99 211.82 151.79 206.43ZM121.54 24.89C121.55 31.06 126.55 36.05 132.72 36.05C126.55 36.05 121.55 41.05 121.54 47.21C121.53 41.05 116.53 36.05 110.36 36.05C116.53 36.05 121.53 31.06 121.54 24.89ZM121.54 60.95C121.55 67.11 126.55 72.11 132.72 72.11C126.55 72.11 121.55 77.1 121.54 83.27C121.53 77.1 116.53 72.11 110.36 72.11C116.53 72.11 121.53 67.11 121.54 60.95ZM121.54 119.32C121.53 113.16 116.54 108.17 110.38 108.16C116.54 108.16 121.53 103.16 121.54 97C121.55 103.16 126.54 108.15 132.69 108.16C126.54 108.17 121.55 113.16 121.54 119.32ZM130.73 144.03C125.51 144.96 121.54 149.51 121.54 155C121.53 149.51 117.56 144.96 112.35 144.03C117.56 143.09 121.53 138.54 121.54 133.05C121.54 138.54 125.51 143.09 130.73 144.03ZM121.54 168.73C121.55 174.9 126.55 179.89 132.72 179.89C126.55 179.89 121.55 184.89 121.54 191.05C121.53 184.89 116.53 179.89 110.36 179.89C116.53 179.89 121.53 174.9 121.54 168.73ZM121.54 204.79C121.55 210.95 126.55 215.95 132.72 215.95C126.55 215.95 121.55 220.94 121.54 227.11C121.53 220.94 116.53 215.95 110.36 215.95C116.53 215.95 121.53 210.95 121.54 204.79ZM91.16 24.87C91.16 31.05 96.16 36.05 102.34 36.05C96.16 36.05 91.16 41.06 91.16 47.23C91.16 41.06 86.15 36.05 79.98 36.05C86.15 36.05 91.16 31.05 91.16 24.87ZM91.16 60.93C91.16 67.1 96.16 72.11 102.34 72.11C96.16 72.11 91.16 77.11 91.16 83.29C91.16 77.11 86.15 72.11 79.98 72.11C86.15 72.11 91.16 67.1 91.16 60.93ZM91.16 119.34C91.16 113.17 86.16 108.17 79.99 108.16C86.16 108.16 91.16 103.15 91.16 96.98C91.16 103.15 96.16 108.15 102.31 108.16C96.16 108.17 91.16 113.17 91.16 119.34ZM100.35 144.03C95.12 144.96 91.16 149.52 91.16 155.02C91.16 149.52 87.18 144.96 81.95 144.03C87.18 143.09 91.16 138.53 91.16 133.03C91.16 138.53 95.12 143.09 100.35 144.03ZM91.16 168.71C91.16 174.89 96.16 179.89 102.34 179.89C96.16 179.89 91.16 184.9 91.16 191.07C91.16 184.9 86.15 179.89 79.98 179.89C86.15 179.89 91.16 174.89 91.16 168.71ZM91.16 204.77C91.16 210.94 96.16 215.95 102.34 215.95C96.16 215.95 91.16 220.95 91.16 227.13C91.16 220.95 86.15 215.95 79.98 215.95C86.15 215.95 91.16 210.94 91.16 204.77ZM60.76 24.9C60.79 31.06 65.79 36.05 71.94 36.05C65.79 36.05 60.79 41.05 60.76 47.21C60.75 41.05 55.75 36.05 49.6 36.05C55.75 36.05 60.75 31.06 60.76 24.9ZM60.76 60.95C60.79 67.11 65.79 72.11 71.94 72.11C65.79 72.11 60.79 77.1 60.76 83.26C60.75 77.1 55.75 72.11 49.6 72.11C55.75 72.11 60.75 67.11 60.76 60.95ZM60.76 119.31C60.75 113.16 55.76 108.17 49.61 108.16C55.76 108.16 60.75 103.16 60.76 97.01C60.79 103.16 65.78 108.15 71.92 108.16C65.78 108.17 60.79 113.16 60.76 119.31ZM69.97 144.03C64.74 144.96 60.79 149.51 60.76 154.99C60.75 149.51 56.79 144.96 51.57 144.03C56.79 143.09 60.75 138.54 60.76 133.06C60.79 138.54 64.74 143.09 69.97 144.03ZM60.76 168.74C60.79 174.9 65.79 179.89 71.94 179.89C65.79 179.89 60.79 184.89 60.76 191.05C60.75 184.89 55.75 179.89 49.6 179.89C55.75 179.89 60.75 174.9 60.76 168.74ZM60.76 204.79C60.79 210.95 65.79 215.95 71.94 215.95C65.79 215.95 60.79 220.94 60.76 227.1C60.75 220.94 55.75 215.95 49.6 215.95C55.75 215.95 60.75 210.95 60.76 204.79ZM30.38 24.87C30.38 31.05 35.4 36.05 41.56 36.05C35.4 36.05 30.38 41.06 30.38 47.23C30.38 41.06 25.38 36.05 19.2 36.05C25.38 36.05 30.38 31.05 30.38 24.87ZM30.38 60.93C30.38 67.1 35.4 72.11 41.56 72.11C35.4 72.11 30.38 77.11 30.38 83.29C30.38 77.11 25.38 72.11 19.2 72.11C25.38 72.11 30.38 67.1 30.38 60.93ZM30.38 119.34C30.38 113.17 25.4 108.17 19.23 108.16C25.4 108.16 30.38 103.15 30.38 96.98C30.38 103.15 35.38 108.15 41.54 108.16C35.38 108.17 30.38 113.17 30.38 119.34ZM39.57 144.03C34.35 144.96 30.38 149.52 30.38 155.02C30.38 149.52 26.41 144.96 21.19 144.03C26.41 143.09 30.38 138.53 30.38 133.03C30.38 138.53 34.35 143.09 39.57 144.03ZM30.38 168.71C30.38 174.89 35.4 179.89 41.56 179.89C35.4 179.89 30.38 184.9 30.38 191.07C30.38 184.9 25.38 179.89 19.2 179.89C25.38 179.89 30.38 174.89 30.38 168.71ZM30.38 204.77C30.38 210.94 35.4 215.95 41.56 215.95C35.4 215.95 30.38 220.95 30.38 227.13C30.38 220.95 25.38 215.95 19.2 215.95C25.38 215.95 30.38 210.94 30.38 204.77Z\" fill=\"url(#paint0_linear_3248_5)\"/>\r\n              <defs>\r\n              <linearGradient id=\"paint0_linear_3248_5\" x1=\"182.11\" y1=\"0\" x2=\"182.11\" y2=\"252\" gradientUnits=\"userSpaceOnUse\">\r\n                <stop offset=\"0\" stop-color=\"${properties.arkleur || '#fff200'}\" stop-opacity=\"0\" />\r\n                <stop offset=\"0.15\" stop-color=\"${properties.arkleur || '#fff200'}\" stop-opacity=\"0\" />\r\n                <stop offset=\"0.45\" stop-color=\"${properties.arkleur || '#fff200'}\" stop-opacity=\"1\" />\r\n                <stop offset=\"1\" stop-color=\"${properties.arkleur || '#fff200'}\" stop-opacity=\"1\" />\r\n              </linearGradient>\r\n            </defs>\r\n          </svg>\r\n          ${properties.image ? `<img src=\"${properties.image}\" class=\"popup-background-image\" alt=\"\">` : ''}\r\n          <div class=\"content-wrapper\">\r\n            <div class=\"popup-title\">${properties.name}</div>\r\n            <div class=\"popup-description-wrapper\">\r\n              <div class=\"fade-top\"></div>\r\n              <div class=\"popup-description\">${properties.description}</div>\r\n              <div class=\"fade-bottom\"></div>\r\n            </div>\r\n${properties.image ? createARButton(properties) : ''}\r\n            <button class=\"more-info-button button-base\">${t.buttons.instruction}</button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"popup-side ar popup-back\">\r\n          <div class=\"content-wrapper\">\r\n            <div class=\"popup-ar-instructie\">${properties.instructie || t.messages.defaultARInstruction}</div>\r\n            <button class=\"more-info-button button-base\">${t.buttons.back}</button>\r\n${createARButton(properties, 'impressie-button button-base')}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      `,\r\n    };\r\n  }\r\n  // Regular location popup\r\n  return {\r\n    styles,\r\n    html: `\r\n        <div class=\"popup-wrapper\">\r\n          <button class=\"close-button\" aria-label=\"${t.aria.closePopup}\"></button>\r\n          <div class=\"popup-side popup-front\">\r\n            <svg class=\"popup-border-overlay\" viewBox=\"0 0 364.22 252\" preserveAspectRatio=\"xMidYMid slice\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<path d=\"M0 227.13V240.82C0 246.99 5 252 11.18 252H19.2C25.38 252 30.38 246.99 30.38 240.82C30.38 246.99 35.4 252 41.56 252H49.6C55.75 252 60.75 247.01 60.76 240.85C60.79 247.01 65.79 252 71.94 252H79.98C86.15 252 91.16 246.99 91.16 240.82C91.16 246.99 96.16 252 102.34 252H110.36C116.53 252 121.53 247.01 121.54 240.84C121.55 247.01 126.55 252 132.72 252H140.74C146.35 252 150.99 247.87 151.79 242.48C152.6 247.87 157.24 252 162.85 252H170.87C177.04 252 182.04 247 182.05 240.84C182.06 247 187.06 252 193.23 252H201.25C207.03 252 211.78 247.62 212.36 242C212.95 247.62 217.7 252 223.48 252H231.5C237.68 252 242.68 246.99 242.68 240.82C242.68 246.99 247.69 252 253.86 252H261.89C268.05 252 273.05 247.01 273.06 240.85C273.08 247.01 278.08 252 284.24 252H292.27C298.44 252 303.45 246.99 303.45 240.82C303.45 246.99 308.46 252 314.63 252H322.66C328.82 252 333.82 247.01 333.83 240.84C333.85 247.01 338.85 252 345.01 252H353.04C359.21 252 364.22 246.99 364.22 240.82V227.13C364.22 220.95 359.21 215.95 353.04 215.95C359.21 215.95 364.22 210.94 364.22 204.77V191.07C364.22 184.9 359.21 179.89 353.04 179.89C359.21 179.89 364.22 174.89 364.22 168.71V155.02C364.22 149.52 360.25 144.96 355.02 144.03C360.25 143.09 364.22 138.53 364.22 133.03V119.34C364.22 113.17 359.22 108.17 353.06 108.16C359.22 108.16 364.22 103.15 364.22 96.98V83.29C364.22 77.11 359.21 72.11 353.04 72.11C359.21 72.11 364.22 67.1 364.22 60.93V47.23C364.22 41.06 359.21 36.05 353.04 36.05C359.21 36.05 364.22 31.05 364.22 24.87V11.18C364.22 5.01 359.21 0 353.04 0H345.01C338.85 0 333.85 4.99 333.83 11.16C333.82 4.99 328.82 0 322.66 0H314.63C308.46 0 303.45 5.01 303.45 11.18C303.45 5.01 298.44 0 292.27 0H284.24C278.08 0 273.08 4.99 273.06 11.16C273.05 4.99 268.05 0 261.89 0H253.86C247.69 0 242.68 5.01 242.68 11.18C242.68 5.01 237.68 0 231.5 0H223.48C217.7 0 212.95 4.38 212.36 10C211.78 4.38 207.03 0 201.25 0H193.23C187.06 0 182.06 5 182.05 11.16C182.04 5 177.04 0 170.87 0H162.85C157.24 0 152.6 4.13 151.79 9.52C150.99 4.13 146.35 0 140.74 0H132.72C126.55 0 121.55 4.99 121.54 11.16C121.53 4.99 116.53 0 110.36 0H102.34C96.16 0 91.16 5.01 91.16 11.18C91.16 5.01 86.15 0 79.98 0H71.94C65.79 0 60.79 4.99 60.76 11.16C60.75 4.99 55.75 0 49.6 0H41.56C35.4 0 30.38 5.01 30.38 11.18C30.38 5.01 25.38 0 19.2 0H11.18C5 0 0 5.01 0 11.18V24.87C0 31.05 5 36.05 11.18 36.05C5 36.05 0 41.06 0 47.23V60.93C0 67.1 5 72.11 11.18 72.11C5 72.11 0 77.11 0 83.29V96.98C0 103.15 4.99 108.15 11.16 108.16C4.99 108.17 0 113.17 0 119.34V133.03C0 138.53 3.97 143.09 9.19 144.03C3.97 144.96 0 149.52 0 155.02V168.71C0 174.89 5 179.89 11.18 179.89C5 179.89 0 184.9 0 191.07V204.77C0 210.94 5 215.95 11.18 215.95C5 215.95 0 220.95 0 227.13ZM333.83 24.89C333.85 31.06 338.85 36.05 345.01 36.05C338.85 36.05 333.85 41.05 333.83 47.21C333.82 41.05 328.82 36.05 322.66 36.05C328.82 36.05 333.82 31.06 333.83 24.89ZM333.83 60.95C333.85 67.11 338.85 72.11 345.01 72.11C338.85 72.11 333.85 77.1 333.83 83.27C333.82 77.1 328.82 72.11 322.66 72.11C328.82 72.11 333.82 67.11 333.83 60.95ZM333.83 119.32C333.82 113.16 328.83 108.17 322.68 108.16C328.83 108.16 333.82 103.16 333.83 97C333.85 103.16 338.83 108.15 344.99 108.16C338.83 108.17 333.85 113.16 333.83 119.32ZM343.03 144.03C337.81 144.96 333.84 149.51 333.83 155C333.82 149.51 329.86 144.96 324.64 144.03C329.86 143.09 333.82 138.54 333.83 133.05C333.83 138.54 337.81 143.09 343.03 144.03ZM333.83 168.73C333.85 174.9 338.85 179.89 345.01 179.89C338.85 179.89 333.85 184.89 333.83 191.05C333.82 184.89 328.82 179.89 322.66 179.89C328.82 179.89 333.82 174.9 333.83 168.73ZM333.83 204.79C333.85 210.95 338.85 215.95 345.01 215.95C338.85 215.95 333.85 220.94 333.83 227.11C333.82 220.94 328.82 215.95 322.66 215.95C328.82 215.95 333.82 210.95 333.83 204.79ZM303.45 24.87C303.45 31.05 308.46 36.05 314.63 36.05C308.46 36.05 303.45 41.06 303.45 47.23C303.45 41.06 298.44 36.05 292.27 36.05C298.44 36.05 303.45 31.05 303.45 24.87ZM303.45 60.93C303.45 67.1 308.46 72.11 314.63 72.11C308.46 72.11 303.45 77.11 303.45 83.29C303.45 77.11 298.44 72.11 292.27 72.11C298.44 72.11 303.45 67.1 303.45 60.93ZM303.45 119.34C303.45 113.17 298.45 108.17 292.29 108.16C298.45 108.16 303.45 103.15 303.45 96.98C303.45 103.15 308.45 108.15 314.61 108.16C308.45 108.17 303.45 113.17 303.45 119.34ZM312.64 144.03C307.42 144.96 303.45 149.52 303.45 155.02C303.45 149.52 299.48 144.96 294.25 144.03C299.48 143.09 303.45 138.53 303.45 133.03C303.45 138.53 307.42 143.09 312.64 144.03ZM303.45 168.71C303.45 174.89 308.46 179.89 314.63 179.89C308.46 179.89 303.45 184.9 303.45 191.07C303.45 184.9 298.44 179.89 292.27 179.89C298.44 179.89 303.45 174.89 303.45 168.71ZM303.45 204.77C303.45 210.94 308.46 215.95 314.63 215.95C308.46 215.95 303.45 220.95 303.45 227.13C303.45 220.95 298.44 215.95 292.27 215.95C298.44 215.95 303.45 210.94 303.45 204.77ZM273.06 24.9C273.08 31.06 278.08 36.05 284.24 36.05C278.08 36.05 273.08 41.05 273.06 47.21C273.05 41.05 268.05 36.05 261.89 36.05C268.05 36.05 273.05 31.06 273.06 24.9ZM273.06 60.95C273.08 67.11 278.08 72.11 284.24 72.11C278.08 72.11 273.08 77.1 273.06 83.26C273.05 77.1 268.05 72.11 261.89 72.11C268.05 72.11 273.05 67.11 273.06 60.95ZM273.06 119.31C273.05 113.16 268.06 108.17 261.91 108.16C268.06 108.16 273.05 103.16 273.06 97.01C273.08 103.16 278.07 108.15 284.22 108.16C278.07 108.17 273.08 113.16 273.06 119.31ZM282.26 144.03C277.04 144.96 273.08 149.51 273.06 154.99C273.05 149.51 269.09 144.96 263.87 144.03C269.09 143.09 273.05 138.54 273.06 133.06C273.08 138.54 277.04 143.09 282.26 144.03ZM273.06 168.74C273.08 174.9 278.08 179.89 284.24 179.89C278.08 179.89 273.08 184.89 273.06 191.05C273.05 184.89 268.05 179.89 261.89 179.89C268.05 179.89 273.05 174.9 273.06 168.74ZM273.06 204.79C273.08 210.95 278.08 215.95 284.24 215.95C278.08 215.95 273.08 220.94 273.06 227.1C273.05 220.94 268.05 215.95 261.89 215.95C268.05 215.95 273.05 210.95 273.06 204.79ZM242.68 24.87C242.68 31.05 247.69 36.05 253.86 36.05C247.69 36.05 242.68 41.06 242.68 47.23C242.68 41.06 237.68 36.05 231.5 36.05C237.68 36.05 242.68 31.05 242.68 24.87ZM242.68 60.93C242.68 67.1 247.69 72.11 253.86 72.11C247.69 72.11 242.68 77.11 242.68 83.29C242.68 77.11 237.68 72.11 231.5 72.11C237.68 72.11 242.68 67.1 242.68 60.93ZM242.68 119.34C242.68 113.17 237.69 108.17 231.52 108.16C237.69 108.16 242.68 103.15 242.68 96.98C242.68 103.15 247.68 108.15 253.84 108.16C247.68 108.17 242.68 113.17 242.68 119.34ZM251.87 144.03C246.65 144.96 242.68 149.52 242.68 155.02C242.68 149.52 238.71 144.96 233.49 144.03C238.71 143.09 242.68 138.53 242.68 133.03C242.68 138.53 246.65 143.09 251.87 144.03ZM242.68 168.71C242.68 174.89 247.69 179.89 253.86 179.89C247.69 179.89 242.68 184.9 242.68 191.07C242.68 184.9 237.68 179.89 231.5 179.89C237.68 179.89 242.68 174.89 242.68 168.71ZM242.68 204.77C242.68 210.94 247.69 215.95 253.86 215.95C247.69 215.95 242.68 220.95 242.68 227.13C242.68 220.95 237.68 215.95 231.5 215.95C237.68 215.95 242.68 210.94 242.68 204.77ZM212.36 26.05C212.95 31.68 217.7 36.05 223.48 36.05C217.7 36.05 212.95 40.43 212.36 46.05C211.78 40.43 207.03 36.05 201.25 36.05C207.03 36.05 211.78 31.68 212.36 26.05ZM212.36 62.11C212.95 67.73 217.7 72.11 223.48 72.11C217.7 72.11 212.95 76.48 212.36 82.11C211.78 76.48 207.03 72.11 201.25 72.11C207.03 72.11 211.78 67.73 212.36 62.11ZM212.36 118.16C211.78 112.54 207.04 108.17 201.28 108.16C207.04 108.16 211.78 103.78 212.36 98.16C212.95 103.78 217.69 108.15 223.46 108.16C217.69 108.17 212.95 112.54 212.36 118.16ZM221.49 144.03C216.64 144.89 212.88 148.88 212.36 153.85C211.86 148.88 208.1 144.89 203.24 144.03C208.1 143.16 211.86 139.17 212.36 134.2C212.88 139.17 216.64 143.16 221.49 144.03ZM212.36 169.89C212.95 175.52 217.7 179.89 223.48 179.89C217.7 179.89 212.95 184.27 212.36 189.89C211.78 184.27 207.03 179.89 201.25 179.89C207.03 179.89 211.78 175.52 212.36 169.89ZM212.36 205.95C212.95 211.57 217.7 215.95 223.48 215.95C217.7 215.95 212.95 220.32 212.36 225.95C211.78 220.32 207.03 215.95 201.25 215.95C207.03 215.95 211.78 211.57 212.36 205.95ZM182.05 24.89C182.06 31.06 187.06 36.05 193.23 36.05C187.06 36.05 182.06 41.05 182.05 47.22C182.04 41.05 177.04 36.05 170.87 36.05C177.04 36.05 182.04 31.06 182.05 24.89ZM182.05 60.95C182.06 67.11 187.06 72.11 193.23 72.11C187.06 72.11 182.06 77.1 182.05 83.27C182.04 77.1 177.04 72.11 170.87 72.11C177.04 72.11 182.04 67.11 182.05 60.95ZM182.05 119.32C182.04 113.16 177.05 108.17 170.9 108.16C177.05 108.16 182.04 103.16 182.05 97C182.06 103.16 187.05 108.15 193.22 108.16C187.05 108.17 182.06 113.16 182.05 119.32ZM191.24 144.03C186.03 144.96 182.06 149.51 182.05 155C182.04 149.51 178.09 144.96 172.86 144.03C178.09 143.09 182.04 138.54 182.05 133.05C182.06 138.54 186.03 143.09 191.24 144.03ZM182.05 168.73C182.06 174.9 187.06 179.89 193.23 179.89C187.06 179.89 182.06 184.89 182.05 191.05C182.04 184.89 177.04 179.89 170.87 179.89C177.04 179.89 182.04 174.9 182.05 168.73ZM182.05 204.79C182.06 210.95 187.06 215.95 193.23 215.95C187.06 215.95 182.06 220.94 182.05 227.11C182.04 220.94 177.04 215.95 170.87 215.95C177.04 215.95 182.04 210.95 182.05 204.79ZM151.79 26.53C152.6 31.92 157.24 36.05 162.85 36.05C157.24 36.05 152.6 40.18 151.79 45.57C150.99 40.18 146.35 36.05 140.74 36.05C146.35 36.05 150.99 31.92 151.79 26.53ZM151.79 62.59C152.6 67.98 157.24 72.11 162.85 72.11C157.24 72.11 152.6 76.24 151.79 81.63C150.99 76.24 146.35 72.11 140.74 72.11C146.35 72.11 150.99 67.98 151.79 62.59ZM151.79 117.68C151 112.3 146.36 108.17 140.76 108.16C146.36 108.16 151 104.02 151.79 98.64C152.6 104.02 157.23 108.15 162.84 108.16C157.23 108.17 152.6 112.3 151.79 117.68ZM160.86 144.03C156.18 144.86 152.5 148.62 151.79 153.35C151.1 148.62 147.41 144.86 142.73 144.03C147.41 143.19 151.1 139.43 151.79 134.7C152.5 139.43 156.18 143.19 160.86 144.03ZM151.79 170.37C152.6 175.76 157.24 179.89 162.85 179.89C157.24 179.89 152.6 184.02 151.79 189.41C150.99 184.02 146.35 179.89 140.74 179.89C146.35 179.89 150.99 175.76 151.79 170.37ZM151.79 206.43C152.6 211.82 157.24 215.95 162.85 215.95C157.24 215.95 152.6 220.08 151.79 225.47C150.99 220.08 146.35 215.95 140.74 215.95C146.35 215.95 150.99 211.82 151.79 206.43ZM121.54 24.89C121.55 31.06 126.55 36.05 132.72 36.05C126.55 36.05 121.55 41.05 121.54 47.21C121.53 41.05 116.53 36.05 110.36 36.05C116.53 36.05 121.53 31.06 121.54 24.89ZM121.54 60.95C121.55 67.11 126.55 72.11 132.72 72.11C126.55 72.11 121.55 77.1 121.54 83.27C121.53 77.1 116.53 72.11 110.36 72.11C116.53 72.11 121.53 67.11 121.54 60.95ZM121.54 119.32C121.53 113.16 116.54 108.17 110.38 108.16C116.54 108.16 121.53 103.16 121.54 97C121.55 103.16 126.54 108.15 132.69 108.16C126.54 108.17 121.55 113.16 121.54 119.32ZM130.73 144.03C125.51 144.96 121.54 149.51 121.54 155C121.53 149.51 117.56 144.96 112.35 144.03C117.56 143.09 121.53 138.54 121.54 133.05C121.54 138.54 125.51 143.09 130.73 144.03ZM121.54 168.73C121.55 174.9 126.55 179.89 132.72 179.89C126.55 179.89 121.55 184.89 121.54 191.05C121.53 184.89 116.53 179.89 110.36 179.89C116.53 179.89 121.53 174.9 121.54 168.73ZM121.54 204.79C121.55 210.95 126.55 215.95 132.72 215.95C126.55 215.95 121.55 220.94 121.54 227.11C121.53 220.94 116.53 215.95 110.36 215.95C116.53 215.95 121.53 210.95 121.54 204.79ZM91.16 24.87C91.16 31.05 96.16 36.05 102.34 36.05C96.16 36.05 91.16 41.06 91.16 47.23C91.16 41.06 86.15 36.05 79.98 36.05C86.15 36.05 91.16 31.05 91.16 24.87ZM91.16 60.93C91.16 67.1 96.16 72.11 102.34 72.11C96.16 72.11 91.16 77.11 91.16 83.29C91.16 77.11 86.15 72.11 79.98 72.11C86.15 72.11 91.16 67.1 91.16 60.93ZM91.16 119.34C91.16 113.17 86.16 108.17 79.99 108.16C86.16 108.16 91.16 103.15 91.16 96.98C91.16 103.15 96.16 108.15 102.31 108.16C96.16 108.17 91.16 113.17 91.16 119.34ZM100.35 144.03C95.12 144.96 91.16 149.52 91.16 155.02C91.16 149.52 87.18 144.96 81.95 144.03C87.18 143.09 91.16 138.53 91.16 133.03C91.16 138.53 95.12 143.09 100.35 144.03ZM91.16 168.71C91.16 174.89 96.16 179.89 102.34 179.89C96.16 179.89 91.16 184.9 91.16 191.07C91.16 184.9 86.15 179.89 79.98 179.89C86.15 179.89 91.16 174.89 91.16 168.71ZM91.16 204.77C91.16 210.94 96.16 215.95 102.34 215.95C96.16 215.95 91.16 220.95 91.16 227.13C91.16 220.95 86.15 215.95 79.98 215.95C86.15 215.95 91.16 210.94 91.16 204.77ZM60.76 24.9C60.79 31.06 65.79 36.05 71.94 36.05C65.79 36.05 60.79 41.05 60.76 47.21C60.75 41.05 55.75 36.05 49.6 36.05C55.75 36.05 60.75 31.06 60.76 24.9ZM60.76 60.95C60.79 67.11 65.79 72.11 71.94 72.11C65.79 72.11 60.79 77.1 60.76 83.26C60.75 77.1 55.75 72.11 49.6 72.11C55.75 72.11 60.75 67.11 60.76 60.95ZM60.76 119.31C60.75 113.16 55.76 108.17 49.61 108.16C55.76 108.16 60.75 103.16 60.76 97.01C60.79 103.16 65.78 108.15 71.92 108.16C65.78 108.17 60.79 113.16 60.76 119.31ZM69.97 144.03C64.74 144.96 60.79 149.51 60.76 154.99C60.75 149.51 56.79 144.96 51.57 144.03C56.79 143.09 60.75 138.54 60.76 133.06C60.79 138.54 64.74 143.09 69.97 144.03ZM60.76 168.74C60.79 174.9 65.79 179.89 71.94 179.89C65.79 179.89 60.79 184.89 60.76 191.05C60.75 184.89 55.75 179.89 49.6 179.89C55.75 179.89 60.75 174.9 60.76 168.74ZM60.76 204.79C60.79 210.95 65.79 215.95 71.94 215.95C65.79 215.95 60.79 220.94 60.76 227.1C60.75 220.94 55.75 215.95 49.6 215.95C55.75 215.95 60.75 210.95 60.76 204.79ZM30.38 24.87C30.38 31.05 35.4 36.05 41.56 36.05C35.4 36.05 30.38 41.06 30.38 47.23C30.38 41.06 25.38 36.05 19.2 36.05C25.38 36.05 30.38 31.05 30.38 24.87ZM30.38 60.93C30.38 67.1 35.4 72.11 41.56 72.11C35.4 72.11 30.38 77.11 30.38 83.29C30.38 77.11 25.38 72.11 19.2 72.11C25.38 72.11 30.38 67.1 30.38 60.93ZM30.38 119.34C30.38 113.17 25.4 108.17 19.23 108.16C25.4 108.16 30.38 103.15 30.38 96.98C30.38 103.15 35.38 108.15 41.54 108.16C35.38 108.17 30.38 113.17 30.38 119.34ZM39.57 144.03C34.35 144.96 30.38 149.52 30.38 155.02C30.38 149.52 26.41 144.96 21.19 144.03C26.41 143.09 30.38 138.53 30.38 133.03C30.38 138.53 34.35 143.09 39.57 144.03ZM30.38 168.71C30.38 174.89 35.4 179.89 41.56 179.89C35.4 179.89 30.38 184.9 30.38 191.07C30.38 184.9 25.38 179.89 19.2 179.89C25.38 179.89 30.38 174.89 30.38 168.71ZM30.38 204.77C30.38 210.94 35.4 215.95 41.56 215.95C35.4 215.95 30.38 220.95 30.38 227.13C30.38 220.95 25.38 215.95 19.2 215.95C25.38 215.95 30.38 210.94 30.38 204.77Z\" fill=\"url(#paint0_linear_3248_5)\"/>\r\n              <defs>\r\n                <linearGradient id=\"paint0_linear_3248_5\" x1=\"182.11\" y1=\"0\" x2=\"182.11\" y2=\"252\" gradientUnits=\"userSpaceOnUse\">\r\n                  <stop offset=\"0\" stop-color=\"${properties.color}\" stop-opacity=\"0\" />\r\n                  <stop offset=\"0.15\" stop-color=\"${properties.color}\" stop-opacity=\"0\" />\r\n                  <stop offset=\"0.45\" stop-color=\"${properties.color}\" stop-opacity=\"1\" />\r\n                  <stop offset=\"1\" stop-color=\"${properties.color}\" stop-opacity=\"1\" />\r\n                </linearGradient>\r\n              </defs>\r\n            </svg>\r\n            ${properties.image ? `<img src=\"${properties.image}\" class=\"popup-background-image\" alt=\"\">` : ''}\r\n            <div class=\"content-wrapper\">\r\n              <div class=\"popup-title\">${properties.name}</div>\r\n              <div class=\"popup-description-wrapper\">\r\n                <div class=\"fade-top\"></div>\r\n                <div class=\"popup-description\">${properties.description}</div>\r\n                <div class=\"fade-bottom\"></div>\r\n              </div>\r\n\r\n              ${\r\n                coordinates\r\n                  ? `<button class=\"navigate-button button-base\" data-lat=\"${coordinates[1]}\" data-lng=\"${coordinates[0]}\" data-color=\"${properties.color || '#6B46C1'}\" aria-label=\"${t.aria.navigate}\">${t.buttons.navigate}</button>`\r\n                  : ''\r\n              }\r\n              <button class=\"more-info-button button-base\">${t.buttons.moreInfo}</button>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"popup-side popup-back\">\r\n            <div class=\"content-wrapper\">\r\n\r\n               <!-- Add this new social-icons div -->\r\n          <div class=\"social-icons\">\r\n          ${\r\n            coordinates\r\n              ? `\r\n            <a href=\"https://www.google.com/maps/dir/?api=1&destination=${coordinates[1]},${coordinates[0]}\" target=\"_blank\" aria-label=\"${t.aria.navigate}\" title=\"${t.aria.navigate}\">\r\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 693 693\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M397.579 674.597C389.049 666.067 383.409 655.327 381.229 643.457L325.669 371.347C325.189 369.027 323.349 367.177 320.979 366.697L48.2893 311.017C32.3093 307.567 18.6393 298.097 9.77932 284.357C0.92932 270.617 -2.05068 254.247 1.39932 238.277C5.89932 217.457 21.2093 200.237 41.3593 193.327L41.5893 193.247L612.369 2.98667C627.929 -2.03333 644.509 -0.693336 659.049 6.76666C673.599 14.2167 684.369 26.8967 689.389 42.4467C693.349 54.7367 693.349 67.7267 689.389 80.0067L689.309 80.2667L499.149 650.737C490.449 677.117 465.019 694.337 437.299 692.647C422.449 691.717 408.499 685.447 397.969 674.997C397.839 674.867 397.709 674.737 397.579 674.607V674.597ZM363.049 329.347C371.339 337.637 377.239 348.287 379.699 360.277L435.409 633.107L435.469 633.477C435.619 634.307 435.989 635.057 436.619 635.657L436.819 635.857C437.859 636.897 439.239 637.517 440.709 637.607C443.409 637.777 445.919 636.067 446.779 633.467L636.929 63.0267C637.299 61.8367 637.289 60.5867 636.909 59.3967C636.279 57.4267 634.929 56.3967 633.919 55.8767C632.919 55.3667 631.319 54.8867 629.389 55.4767L59.2093 245.507C57.2493 246.207 55.7693 247.887 55.3293 249.927C54.8893 251.947 55.5393 253.517 56.1593 254.477C56.7693 255.427 57.8993 256.637 59.8693 257.087L332.069 312.667C344.089 315.137 354.769 321.057 363.059 329.347H363.049Z\" fill=\"white\"/>\r\n              </svg>\r\n            </a>`\r\n              : ''\r\n          }\r\n          ${\r\n            properties.website\r\n              ? `\r\n            <a href=\"${properties.website}\" target=\"_blank\" aria-label=\"${t.aria.website}\" title=\"${t.aria.website}\">\r\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n                <line x1=\"2\" y1=\"12\" x2=\"22\" y2=\"12\"></line>\r\n                <path d=\"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z\"></path>\r\n              </svg>\r\n            </a>`\r\n              : ''\r\n          }\r\n          ${\r\n            properties.instagram\r\n              ? `\r\n            <a href=\"${properties.instagram}\" target=\"_blank\" aria-label=\"${t.aria.instagram}\" title=\"${t.aria.instagram}\">\r\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                <path d=\"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.28-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z\"/>\r\n              </svg>\r\n            </a>`\r\n              : ''\r\n          }\r\n          ${\r\n            properties.facebook\r\n              ? `\r\n            <a href=\"${properties.facebook}\" target=\"_blank\" aria-label=\"${t.aria.facebook}\" title=\"${t.aria.facebook}\">\r\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                 <path d=\"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z\"></path>\r\n              </svg>\r\n            </a>`\r\n              : ''\r\n          }\r\n            </div>\r\n              <div class=\"info-content\">\r\n                <div class=\"popup-descriptionv2\">${properties.descriptionv2}</div>\r\n              </div>\r\n              ${generateOpeningHours(properties)}\r\n              ${properties.image ? `<button class=\"impressie-button button-base\">${t.buttons.impression}</button>` : ''}\r\n              <button class=\"more-info-button button-base\">${t.buttons.back}</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `,\r\n  };\r\n}\r\n", "/**\r\n * Main Application - Heerlen Interactive Map\r\n * This is the main entry point that imports and initializes all modules\r\n */\r\n\r\n// Import CSS\r\nimport './app.css';\r\n\r\n// Import modules\r\nimport { setupBoundaryCheck } from './modules/boundaryUtils.js';\r\nimport { CONFIG } from './modules/config.js';\r\nimport { loadLocationData, updateMapSource } from './modules/dataLoader.js';\r\nimport { applyMapFilters, setupLocationFilters, toggleFilter } from './modules/filters.js';\r\nimport { GeolocationManager } from './modules/geolocation.js';\r\nimport { loadFiltersAndUpdateMap } from './modules/localStorage.js';\r\nimport { initializeMap } from './modules/mapInit.js';\r\nimport {\r\n  setupMapInteractionHandlers,\r\n  setupMapLoadHandler,\r\n  setupSidebarHandlers,\r\n} from './modules/mapInteractions.js';\r\nimport { addMarkers, updateMarkersData, updateMarkerVisibility } from './modules/markers.js';\r\nimport { setupPOIFiltering } from './modules/poi.js';\r\nimport {\r\n  closeActivePopup,\r\n  closeItem,\r\n  createPopup,\r\n  handleSnapchatLink,\r\n  showImagePopup,\r\n} from './modules/popups.js';\r\nimport { state } from './modules/state.js';\r\nimport { setupThreeJSLayer, addCoordinateHelper } from './modules/threejs.js';\r\nimport { initialize3DSettings } from './modules/toggle3D.js';\r\nimport { initializeTour } from './modules/tour.js';\r\nimport { eventBus, Events } from './modules/eventBus.js';\r\nimport { resourceManager } from './modules/resourceManager.js';\r\n\r\n// Extend global Window interface\r\ndeclare global {\r\n  interface Window {\r\n    Webflow: Array<() => void | Promise<void>>;\r\n    map: any;\r\n    geolocationManager: GeolocationManager;\r\n    HeerlenMap: {\r\n      getState: () => typeof state;\r\n      getConfig: () => typeof CONFIG;\r\n      closePopup: () => void;\r\n      toggleFilter: (category: string) => void;\r\n    };\r\n    handleSnapchatLink: (url: string) => void;\r\n    showImagePopup: (imageSrc: string, title?: string) => void;\r\n    closeItem: () => void;\r\n  }\r\n}\r\n\r\n// Initialize when Webflow is ready\r\nwindow.Webflow ||= [];\r\nwindow.Webflow.push(async (): Promise<void> => {\r\n\r\n  try {\r\n    // Initialize map\r\n    const map = initializeMap();\r\n\r\n    // Make map globally available for debugging\r\n    window.map = map;\r\n\r\n    // Initialize geolocation manager\r\n    const geolocationManager = new GeolocationManager(map);\r\n    window.geolocationManager = geolocationManager;\r\n\r\n    // Setup all map handlers and systems\r\n    setupMapLoadHandler(map);\r\n    setupMapInteractionHandlers(map);\r\n    setupSidebarHandlers();\r\n    setupBoundaryCheck(map);\r\n    setupPOIFiltering(map);\r\n    setupThreeJSLayer(map);\r\n    initialize3DSettings(map);\r\n    // addCoordinateHelper(map);\r\n\r\n    // Initialize tour\r\n    initializeTour(map);\r\n\r\n    // Handle zoom changes\r\n    map.on('zoom', () => {\r\n      const currentZoom = map.getZoom();\r\n      updateMarkerVisibility(map, currentZoom);\r\n    });\r\n\r\n    // Handle map clicks\r\n    map.on('click', (e) => {\r\n      // Check if click is on a marker\r\n      const features = map.queryRenderedFeatures(e.point);\r\n      if (features.length > 0) {\r\n        const location = features[0];\r\n        createPopup(location, map);\r\n      } else {\r\n        closeActivePopup();\r\n      }\r\n    });\r\n\r\n    // Filter handlers are setup in setupLocationFilters() from filters module\r\n    \r\n    // Emit map loaded event\r\n    eventBus.emit(Events.MAP_LOADED, map);\r\n\r\n  } catch (error) {\r\n    // Error during map initialization\r\n    eventBus.emit('app:error', error);\r\n  }\r\n});\r\n\r\n// Global cleanup function for page unload\r\nwindow.addEventListener('beforeunload', () => {\r\n  // Clean up all systems\r\n  resourceManager.cleanup();\r\n  eventBus.cleanup();\r\n  \r\n  // Clean up geolocation manager\r\n  if (window.geolocationManager) {\r\n    window.geolocationManager.cleanup();\r\n  }\r\n  \r\n  // Clean up tour\r\n  if (window.tourCleanup) {\r\n    window.tourCleanup();\r\n  }\r\n});\r\n\r\n// Export commonly used functions for global access\r\nwindow.HeerlenMap = {\r\n  getState: () => state,\r\n  getConfig: () => CONFIG,\r\n  closePopup: closeActivePopup,\r\n  toggleFilter: toggleFilter,\r\n};\r\n\r\n// Make popup functions globally available for HTML onclick handlers\r\nwindow.handleSnapchatLink = handleSnapchatLink;\r\nwindow.showImagePopup = showImagePopup;\r\nwindow.closeItem = closeItem;", "// Boundary utilities and teleport functionality\r\n\r\nimport type { Map } from 'mapbox-gl';\r\nimport { CONFIG } from './config.js';\r\n\r\n// Extend global interface for gsap\r\ndeclare global {\r\n  const gsap: {\r\n    to: (target: any, options: any) => void;\r\n  };\r\n}\r\n\r\n/**\r\n * Calculate distance between two points using Haversine formula\r\n * @param lat1 - Latitude of first point\r\n * @param lon1 - Longitude of first point\r\n * @param lat2 - Latitude of second point\r\n * @param lon2 - Longitude of second point\r\n * @return Distance in kilometers\r\n */\r\nexport function calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\r\n  // Haversine formula\r\n  const toRad = (deg: number): number => deg * (Math.PI / 180);\r\n\r\n  const dLat = toRad(lat2 - lat1);\r\n  const dLon = toRad(lon2 - lon1);\r\n\r\n  const a =\r\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  return 6371 * c; // Earth radius in km\r\n}\r\n\r\n/**\r\n * Setup boundary checking for map movement\r\n * @param map - The mapbox map instance\r\n */\r\nexport function setupBoundaryCheck(map: Map): void {\r\n  map.on('moveend', () => {\r\n    // Skip this check if we're flying back\r\n    if (map.isEasing()) return;\r\n\r\n    const currentCenter = map.getCenter();\r\n    const boundaryCenter = {\r\n      lng: CONFIG.MAP.boundary.center[0],\r\n      lat: CONFIG.MAP.boundary.center[1],\r\n    };\r\n\r\n    // Calculate distance from current center to Woonboulevard center\r\n    const distance = calculateDistance(\r\n      currentCenter.lat,\r\n      currentCenter.lng,\r\n      boundaryCenter.lat,\r\n      boundaryCenter.lng\r\n    );\r\n\r\n    // If we're too far away (more than 1 km), fly back\r\n    if (distance > 1) {\r\n      // Create blocker overlay\r\n      const overlay = document.createElement('div');\r\n      overlay.id = 'interaction-blocker';\r\n      document.body.appendChild(overlay);\r\n\r\n      // Fly back to center\r\n      map.flyTo({\r\n        center: CONFIG.MAP.center,\r\n        zoom: 17,\r\n        pitch: 45,\r\n        bearing: -17.6,\r\n        speed: CONFIG.ANIMATION.speed,\r\n        curve: 1.5,\r\n        essential: true,\r\n      });\r\n\r\n      // Fade overlay\r\n      gsap.to(overlay, {\r\n        duration: 2,\r\n        backgroundColor: 'rgba(255,255,255,0)',\r\n        onComplete: () => {\r\n          overlay.remove();\r\n        },\r\n      });\r\n    }\r\n  });\r\n}", "// Data loading module - loads location data from Webflow\r\n\r\nimport type { Feature, Point } from 'geojson';\r\nimport type { Map } from 'mapbox-gl';\r\n\r\nimport { state } from './state.js';\r\n\r\ninterface LocationData {\r\n  locationLat: number;\r\n  locationLong: number;\r\n  locationID: string;\r\n  name: string;\r\n  locationInfo: string;\r\n  ondernemerkleur: string;\r\n  descriptionv2: string;\r\n  icon: string | null;\r\n  image: string | null;\r\n  category: string;\r\n  telefoonummer: string;\r\n  locatie: string;\r\n  maps: string | null;\r\n  website: string | null;\r\n  instagram: string | null;\r\n  facebook: string | null;\r\n  maandag: string;\r\n  dinsdag: string;\r\n  woensdag: string;\r\n  donderdag: string;\r\n  vrijdag: string;\r\n  zaterdag: string;\r\n  zondag: string;\r\n}\r\n\r\ninterface ARData {\r\n  latitude_ar: number;\r\n  longitude_ar: number;\r\n  name_ar: string;\r\n  slug_ar: string;\r\n  image_ar: string | null;\r\n  description_ar: string;\r\n  arkleur: string;\r\n  icon_ar: string | null;\r\n  instructie: string;\r\n  link_ar_mobile: string | null;\r\n  link_ar_desktop: string | null;\r\n  category: string | null;\r\n}\r\n\r\ninterface LocationFeature extends Feature<Point> {\r\n  properties: {\r\n    id: string;\r\n    description: string;\r\n    arrayID: number;\r\n    color: string;\r\n    name: string;\r\n    icon?: string | null;\r\n    image?: string | null;\r\n    category: string;\r\n    telefoonummer?: string;\r\n    locatie?: string;\r\n    maps?: string | null;\r\n    website?: string | null;\r\n    descriptionv2?: string;\r\n    instagram?: string | null;\r\n    facebook?: string | null;\r\n    maandag?: string;\r\n    dinsdag?: string;\r\n    woensdag?: string;\r\n    donderdag?: string;\r\n    vrijdag?: string;\r\n    zaterdag?: string;\r\n    zondag?: string;\r\n  };\r\n}\r\n\r\ninterface ARFeature extends Feature<Point> {\r\n  properties: {\r\n    type: 'ar';\r\n    name: string;\r\n    slug: string;\r\n    description: string;\r\n    arrayID: number;\r\n    image?: string | null;\r\n    arkleur: string;\r\n    icon?: string | null;\r\n    instructie: string;\r\n    link_ar_mobile?: string | null;\r\n    link_ar_desktop?: string | null;\r\n    category?: string | null;\r\n  };\r\n}\r\n\r\n/**\r\n * Helper function to safely get a value from an element within a parent.\r\n * Logs warnings if elements or properties are missing.\r\n */\r\nfunction getRobustValue(\r\n  parentElement: Element | null,\r\n  selector: string,\r\n  property: string = 'value',\r\n  defaultValue: any = null,\r\n  isRequired: boolean = false,\r\n  itemIndex: number = -1,\r\n  itemType: string = 'item'\r\n): any {\r\n  if (!parentElement) {\r\n    return defaultValue;\r\n  }\r\n\r\n  const targetElement = parentElement.querySelector(selector);\r\n\r\n  if (targetElement) {\r\n    // Check if the specific property exists (e.g., 'value' for input, 'innerHTML' for div)\r\n    if (property in targetElement) {\r\n      return (targetElement as any)[property];\r\n    }\r\n    // Property doesn't exist on the found element\r\n    return defaultValue;\r\n  }\r\n  // Required element is missing\r\n  if (isRequired) {\r\n    // Cannot process fully\r\n  }\r\n  // Return default even if not required, just don't log unless required\r\n  return defaultValue;\r\n}\r\n\r\n/**\r\n * Load location data from CMS DOM elements robustly.\r\n * Skips items with invalid coordinates.\r\n */\r\nexport function getGeoData(): void {\r\n  const locationList = document.getElementById('location-list');\r\n  let loadedCount = 0;\r\n  let skippedCount = 0;\r\n\r\n  if (!locationList) {\r\n    return; // Stop if the main container is missing\r\n  }\r\n\r\n  // Filter out non-element nodes (like text nodes, comments)\r\n  Array.from(locationList.childNodes)\r\n    .filter((node): node is Element => node.nodeType === Node.ELEMENT_NODE)\r\n    .forEach((element, index) => {\r\n      // --- Get Essential Data First ---\r\n      const rawLat = getRobustValue(\r\n        element,\r\n        '#locationLatitude',\r\n        'value',\r\n        null,\r\n        true,\r\n        index,\r\n        'location'\r\n      );\r\n      const rawLong = getRobustValue(\r\n        element,\r\n        '#locationLongitude',\r\n        'value',\r\n        null,\r\n        true,\r\n        index,\r\n        'location'\r\n      );\r\n      const locationID = getRobustValue(\r\n        element,\r\n        '#locationID',\r\n        'value',\r\n        `missing-id-${index}`,\r\n        true,\r\n        index,\r\n        'location'\r\n      ); // ID is usually important\r\n\r\n      // --- Validate Essential Data ---\r\n      const locationLat = parseFloat(rawLat);\r\n      const locationLong = parseFloat(rawLong);\r\n\r\n      if (isNaN(locationLat) || isNaN(locationLong)) {\r\n        skippedCount++;\r\n        return; // Go to the next iteration/element\r\n      }\r\n\r\n      // --- Get Optional/Other Data Safely ---\r\n      const locationData: LocationData = {\r\n        // Essential (already validated)\r\n        locationLat: locationLat,\r\n        locationLong: locationLong,\r\n        locationID: locationID, // Use the validated/defaulted ID\r\n        // Other data with defaults\r\n        name: getRobustValue(element, '#name', 'value', 'Naamloos', false, index, 'location'),\r\n        locationInfo: getRobustValue(\r\n          element,\r\n          '.locations-map_card',\r\n          'innerHTML',\r\n          '<p>Geen informatie beschikbaar</p>',\r\n          false,\r\n          index,\r\n          'location'\r\n        ),\r\n        ondernemerkleur: getRobustValue(\r\n          element,\r\n          '#ondernemerkleur',\r\n          'value',\r\n          '#A0A0A0',\r\n          false,\r\n          index,\r\n          'location'\r\n        ), // Grey default color\r\n        descriptionv2: getRobustValue(\r\n          element,\r\n          '#descriptionv2',\r\n          'value',\r\n          '',\r\n          false,\r\n          index,\r\n          'location'\r\n        ),\r\n        icon: getRobustValue(element, '#icon', 'value', null, false, index, 'location'), // Let Mapbox handle missing icon later if needed\r\n        image: getRobustValue(element, '#image', 'value', null, false, index, 'location'),\r\n        category: getRobustValue(element, '#category', 'value', 'Overig', false, index, 'location'), // Default category\r\n        telefoonummer: getRobustValue(\r\n          element,\r\n          '#telefoonnummer',\r\n          'value',\r\n          '',\r\n          false,\r\n          index,\r\n          'location'\r\n        ),\r\n        locatie: getRobustValue(element, '#locatie', 'value', '', false, index, 'location'),\r\n        maps: getRobustValue(element, '#maps', 'value', null, false, index, 'location'),\r\n        website: getRobustValue(element, '#website', 'value', null, false, index, 'location'),\r\n        instagram: getRobustValue(element, '#instagram', 'value', null, false, index, 'location'),\r\n        facebook: getRobustValue(element, '#facebook', 'value', null, false, index, 'location'),\r\n        maandag: getRobustValue(element, '#maandag', 'value', '', false, index, 'location'),\r\n        dinsdag: getRobustValue(element, '#dinsdag', 'value', '', false, index, 'location'),\r\n        woensdag: getRobustValue(element, '#woensdag', 'value', '', false, index, 'location'),\r\n        donderdag: getRobustValue(element, '#donderdag', 'value', '', false, index, 'location'),\r\n        vrijdag: getRobustValue(element, '#vrijdag', 'value', '', false, index, 'location'),\r\n        zaterdag: getRobustValue(element, '#zaterdag', 'value', '', false, index, 'location'),\r\n        zondag: getRobustValue(element, '#zondag', 'value', '', false, index, 'location'),\r\n      };\r\n\r\n      // --- Create Feature ---\r\n      const feature: LocationFeature = {\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [locationData.locationLong, locationData.locationLat], // Use validated coords\r\n        },\r\n        properties: {\r\n          id: locationData.locationID,\r\n          description: locationData.locationInfo,\r\n          arrayID: index, // Keep original index for potential reference\r\n          color: locationData.ondernemerkleur,\r\n          name: locationData.name,\r\n          icon: locationData.icon,\r\n          image: locationData.image,\r\n          category: locationData.category,\r\n          telefoonummer: locationData.telefoonummer,\r\n          locatie: locationData.locatie,\r\n          maps: locationData.maps,\r\n          website: locationData.website,\r\n          descriptionv2: locationData.descriptionv2,\r\n          instagram: locationData.instagram,\r\n          facebook: locationData.facebook,\r\n          maandag: locationData.maandag,\r\n          dinsdag: locationData.dinsdag,\r\n          woensdag: locationData.woensdag,\r\n          donderdag: locationData.donderdag,\r\n          vrijdag: locationData.vrijdag,\r\n          zaterdag: locationData.zaterdag,\r\n          zondag: locationData.zondag,\r\n        },\r\n      };\r\n\r\n      // --- Add Feature (if not duplicate ID) ---\r\n      if (\r\n        !state.mapLocations.features.some((feat) => feat.properties.id === locationData.locationID)\r\n      ) {\r\n        state.mapLocations.features.push(feature);\r\n        loadedCount++;\r\n      } else {\r\n        // Duplicate location ID found and skipped\r\n        skippedCount++;\r\n      }\r\n    });\r\n}\r\n\r\n/**\r\n * Load AR location data from CMS DOM elements robustly.\r\n * Skips items with invalid coordinates.\r\n */\r\nexport function getARData(): void {\r\n  const arLocationList = document.getElementById('location-ar-list');\r\n  let loadedCount = 0;\r\n  let skippedCount = 0;\r\n  const startIndex = state.mapLocations.features.length; // Start index after regular locations\r\n\r\n  if (!arLocationList) {\r\n    return; // Stop if the main container is missing\r\n  }\r\n\r\n  // Filter out non-element nodes\r\n  Array.from(arLocationList.childNodes)\r\n    .filter((node): node is Element => node.nodeType === Node.ELEMENT_NODE)\r\n    .forEach((element, index) => {\r\n      const itemIndexForLog = index; // Use original index for logging\r\n\r\n      // --- Get Essential Data First ---\r\n      const rawLat = getRobustValue(\r\n        element,\r\n        '#latitude_ar',\r\n        'value',\r\n        null,\r\n        true,\r\n        itemIndexForLog,\r\n        'AR'\r\n      );\r\n      const rawLong = getRobustValue(\r\n        element,\r\n        '#longitude_ar',\r\n        'value',\r\n        null,\r\n        true,\r\n        itemIndexForLog,\r\n        'AR'\r\n      );\r\n      const name_ar = getRobustValue(\r\n        element,\r\n        '#name_ar',\r\n        'value',\r\n        `AR Item ${itemIndexForLog}`,\r\n        true,\r\n        itemIndexForLog,\r\n        'AR'\r\n      ); // Name is likely important\r\n\r\n      // --- Validate Essential Data ---\r\n      const latitude_ar = parseFloat(rawLat);\r\n      const longitude_ar = parseFloat(rawLong);\r\n\r\n      if (isNaN(latitude_ar) || isNaN(longitude_ar)) {\r\n        skippedCount++;\r\n        return; // Go to the next iteration/element\r\n      }\r\n\r\n      // --- Get Optional/Other Data Safely ---\r\n      const arData: ARData = {\r\n        // Essential (already validated)\r\n        latitude_ar: latitude_ar,\r\n        longitude_ar: longitude_ar,\r\n        name_ar: name_ar,\r\n        // Other data with defaults\r\n        slug_ar: getRobustValue(element, '#slug_ar', 'value', '', false, itemIndexForLog, 'AR'),\r\n        image_ar: getRobustValue(element, '#image_ar', 'value', null, false, itemIndexForLog, 'AR'),\r\n        description_ar: getRobustValue(\r\n          element,\r\n          '#description_ar',\r\n          'value',\r\n          'Geen beschrijving.',\r\n          false,\r\n          itemIndexForLog,\r\n          'AR'\r\n        ),\r\n        arkleur: getRobustValue(element, '#arkleur', 'value', '#A0A0A0', false, index, 'location'), // Grey default color\r\n        icon_ar: getRobustValue(element, '#icon_ar', 'value', null, false, itemIndexForLog, 'AR'), // Default icon?\r\n        // Nieuwe velden\r\n        instructie: getRobustValue(\r\n          element,\r\n          '#instructie',\r\n          'value',\r\n          'Geen instructie beschikbaar.',\r\n          false,\r\n          itemIndexForLog,\r\n          'AR'\r\n        ),\r\n        link_ar_mobile: getRobustValue(\r\n          element,\r\n          '#link_ar_mobile',\r\n          'value',\r\n          null,\r\n          false,\r\n          itemIndexForLog,\r\n          'AR'\r\n        ),\r\n        link_ar_desktop: getRobustValue(\r\n          element,\r\n          '#link_ar_desktop',\r\n          'value',\r\n          null,\r\n          false,\r\n          itemIndexForLog,\r\n          'AR'\r\n        ),\r\n        category: getRobustValue(element, '#category', 'value', null, false, itemIndexForLog, 'AR'),\r\n      };\r\n\r\n      // Check if required AR links are present\r\n      if (!arData.link_ar_mobile && !arData.link_ar_desktop) {\r\n        // Skipping AR item: missing required AR links\r\n        skippedCount++;\r\n        return;\r\n      }\r\n\r\n      // --- Create Feature ---\r\n      const feature: ARFeature = {\r\n        type: 'Feature',\r\n        geometry: {\r\n          type: 'Point',\r\n          coordinates: [arData.longitude_ar, arData.latitude_ar], // Use validated coords\r\n        },\r\n        properties: {\r\n          type: 'ar', // Mark as AR type\r\n          name: arData.name_ar,\r\n          slug: arData.slug_ar,\r\n          description: arData.description_ar,\r\n          arrayID: startIndex + index, // Ensure unique arrayID across both lists\r\n          image: arData.image_ar,\r\n          arkleur: arData.arkleur,\r\n          icon: arData.icon_ar,\r\n          // Nieuwe velden\r\n          instructie: arData.instructie,\r\n          link_ar_mobile: arData.link_ar_mobile,\r\n          link_ar_desktop: arData.link_ar_desktop,\r\n          category: arData.category,\r\n        },\r\n      };\r\n\r\n      // --- Add Feature ---\r\n      state.mapLocations.features.push(feature);\r\n      loadedCount++;\r\n    });\r\n}\r\n\r\n/**\r\n * Main function to load all location data\r\n */\r\nexport async function loadLocationData(): Promise<typeof state.mapLocations> {\r\n  // Reset mapLocations in case this script runs multiple times\r\n  state.mapLocations.features = [];\r\n\r\n  // Load both types of data\r\n  getGeoData();\r\n  getARData();\r\n\r\n  // Return the loaded data\r\n  return state.mapLocations;\r\n}\r\n\r\n/**\r\n * Update map source with loaded data\r\n */\r\nexport function updateMapSource(map: Map): void {\r\n  // Optional: After loading, update the map source if it exists\r\n  if (map.getSource('locations')) {\r\n    const source = map.getSource('locations');\r\n    if (source && 'setData' in source) {\r\n      (source as any).setData(state.mapLocations);\r\n    }\r\n  }\r\n}\r\n\r\n// Initialize data loading when DOM is ready\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  loadLocationData();\r\n});\r\n", "// Filter management module\r\n\r\nimport type { Map } from 'mapbox-gl';\r\nimport { saveMapFiltersToLocalStorage } from './localStorage.js';\r\nimport { state, stateManager } from './state.js';\r\n\r\n// Performance optimization caches\r\nconst buttonCache = new Map<string, HTMLElement>();\r\nconst layerCache = new Map<string, boolean>();\r\nlet buttonElements: HTMLElement[] = [];\r\n\r\n/**\r\n * Apply active filters to map markers\r\n */\r\nexport function applyMapFilters(): void {\r\n  // Get map instance from state\r\n  const map = state.map;\r\n  if (!map) {\r\n    return; // Map not initialized yet\r\n  }\r\n\r\n  // Get current active filters from state\r\n  const currentFilters = state.activeFilters;\r\n  \r\n  let filterExpression: any[] | null;\r\n\r\n  if (!currentFilters || currentFilters.size === 0) {\r\n    // No filter - show everything\r\n    filterExpression = null;\r\n  } else {\r\n    // Combine active filters WITH markers without category\r\n    filterExpression = [\r\n      'any', // OR condition\r\n      ['in', ['get', 'category'], ['literal', Array.from(currentFilters)]], // Markers with active categories\r\n      ['!', ['has', 'category']], // Markers without category property\r\n      ['==', ['get', 'category'], ''], // Markers with empty category\r\n    ];\r\n  }\r\n\r\n  // Apply filter to all marker-related layers (if loaded)\r\n  const layersToFilter = ['location-markers', 'location-icons', 'location-labels'];\r\n  layersToFilter.forEach((layerId) => {\r\n    if (map.getLayer(layerId)) {\r\n      try {\r\n        map.setFilter(layerId, filterExpression);\r\n      } catch (e) {\r\n        // Layer might not be ready yet\r\n      }\r\n    }\r\n  });\r\n\r\n  // Save filters to localStorage\r\n  saveMapFiltersToLocalStorage();\r\n}\r\n\r\n/**\r\n * Toggle a filter category\r\n */\r\nexport function toggleFilter(category: string): void {\r\n  if (!category) return; // Skip buttons without category\r\n\r\n  // Get current filters\r\n  const currentFilters = new Set(state.activeFilters);\r\n  \r\n  // Update the Set\r\n  if (currentFilters.has(category)) {\r\n    currentFilters.delete(category);\r\n  } else {\r\n    currentFilters.add(category);\r\n  }\r\n  \r\n  // Update state manager\r\n  stateManager.setActiveFilters(currentFilters);\r\n\r\n  // Apply the map filters\r\n  applyMapFilters();\r\n}\r\n\r\n/**\r\n * Setup location filter buttons with caching\r\n */\r\nexport function setupLocationFilters(): void {\r\n  // Only setup once - check if already initialized\r\n  if (buttonElements.length > 0) {\r\n    return; // Already initialized\r\n  }\r\n\r\n  // Cache button elements and add event listeners\r\n  buttonElements = Array.from(document.querySelectorAll('.filter-btn')) as HTMLElement[];\r\n  \r\n  buttonElements.forEach((buttonElement) => {\r\n    const category = (buttonElement.dataset as any).category as string;\r\n    if (category) {\r\n      buttonCache.set(category, buttonElement);\r\n    }\r\n\r\n    buttonElement.addEventListener('click', () => {\r\n      const category = (buttonElement.dataset as any).category as string; // UPPERCASE expected\r\n      if (!category) return; // Skip buttons without category\r\n\r\n      // Get current filters and update\r\n      const currentFilters = new Set(state.activeFilters);\r\n      \r\n      if (currentFilters.has(category)) {\r\n        currentFilters.delete(category);\r\n        buttonElement.classList.remove('is--active'); // Explicitly remove\r\n      } else {\r\n        currentFilters.add(category);\r\n        buttonElement.classList.add('is--active'); // Explicitly add\r\n      }\r\n      \r\n      // Update state manager\r\n      stateManager.setActiveFilters(currentFilters);\r\n\r\n      // Apply the map filters\r\n      applyMapFilters();\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update filter button states based on active filters - with caching\r\n */\r\nexport function updateFilterButtonStates(): void {\r\n  const currentFilters = state.activeFilters;\r\n  \r\n  // Use cached button elements if available\r\n  if (buttonElements.length > 0) {\r\n    buttonElements.forEach((buttonElement) => {\r\n      const category = (buttonElement.dataset as any).category as string;\r\n      if (category) {\r\n        buttonElement.classList.toggle('is--active', currentFilters.has(category));\r\n      }\r\n    });\r\n  } else {\r\n    // Fallback to DOM query if cache not initialized\r\n    document.querySelectorAll('.filter-btn').forEach((button) => {\r\n      const buttonElement = button as HTMLElement;\r\n      const category = (buttonElement.dataset as any).category as string;\r\n      if (category) {\r\n        buttonElement.classList.toggle('is--active', currentFilters.has(category));\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all active filters\r\n */\r\nexport function clearAllFilters(): void {\r\n  stateManager.clearFilters();\r\n  updateFilterButtonStates();\r\n  applyMapFilters();\r\n}\r\n\r\n/**\r\n * Set specific filters\r\n */\r\nexport function setFilters(categories: string[]): void {\r\n  const newFilters = new Set(categories);\r\n  stateManager.setActiveFilters(newFilters);\r\n  updateFilterButtonStates();\r\n  applyMapFilters();\r\n}\r\n\r\n// Make applyMapFilters available globally for localStorage module\r\n(window as any).applyMapFilters = applyMapFilters;", "// Local storage utilities for filter management\r\n\r\nimport { LOCAL_STORAGE_KEY } from './config.js';\r\nimport { setActiveFilters, state, stateManager } from './state.js';\r\n\r\n// Extend Window interface for global functions\r\ndeclare global {\r\n  interface Window {\r\n    applyMapFilters?: () => void;\r\n  }\r\n}\r\n\r\n// Save current activeFilters Set to localStorage\r\nexport function saveMapFiltersToLocalStorage(): void {\r\n  try {\r\n    const filtersArray = Array.from(state.activeFilters);\r\n    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(filtersArray));\r\n  } catch (e) {\r\n    // Could not save map filters to localStorage\r\n  }\r\n}\r\n\r\n// Update the Set, map filters and button UI based on categories array\r\nexport function updateMapState(activeCategories: string[] = []): void {\r\n  const newFilters = new Set(activeCategories);\r\n  stateManager.setActiveFilters(newFilters);\r\n\r\n  // Update visual state of buttons\r\n  document.querySelectorAll<HTMLElement>('.filter-btn').forEach((button) => {\r\n    const { category } = button.dataset;\r\n    if (category) {\r\n      button.classList.toggle('is--active', newFilters.has(category));\r\n    }\r\n  });\r\n\r\n  // Apply filters to map layers - this function will be imported from filters module\r\n  if (typeof window.applyMapFilters === 'function') {\r\n    window.applyMapFilters();\r\n  }\r\n}\r\n\r\n// Load filters from localStorage and update the map\r\nexport function loadFiltersAndUpdateMap(): void {\r\n  try {\r\n    const storedFilters = localStorage.getItem(LOCAL_STORAGE_KEY);\r\n    const activeCategories: string[] = storedFilters ? JSON.parse(storedFilters) : [];\r\n    updateMapState(activeCategories);\r\n  } catch (e) {\r\n    updateMapState([]);\r\n  }\r\n}\r\n", "// Geolocation management for the Heerlen Interactive Map\r\n\r\nimport type { GeolocateControl, Map, Marker, Popup } from 'mapbox-gl';\r\n\r\nimport { CONFIG } from './config.js';\r\nimport { state } from './state.js';\r\n\r\n// Global declarations for external libraries\r\ndeclare global {\r\n  interface Window {\r\n    mapboxgl: typeof import('mapbox-gl');\r\n    geolocationManager: GeolocationManager;\r\n  }\r\n}\r\n\r\n// Language detection function\r\nfunction detectLanguage(): 'nl' | 'en' | 'de' {\r\n  const path = window.location.pathname;\r\n  if (path.includes('/en/')) return 'en';\r\n  if (path.includes('/de/')) return 'de';\r\n  return 'nl'; // Default to Dutch\r\n}\r\n\r\n// Translations for boundary popup\r\nconst boundaryTranslations = {\r\n  nl: {\r\n    title: 'Kom naar Heerlen',\r\n    message:\r\n      'Deze functie is alleen beschikbaar binnen de blauwe cirkel op de kaart. Kom naar het centrum van Heerlen om de interactieve kaart te gebruiken!',\r\n    locationDenied: 'Locatie toegang geweigerd. Schakel het in bij je instellingen.',\r\n    locationUnavailable: 'Locatie niet beschikbaar. Controleer je apparaat instellingen.',\r\n    locationTimeout: 'Verzoek verlopen. Probeer opnieuw.',\r\n    locationError: 'Er is een fout opgetreden bij het ophalen van je locatie.',\r\n  },\r\n  en: {\r\n    title: 'Come to Heerlen',\r\n    message:\r\n      'This feature is only available within the blue circle on the map. Come to the center of Heerlen to use the interactive map!',\r\n    locationDenied: 'Location access denied. Please enable it in your settings.',\r\n    locationUnavailable: 'Location not available. Check your device settings.',\r\n    locationTimeout: 'Request timed out. Please try again.',\r\n    locationError: 'An error occurred while getting your location.',\r\n  },\r\n  de: {\r\n    title: 'Kommen Sie nach Heerlen',\r\n    message:\r\n      'Diese Funktion ist nur innerhalb des blauen Kreises auf der Karte verf\u00FCgbar. Kommen Sie ins Zentrum von Heerlen, um die interaktive Karte zu nutzen!',\r\n    locationDenied: 'Standortzugriff verweigert. Bitte aktivieren Sie ihn in Ihren Einstellungen.',\r\n    locationUnavailable: 'Standort nicht verf\u00FCgbar. \u00DCberpr\u00FCfen Sie Ihre Ger\u00E4teeinstellungen.',\r\n    locationTimeout: 'Anfrage abgelaufen. Bitte versuchen Sie es erneut.',\r\n    locationError: 'Beim Abrufen Ihres Standorts ist ein Fehler aufgetreten.',\r\n  },\r\n};\r\n\r\ninterface GeolocationPosition {\r\n  coords: {\r\n    longitude: number;\r\n    latitude: number;\r\n    heading?: number;\r\n  };\r\n}\r\n\r\ninterface GeolocationError {\r\n  code: number;\r\n  message: string;\r\n}\r\n\r\nexport class GeolocationManager {\r\n  private map: Map;\r\n  private searchRadiusId: string;\r\n  private searchRadiusOuterId: string;\r\n  private radiusInMeters: number;\r\n  private boundaryLayerIds: string[];\r\n  private distanceMarkers: Marker[];\r\n  public isPopupOpen: boolean;\r\n  private centerPoint: [number, number];\r\n  private boundaryRadius: number;\r\n  public geolocateControl?: GeolocateControl;\r\n  private isFirstLocation: boolean;\r\n  private isTracking: boolean;\r\n  private userInitiatedGeolocation: boolean;\r\n  public wasTracking?: boolean;\r\n  private eventListeners: Array<{ element: any; event: string; handler: Function }> = [];\r\n  private timeouts: Set<number> = new Set();\r\n  private boundaryPopup?: HTMLElement;\r\n\r\n  constructor(map: Map) {\r\n    this.map = map;\r\n    this.searchRadiusId = 'search-radius';\r\n    this.searchRadiusOuterId = 'search-radius-outer';\r\n    this.radiusInMeters = 25;\r\n    this.boundaryLayerIds = ['boundary-fill', 'boundary-line', 'boundary-label'];\r\n    this.distanceMarkers = [];\r\n    this.isPopupOpen = false;\r\n    this.centerPoint = CONFIG.MAP.boundary.center;\r\n    this.boundaryRadius = CONFIG.MAP.boundary.radius;\r\n    this.isFirstLocation = true;\r\n    this.isTracking = false;\r\n    this.userInitiatedGeolocation = false;\r\n    this.initialize();\r\n  }\r\n\r\n  /**\r\n   * Initialize geolocation features\r\n   */\r\n  private initialize(): void {\r\n    this.setupGeolocateControl();\r\n    this.setupSearchRadius();\r\n    this.setupBoundaryCheck();\r\n  }\r\n\r\n  /**\r\n   * Pause geolocation tracking while keeping user location visible\r\n   */\r\n  public pauseTracking(): void {\r\n    if (this.geolocateControl && (this.geolocateControl as any)._watchState === 'ACTIVE_LOCK') {\r\n      this.wasTracking = true;\r\n      (this.geolocateControl as any)._watchState = 'ACTIVE_ERROR';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resume geolocation tracking if it was paused\r\n   */\r\n  public resumeTracking(): void {\r\n    if (this.geolocateControl && this.wasTracking) {\r\n      (this.geolocateControl as any)._watchState = 'ACTIVE_LOCK';\r\n      this.wasTracking = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create and update distance markers based on user location\r\n   */\r\n  private updateDistanceMarkers(userPosition: [number, number]): void {\r\n    // Clear existing markers atomically\r\n    this.clearDistanceMarkers();\r\n\r\n    // Add new markers for features within radius\r\n    state.mapLocations.features.forEach((feature) => {\r\n      const featureCoords = feature.geometry.coordinates as [number, number];\r\n      const distance =\r\n        1000 *\r\n        this.calculateDistance(\r\n          userPosition[1],\r\n          userPosition[0],\r\n          featureCoords[1],\r\n          featureCoords[0]\r\n        );\r\n\r\n      if (distance <= this.radiusInMeters) {\r\n        const markerEl = document.createElement('div');\r\n        markerEl.className = 'distance-marker';\r\n        markerEl.innerHTML = `<span class=\"distance-marker-distance\">${Math.round(distance)}m</span>`;\r\n\r\n        const marker = new window.mapboxgl.Marker({ element: markerEl })\r\n          .setLngLat(featureCoords)\r\n          .addTo(this.map);\r\n\r\n        // Add click handler\r\n        markerEl.addEventListener('click', () => {\r\n          this.map.fire('click', {\r\n            lngLat: featureCoords,\r\n            point: this.map.project(featureCoords),\r\n            features: [feature],\r\n          } as any);\r\n        });\r\n\r\n        this.distanceMarkers.push(marker);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Handle user location updates\r\n  private handleUserLocation(position: GeolocationPosition): void {\r\n    const userPosition: [number, number] = [position.coords.longitude, position.coords.latitude];\r\n\r\n    if (this.isWithinBoundary(userPosition)) {\r\n      this.updateSearchRadius(userPosition);\r\n      this.updateDistanceMarkers(userPosition);\r\n\r\n      if (!this.isPopupOpen) {\r\n        if (this.isFirstLocation) {\r\n          // Debug info\r\n          this.map.flyTo({\r\n            center: userPosition,\r\n            zoom: 17.5,\r\n            pitch: 45,\r\n            duration: 2000,\r\n            bearing: position.coords.heading || 0,\r\n          });\r\n          this.isFirstLocation = false;\r\n        } else {\r\n          const mapCenter = this.map.getCenter();\r\n          const distanceChange = this.calculateDistance(\r\n            mapCenter.lat,\r\n            mapCenter.lng,\r\n            userPosition[1],\r\n            userPosition[0]\r\n          );\r\n\r\n          if (distanceChange > 0.05) {\r\n            // Debug info\r\n            this.map.easeTo({\r\n              center: userPosition,\r\n              duration: 1000,\r\n            });\r\n          }\r\n        }\r\n      } else {\r\n        // Debug info\r\n      }\r\n    } else {\r\n      // Debug info\r\n      (this.geolocateControl as any)._watchState = 'OFF';\r\n      if ((this.geolocateControl as any)._geolocateButton) {\r\n        (this.geolocateControl as any)._geolocateButton.classList.remove(\r\n          'mapboxgl-ctrl-geolocate-active'\r\n        );\r\n        (this.geolocateControl as any)._geolocateButton.classList.remove(\r\n          'mapboxgl-ctrl-geolocate-waiting'\r\n        );\r\n      }\r\n\r\n      // Clear any existing user location indicators\r\n      this.clearSearchRadius();\r\n      if (this.distanceMarkers) {\r\n        this.distanceMarkers.forEach((marker) => marker.remove());\r\n        this.distanceMarkers = [];\r\n      }\r\n\r\n      // Debug info\r\n      this.showBoundaryPopup();\r\n\r\n      // Debug info\r\n      this.map.flyTo({\r\n        center: this.centerPoint,\r\n        zoom: 14,\r\n        pitch: 0,\r\n        bearing: 0,\r\n        duration: 1500,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup geolocate control with event handlers\r\n   */\r\n  private setupGeolocateControl(): void {\r\n    // Remove any existing controls\r\n    document\r\n      .querySelectorAll('.mapboxgl-ctrl-top-right .mapboxgl-ctrl-group')\r\n      .forEach((el) => el.remove());\r\n    document\r\n      .querySelectorAll('.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl-group')\r\n      .forEach((el) => el.remove());\r\n\r\n    // Create geolocate control\r\n    this.geolocateControl = new window.mapboxgl.GeolocateControl({\r\n      positionOptions: {\r\n        enableHighAccuracy: true,\r\n        maximumAge: 1000,\r\n        timeout: 6000,\r\n      },\r\n      trackUserLocation: true,\r\n      showUserHeading: true,\r\n      showAccuracyCircle: false,\r\n      fitBoundsOptions: {\r\n        maxZoom: 17.5,\r\n        animate: true,\r\n      },\r\n    });\r\n\r\n    this.isFirstLocation = true;\r\n    this.isTracking = false;\r\n    this.userInitiatedGeolocation = false;\r\n\r\n    // Override the original _onSuccess method from the geolocate control\r\n    const originalOnSuccess = (this.geolocateControl as any)._onSuccess;\r\n    (this.geolocateControl as any)._onSuccess = (position: GeolocationPosition) => {\r\n      const userPosition: [number, number] = [position.coords.longitude, position.coords.latitude];\r\n      // Debug info\r\n\r\n      const isWithin = this.isWithinBoundary(userPosition);\r\n      // Debug info\r\n\r\n      // Only do boundary check if user clicked the button\r\n      if (this.userInitiatedGeolocation && !isWithin) {\r\n        // Debug info\r\n\r\n        // Reset geolocate control state\r\n        (this.geolocateControl as any)._watchState = 'OFF';\r\n        if ((this.geolocateControl as any)._geolocateButton) {\r\n          (this.geolocateControl as any)._geolocateButton.classList.remove(\r\n            'mapboxgl-ctrl-geolocate-active'\r\n          );\r\n          (this.geolocateControl as any)._geolocateButton.classList.remove(\r\n            'mapboxgl-ctrl-geolocate-waiting'\r\n          );\r\n          // Debug info\r\n        }\r\n\r\n        // Show boundary popup and highlight boundary\r\n        this.showBoundaryLayers();\r\n        // Debug info\r\n        this.showBoundaryPopup();\r\n\r\n        // Remove any user location marker that might have been added\r\n        if ((this.geolocateControl as any)._userLocationDotMarker) {\r\n          // Debug info\r\n          (this.geolocateControl as any)._userLocationDotMarker.remove();\r\n        }\r\n\r\n        this.userInitiatedGeolocation = false;\r\n        // Debug info\r\n        return;\r\n      }\r\n\r\n      // Debug info\r\n      originalOnSuccess.call(this.geolocateControl, position);\r\n      this.userInitiatedGeolocation = false;\r\n      // Debug info\r\n    };\r\n\r\n    // Handle errors\r\n    this.geolocateControl.on('error', (error: GeolocationError) => {\r\n      // Debug info\r\n      if (this.userInitiatedGeolocation) {\r\n        // Debug info\r\n        this.handleGeolocationError(error);\r\n      } else {\r\n        // Debug info\r\n      }\r\n      this.userInitiatedGeolocation = false;\r\n      // Debug info\r\n    });\r\n\r\n    // Setup the button click handler\r\n    this.map.once('idle', () => {\r\n      const geolocateButton = document.querySelector('.mapboxgl-ctrl-geolocate');\r\n      if (geolocateButton && geolocateButton.parentElement) {\r\n        geolocateButton.addEventListener(\r\n          'click',\r\n          (event) => {\r\n            // Debug info\r\n            this.userInitiatedGeolocation = true;\r\n            // Debug info\r\n            this.showBoundaryLayers();\r\n          },\r\n          true\r\n        );\r\n      } else {\r\n        // Debug info\r\n      }\r\n    });\r\n\r\n    this.geolocateControl.on('trackuserlocationstart', () => {\r\n      // Debug info\r\n      this.isTracking = true;\r\n      this.showBoundaryLayers();\r\n    });\r\n\r\n    this.geolocateControl.on('trackuserlocationend', () => {\r\n      // Debug info\r\n      this.isTracking = false;\r\n      this.isFirstLocation = true;\r\n      this.map.easeTo({ bearing: 0, pitch: 45 });\r\n      this.clearSearchRadius();\r\n\r\n      if (this.distanceMarkers) {\r\n        this.distanceMarkers.forEach((marker) => marker.remove());\r\n        this.distanceMarkers = [];\r\n      }\r\n    });\r\n\r\n    // Add controls to map\r\n    this.map.addControl(new window.mapboxgl.NavigationControl(), 'top-right');\r\n    this.map.addControl(this.geolocateControl, 'top-right');\r\n  }\r\n\r\n  /**\r\n   * Setup search radius visualization\r\n   */\r\n  private setupSearchRadius(): void {\r\n    this.map.on('load', () => {\r\n      if (this.map.getSource(this.searchRadiusId)) {\r\n        // Debug info\r\n        return;\r\n      }\r\n      // Setup inner radius\r\n      this.map.addSource(this.searchRadiusId, {\r\n        type: 'geojson',\r\n        data: {\r\n          type: 'Feature',\r\n          geometry: { type: 'Polygon', coordinates: [[]] },\r\n        },\r\n      });\r\n\r\n      this.map.addLayer({\r\n        id: this.searchRadiusId,\r\n        type: 'fill-extrusion',\r\n        source: this.searchRadiusId,\r\n        paint: {\r\n          'fill-extrusion-color': '#4B83F2',\r\n          'fill-extrusion-opacity': 0.08,\r\n          'fill-extrusion-height': 1,\r\n          'fill-extrusion-base': 0,\r\n        },\r\n      });\r\n\r\n      // Setup outer radius\r\n      this.map.addSource(this.searchRadiusOuterId, {\r\n        type: 'geojson',\r\n        data: {\r\n          type: 'Feature',\r\n          geometry: { type: 'Polygon', coordinates: [[]] },\r\n        },\r\n      });\r\n\r\n      this.map.addLayer({\r\n        id: this.searchRadiusOuterId,\r\n        type: 'fill-extrusion',\r\n        source: this.searchRadiusOuterId,\r\n        paint: {\r\n          'fill-extrusion-color': '#4B83F2',\r\n          'fill-extrusion-opacity': 0.04,\r\n          'fill-extrusion-height': 2,\r\n          'fill-extrusion-base': 0,\r\n        },\r\n      });\r\n      // Debug info\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Setup boundary circle visualization\r\n   */\r\n  private setupBoundaryCheck(): void {\r\n    this.map.on('load', () => {\r\n      if (this.map.getSource('boundary-circle')) {\r\n        // Debug info\r\n        return;\r\n      }\r\n      this.map.addSource('boundary-circle', {\r\n        type: 'geojson',\r\n        data: this.createBoundaryCircle(),\r\n      });\r\n\r\n      this.map.addLayer({\r\n        id: 'boundary-fill',\r\n        type: 'fill',\r\n        source: 'boundary-circle',\r\n        paint: {\r\n          'fill-color': '#4B83F2',\r\n          'fill-opacity': 0.03,\r\n        },\r\n        layout: {\r\n          visibility: 'none',\r\n        },\r\n      });\r\n\r\n      this.map.addLayer({\r\n        id: 'boundary-line',\r\n        type: 'line',\r\n        source: 'boundary-circle',\r\n        paint: {\r\n          'line-color': '#4B83F2',\r\n          'line-width': 2,\r\n          'line-dasharray': [3, 3],\r\n        },\r\n        layout: {\r\n          visibility: 'none',\r\n        },\r\n      });\r\n      // Debug info\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Show boundary visualization with animation\r\n   */\r\n  private showBoundaryLayers(): void {\r\n    // Debug info\r\n    this.boundaryLayerIds.forEach((layerId) => {\r\n      if (this.map.getLayer(layerId)) {\r\n        this.map.setLayoutProperty(layerId, 'visibility', 'visible');\r\n\r\n        if (layerId === 'boundary-fill') {\r\n          let opacity = 0;\r\n          const animateOpacity = () => {\r\n            if (opacity < 0.03) {\r\n              opacity += 0.005;\r\n              this.map.setPaintProperty(layerId, 'fill-opacity', opacity);\r\n              requestAnimationFrame(animateOpacity);\r\n            }\r\n          };\r\n          animateOpacity();\r\n        }\r\n      } else {\r\n        // Debug info\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Hide boundary visualization with animation\r\n   */\r\n  private hideBoundaryLayers(): void {\r\n    // Debug info\r\n    this.boundaryLayerIds.forEach((layerId) => {\r\n      if (this.map.getLayer(layerId)) {\r\n        if (layerId === 'boundary-fill') {\r\n          let opacity = (this.map.getPaintProperty(layerId, 'fill-opacity') as number) || 0.03;\r\n          const animateOpacity = () => {\r\n            if (opacity > 0) {\r\n              opacity -= 0.005;\r\n              const currentOpacity = Math.max(0, opacity);\r\n              this.map.setPaintProperty(layerId, 'fill-opacity', currentOpacity);\r\n              if (currentOpacity > 0) {\r\n                requestAnimationFrame(animateOpacity);\r\n              } else {\r\n                this.map.setLayoutProperty(layerId, 'visibility', 'none');\r\n              }\r\n            } else {\r\n              this.map.setLayoutProperty(layerId, 'visibility', 'none');\r\n            }\r\n          };\r\n          animateOpacity();\r\n        } else {\r\n          this.map.setLayoutProperty(layerId, 'visibility', 'none');\r\n        }\r\n      } else {\r\n        // Debug info\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update search radius visualization around user\r\n   */\r\n  private updateSearchRadius(center: [number, number]): void {\r\n    if (!this.map.getSource(this.searchRadiusId)) {\r\n      // Debug info\r\n      return;\r\n    }\r\n\r\n    // Create circle coordinates\r\n    const generateCircle = (\r\n      center: [number, number],\r\n      radiusInM: number,\r\n      pointCount = 64\r\n    ): [number, number][] => {\r\n      const point = {\r\n        latitude: center[1],\r\n        longitude: center[0],\r\n      };\r\n\r\n      const radiusKm = radiusInM / 1000;\r\n      const points: [number, number][] = [];\r\n\r\n      // Convert km to degrees based on latitude\r\n      const degreesLongPerKm = radiusKm / (111.32 * Math.cos((point.latitude * Math.PI) / 180));\r\n      const degreesLatPerKm = radiusKm / 110.574;\r\n\r\n      // Generate points around the circle\r\n      for (let i = 0; i < pointCount; i++) {\r\n        const angle = (i / pointCount) * (2 * Math.PI);\r\n        const dx = degreesLongPerKm * Math.cos(angle);\r\n        const dy = degreesLatPerKm * Math.sin(angle);\r\n        points.push([point.longitude + dx, point.latitude + dy]);\r\n      }\r\n\r\n      // Close the loop\r\n      points.push(points[0]);\r\n      return points;\r\n    };\r\n\r\n    const circleCoords = generateCircle(center, this.radiusInMeters);\r\n\r\n    // Update both radius layers\r\n    [this.searchRadiusId, this.searchRadiusOuterId].forEach((sourceId) => {\r\n      const source = this.map.getSource(sourceId);\r\n      if (source && 'setData' in source) {\r\n        (source as any).setData({\r\n          type: 'Feature',\r\n          geometry: {\r\n            type: 'Polygon',\r\n            coordinates: [circleCoords],\r\n          },\r\n        });\r\n      } else {\r\n        // Debug info\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear search radius visualization\r\n   */\r\n  private clearSearchRadius(): void {\r\n    if (this.map.getSource(this.searchRadiusId)) {\r\n      [this.searchRadiusId, this.searchRadiusOuterId].forEach((sourceId) => {\r\n        const source = this.map.getSource(sourceId);\r\n        if (source && 'setData' in source) {\r\n          (source as any).setData({\r\n            type: 'Feature',\r\n            geometry: {\r\n              type: 'Polygon',\r\n              coordinates: [[]],\r\n            },\r\n          });\r\n        } else {\r\n          // Debug info\r\n        }\r\n      });\r\n    } else {\r\n      // Debug info\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle geolocation errors\r\n   */\r\n  private handleGeolocationError(error: GeolocationError): void {\r\n    // Debug info\r\n\r\n    // Get current language\r\n    const lang = detectLanguage();\r\n    const t = boundaryTranslations[lang];\r\n\r\n    const errorMessages: Record<number, string> = {\r\n      1: t.locationDenied,\r\n      2: t.locationUnavailable,\r\n      3: t.locationTimeout,\r\n    };\r\n    const defaultMessage = t.locationError;\r\n\r\n    this.showNotification(errorMessages[error.code] || defaultMessage);\r\n  }\r\n\r\n  /**\r\n   * Show notification to user\r\n   */\r\n  private showNotification(message: string): void {\r\n    // Debug info\r\n    const notification = document.createElement('div');\r\n    notification.className = 'geolocation-error-notification';\r\n    notification.textContent = message;\r\n    document.body.appendChild(notification);\r\n\r\n    setTimeout(() => notification.remove(), 5000);\r\n  }\r\n\r\n  /**\r\n   * Create boundary circle GeoJSON\r\n   */\r\n  private createBoundaryCircle(): GeoJSON.Feature<GeoJSON.Polygon> {\r\n    const center = {\r\n      latitude: this.centerPoint[1],\r\n      longitude: this.centerPoint[0],\r\n    };\r\n\r\n    const radiusKm = this.boundaryRadius;\r\n    const points: [number, number][] = [];\r\n\r\n    // Convert km to degrees based on latitude\r\n    const degreesLongPerKm = radiusKm / (111.32 * Math.cos((center.latitude * Math.PI) / 180));\r\n    const degreesLatPerKm = radiusKm / 110.574;\r\n\r\n    // Generate points around the circle\r\n    for (let i = 0; i <= 64; i++) {\r\n      const angle = (i / 64) * (2 * Math.PI);\r\n      const dx = degreesLongPerKm * Math.cos(angle);\r\n      const dy = degreesLatPerKm * Math.sin(angle);\r\n      points.push([center.longitude + dx, center.latitude + dy]);\r\n    }\r\n\r\n    return {\r\n      type: 'Feature',\r\n      properties: {},\r\n      geometry: {\r\n        type: 'Polygon',\r\n        coordinates: [points],\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if position is within boundary\r\n   */\r\n  private isWithinBoundary(position: [number, number]): boolean {\r\n    const distance = this.calculateDistance(\r\n      position[1],\r\n      position[0],\r\n      this.centerPoint[1],\r\n      this.centerPoint[0]\r\n    );\r\n    const isWithin = distance <= this.boundaryRadius;\r\n    return isWithin;\r\n  }\r\n\r\n  /**\r\n   * Calculate distance between coordinates in km\r\n   */\r\n  private calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\r\n    // Haversine formula\r\n    const toRad = (deg: number) => deg * (Math.PI / 180);\r\n\r\n    const dLat = toRad(lat2 - lat1);\r\n    const dLon = toRad(lon2 - lon1);\r\n\r\n    const a =\r\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return 6371 * c; // Earth radius in km\r\n  }\r\n\r\n  /**\r\n   * Show boundary popup when user is outside boundary\r\n   */\r\n  private showBoundaryPopup(): void {\r\n    // Debug info\r\n\r\n    // Get current language\r\n    const lang = detectLanguage();\r\n    const t = boundaryTranslations[lang];\r\n\r\n    // Remove existing popup if any\r\n    const existingPopup = document.querySelector('.location-boundary-popup');\r\n    if (existingPopup) {\r\n      // Debug info\r\n      existingPopup.remove();\r\n    }\r\n\r\n    // Create new popup\r\n    const popup = document.createElement('div');\r\n    popup.className = 'location-boundary-popup';\r\n    this.boundaryPopup = popup; // Track for cleanup\r\n\r\n    const heading = document.createElement('h3');\r\n    heading.textContent = t.title;\r\n\r\n    const text = document.createElement('p');\r\n    text.textContent = t.message;\r\n\r\n    // Auto-close after 3 seconds\r\n    const self = this;\r\n    this.addTrackedTimeout(() => {\r\n      // Animate popup out\r\n      if (window.innerWidth <= 768) {\r\n        popup.style.transform = 'translateY(100%)';\r\n      } else {\r\n        popup.style.transform = 'translateX(120%)';\r\n      }\r\n\r\n      this.addTrackedTimeout(() => {\r\n        if (popup.parentNode) {\r\n          popup.remove();\r\n        }\r\n        if (this.boundaryPopup === popup) {\r\n          this.boundaryPopup = undefined;\r\n        }\r\n      }, 600);\r\n\r\n      this.addTrackedTimeout(() => {\r\n        self.hideBoundaryLayers();\r\n      }, 200);\r\n\r\n      // Fly back to intro animation location\r\n      const finalZoom = window.matchMedia('(max-width: 479px)').matches ? 17 : 18;\r\n\r\n      // Debug info\r\n      self.map.flyTo({\r\n        center: CONFIG.MAP.center,\r\n        zoom: finalZoom,\r\n        pitch: 55,\r\n        bearing: -17.6,\r\n        duration: 3000,\r\n        essential: true,\r\n        easing: (t: number) => t * (2 - t),\r\n      });\r\n    }, 3000); // Close after 3 seconds\r\n\r\n    // Assemble popup\r\n    popup.appendChild(heading);\r\n    popup.appendChild(text);\r\n    document.body.appendChild(popup);\r\n    // Debug info\r\n\r\n    // Highlight boundary\r\n    if (this.map.getLayer('boundary-fill')) {\r\n      // Debug info\r\n      this.map.setPaintProperty('boundary-fill', 'fill-opacity', 0.05);\r\n      this.map.setPaintProperty('boundary-line', 'line-width', 3);\r\n\r\n      this.addTrackedTimeout(() => {\r\n        if (this.map.getLayer('boundary-fill')) {\r\n          this.map.setPaintProperty('boundary-fill', 'fill-opacity', 0.03);\r\n        }\r\n        if (this.map.getLayer('boundary-line')) {\r\n          this.map.setPaintProperty('boundary-line', 'line-width', 2);\r\n        }\r\n      }, 2000);\r\n    } else {\r\n      // Debug info\r\n    }\r\n\r\n    // Fly to center to show the boundary (only if not already flying)\r\n    if (!this.map.isMoving() && !this.map.isEasing()) {\r\n      // Debug info\r\n      this.map.flyTo({\r\n        center: this.centerPoint,\r\n        zoom: 14,\r\n        pitch: 0,\r\n        bearing: 0,\r\n        duration: 1500,\r\n      });\r\n    } else {\r\n      // Debug info\r\n    }\r\n\r\n    // Show popup with animation\r\n    requestAnimationFrame(() => {\r\n      popup.offsetHeight;\r\n      popup.classList.add('show');\r\n      // Debug info\r\n    });\r\n\r\n    // Debug info\r\n  }\r\n\r\n  /**\r\n   * Cleanup method to prevent memory leaks\r\n   */\r\n  public cleanup(): void {\r\n    // Clear all distance markers\r\n    this.clearDistanceMarkers();\r\n\r\n    // Remove geolocate control\r\n    if (this.geolocateControl) {\r\n      this.map.removeControl(this.geolocateControl);\r\n      this.geolocateControl = undefined;\r\n    }\r\n\r\n    // Clear all tracked timeouts\r\n    this.timeouts.forEach((id) => clearTimeout(id));\r\n    this.timeouts.clear();\r\n\r\n    // Remove all tracked event listeners\r\n    this.eventListeners.forEach(({ element, event, handler }) => {\r\n      element.removeEventListener(event, handler);\r\n    });\r\n    this.eventListeners.length = 0;\r\n\r\n    // Remove boundary popup if exists\r\n    if (this.boundaryPopup && this.boundaryPopup.parentNode) {\r\n      this.boundaryPopup.parentNode.removeChild(this.boundaryPopup);\r\n      this.boundaryPopup = undefined;\r\n    }\r\n\r\n    // Clear map sources\r\n    const sources = [this.searchRadiusId, this.searchRadiusOuterId];\r\n    sources.forEach((sourceId) => {\r\n      if (this.map.getSource(sourceId)) {\r\n        this.map.removeSource(sourceId);\r\n      }\r\n    });\r\n\r\n    // Clear boundary layers\r\n    this.boundaryLayerIds.forEach((layerId) => {\r\n      if (this.map.getLayer(layerId)) {\r\n        this.map.removeLayer(layerId);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear distance markers atomically\r\n   */\r\n  private clearDistanceMarkers(): void {\r\n    if (this.distanceMarkers.length > 0) {\r\n      this.distanceMarkers.forEach((marker) => marker.remove());\r\n      this.distanceMarkers.length = 0; // Clear array atomically\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper to track event listeners for cleanup\r\n   */\r\n  private addTrackedEventListener(element: any, event: string, handler: Function): void {\r\n    element.addEventListener(event, handler);\r\n    this.eventListeners.push({ element, event, handler });\r\n  }\r\n\r\n  /**\r\n   * Helper to track timeouts for cleanup\r\n   */\r\n  private addTrackedTimeout(callback: Function, delay: number): number {\r\n    const id = window.setTimeout(() => {\r\n      this.timeouts.delete(id);\r\n      callback();\r\n    }, delay);\r\n    this.timeouts.add(id);\r\n    return id;\r\n  }\r\n}\r\n", "// Map initialization module\r\n\r\nimport type { Map } from 'mapbox-gl';\r\n\r\nimport { MAP_OPTIONS, MAPBOX_ACCESS_TOKEN } from './config.js';\r\nimport { setMap } from './state.js';\r\n\r\n// Extend global interface for mapboxgl\r\ndeclare global {\r\n  const mapboxgl: {\r\n    accessToken: string;\r\n    Map: new (options: any) => Map;\r\n  };\r\n}\r\n\r\n// Set Mapbox access token\r\nmapboxgl.accessToken = MAPBOX_ACCESS_TOKEN;\r\n\r\n// Initialize and export map\r\nexport function initializeMap(): Map {\r\n  const map = new mapboxgl.Map(MAP_OPTIONS);\r\n\r\n  // Store map in global state\r\n  setMap(map);\r\n\r\n  // Store original flyTo method\r\n  const originalFlyTo = map.flyTo.bind(map);\r\n  (map as any)._originalFlyTo = originalFlyTo;\r\n\r\n  // Override flyTo to add custom behavior if needed\r\n  map.flyTo = function (options: any) {\r\n    // Add any custom behavior here\r\n    return originalFlyTo(options);\r\n  };\r\n\r\n  return map;\r\n}\r\n", "// Map interaction handlers module\r\n\r\nimport type { Map } from 'mapbox-gl';\r\n\r\nimport { CONFIG } from './config.js';\r\nimport { applyMapFilters } from './filters.js';\r\nimport { setupLocationFilters } from './filters.js';\r\nimport { loadFiltersAndUpdateMap } from './localStorage.js';\r\nimport { addMarkers, loadIcons } from './markers.js';\r\nimport { closeItem } from './popups.js';\r\nimport { setActivePopup, state } from './state.js';\r\n\r\n// Global declaration for jQuery\r\ndeclare global {\r\n  interface Window {\r\n    $: typeof import('jquery');\r\n  }\r\n}\r\n\r\nconst { $ } = window;\r\n\r\n/**\r\n * Setup map load event handler\r\n * @param map - The mapbox map instance\r\n */\r\nexport function setupMapLoadHandler(map: Map): void {\r\n  map.on('load', () => {\r\n    loadFiltersAndUpdateMap();\r\n\r\n    // Add 3D buildings layer with clip layer to exclude Woonboulevard area\r\n    map.once('idle', () => {\r\n      // Find the first symbol layer (labels) to insert buildings below\r\n      const layers = map.getStyle().layers;\r\n      const firstSymbolLayerId = layers.find((layer) => layer.type === 'symbol')?.id;\r\n\r\n      // Add the Mapbox Streets v8 tileset as a source if it doesn't exist\r\n      if (!map.getSource('mapbox-streets')) {\r\n        map.addSource('mapbox-streets', {\r\n          type: 'vector',\r\n          url: 'mapbox://mapbox.mapbox-streets-v8',\r\n        });\r\n      }\r\n\r\n      // Add 3D buildings layer\r\n      if (!map.getLayer('heerlen-buildings')) {\r\n        map.addLayer(\r\n          {\r\n            id: 'heerlen-buildings',\r\n            type: 'fill-extrusion',\r\n            source: 'mapbox-streets',\r\n            'source-layer': 'building',\r\n            filter: ['==', ['get', 'extrude'], 'true'],\r\n            minzoom: 15,\r\n            paint: {\r\n              'fill-extrusion-color': '#f0ebe0',\r\n              'fill-extrusion-height': ['get', 'height'],\r\n              'fill-extrusion-base': ['get', 'min_height'],\r\n              'fill-extrusion-opacity': 1.0,\r\n              'fill-extrusion-vertical-gradient': false,\r\n            },\r\n          },\r\n          firstSymbolLayerId\r\n        );\r\n      }\r\n\r\n      // Add clip layer to hide 3D buildings in Woonboulevard area\r\n      if (!map.getSource('woonboulevard-clip')) {\r\n        map.addSource('woonboulevard-clip', {\r\n          type: 'geojson',\r\n          data: {\r\n            type: 'Feature',\r\n            geometry: {\r\n              type: 'Polygon',\r\n              coordinates: [\r\n                [\r\n                  [5.939008, 50.900200],\r\n                  [5.941097, 50.899208],\r\n                  [5.942271, 50.898270],\r\n                  [5.945627, 50.897434],\r\n                  [5.951921, 50.896131],\r\n                  [5.953629, 50.897061],\r\n                  [5.946328, 50.899788],\r\n                  [5.940458, 50.901714],\r\n                  [5.938951, 50.900265],\r\n                  [5.939008, 50.900200], // Close polygon\r\n                ],\r\n              ],\r\n            },\r\n          },\r\n        });\r\n      }\r\n\r\n      if (!map.getLayer('woonboulevard-clip-layer')) {\r\n        map.addLayer({\r\n          id: 'woonboulevard-clip-layer',\r\n          type: 'clip',\r\n          source: 'woonboulevard-clip',\r\n          minzoom: 15,\r\n        } as any);\r\n      }\r\n    });\r\n\r\n    // Load markers asynchronously for better performance\r\n    addMarkers(map)\r\n      .then(() => {\r\n        setupLocationFilters();\r\n        // Apply filters after markers are fully loaded\r\n        applyMapFilters();\r\n      })\r\n      .catch((error) => {\r\n        // Handle marker loading error gracefully\r\n        setupLocationFilters();\r\n      });\r\n\r\n    // Initial animation on load - Woonboulevard\r\n    setTimeout(() => {\r\n      const finalZoom = window.matchMedia('(max-width: 479px)').matches ? 17.5 : 18;\r\n      // Woonboulevard coordinates\r\n      const startCoords: [number, number] = [5.945835, 50.889458];\r\n      const destinationCoords: [number, number] = [5.942761, 50.899135];\r\n      // Heerlen Centrum start: [5.975338618538545, 50.89054201081809]\r\n      // Heerlen Centrum eind: [5.977246733617121, 50.888996872875126]\r\n\r\n      // Start position (bird's eye view from above, ver uitgezoomd)\r\n      map.jumpTo({\r\n        center: startCoords,\r\n        zoom: 14,\r\n        pitch: 0,\r\n        bearing: 180,\r\n      });\r\n\r\n      // Fly to destination (ver ingezoomd)\r\n      map.flyTo({\r\n        center: destinationCoords,\r\n        zoom: finalZoom,\r\n        pitch: 65,\r\n        bearing: -17.6,\r\n        duration: 6000,\r\n        essential: true,\r\n        easing: (t: number) => t * (2 - t), // Ease out quad\r\n      });\r\n    }, 1500); // Start animatie na 1.5 seconden\r\n  });\r\n}\r\n\r\n/**\r\n * Setup sidebar close button handler\r\n */\r\nexport function setupSidebarHandlers(): void {\r\n  // Close sidebar button\r\n  $('.close-block').on('click', () => {\r\n    closeItem();\r\n  });\r\n}\r\n\r\n/**\r\n * Setup map interaction handlers for hiding popups and sidebar\r\n * @param map - The mapbox map instance\r\n */\r\nexport function setupMapInteractionHandlers(map: Map): void {\r\n  // Hide popups and sidebar on map interactions\r\n  ['dragstart', 'zoomstart', 'rotatestart', 'pitchstart'].forEach((eventType) => {\r\n    map.on(eventType as any, () => {\r\n      // Hide sidebar if visible\r\n      const visibleItem = $('.locations-map_item.is--show');\r\n      if (visibleItem.length) {\r\n        visibleItem.css({\r\n          opacity: '0',\r\n          transform: 'translateY(40px) scale(0.6)',\r\n          transition: 'all 400ms cubic-bezier(0.68, -0.55, 0.265, 1.55)',\r\n        });\r\n\r\n        setTimeout(() => {\r\n          visibleItem.removeClass('is--show');\r\n        }, 400);\r\n      }\r\n\r\n      // Hide popup if visible\r\n      if (state.activePopup) {\r\n        const popupContent = state.activePopup\r\n          .getElement()\r\n          .querySelector('.mapboxgl-popup-content') as HTMLElement;\r\n        popupContent.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';\r\n        popupContent.style.transform = 'rotate(-5deg) translateY(40px) scale(0.6)';\r\n        popupContent.style.opacity = '0';\r\n\r\n        setTimeout(() => {\r\n          state.activePopup!.remove();\r\n          setActivePopup(null);\r\n        }, 400);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Close popup when clicking on the map (outside popup and markers)\r\n  map.on('click', (e) => {\r\n    // Check if click was on a marker or popup\r\n    const features = map.queryRenderedFeatures(e.point, {\r\n      layers: ['location-markers'],\r\n    });\r\n\r\n    // Only close popup if we didn't click on a marker and popup exists\r\n    if (features.length === 0 && state.activePopup) {\r\n      // Check if the click was inside the popup element\r\n      const popupElement = state.activePopup.getElement();\r\n      const clickTarget = e.originalEvent.target as HTMLElement;\r\n\r\n      // If click was not inside the popup, close it\r\n      if (!popupElement.contains(clickTarget)) {\r\n        const popupContent = popupElement.querySelector('.mapboxgl-popup-content') as HTMLElement;\r\n        if (popupContent) {\r\n          popupContent.style.transition = 'all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)';\r\n          popupContent.style.transform = 'rotate(-5deg) translateY(40px) scale(0.6)';\r\n          popupContent.style.opacity = '0';\r\n        }\r\n\r\n        setTimeout(() => {\r\n          if (state.activePopup) {\r\n            state.activePopup.remove();\r\n            setActivePopup(null);\r\n          }\r\n        }, 400);\r\n\r\n        // Also hide sidebar if visible\r\n        const visibleItem = $('.locations-map_item.is--show');\r\n        if (visibleItem.length) {\r\n          visibleItem.css({\r\n            opacity: '0',\r\n            transform: 'translateY(40px) scale(0.6)',\r\n            transition: 'all 400ms cubic-bezier(0.68, -0.55, 0.265, 1.55)',\r\n          });\r\n\r\n          setTimeout(() => {\r\n            visibleItem.removeClass('is--show');\r\n          }, 400);\r\n        }\r\n      }\r\n    }\r\n  });\r\n}\r\n", "// Marker management module\r\n\r\nimport type { Feature, Point } from 'geojson';\r\nimport type { Map } from 'mapbox-gl';\r\n\r\nimport { CONFIG } from './config.js';\r\nimport { resourceManager } from './resourceManager.js';\r\nimport { state } from './state.js';\r\n\r\ninterface LocationFeature extends Feature<Point> {\r\n  properties: {\r\n    icon?: string;\r\n    color: string;\r\n    name: string;\r\n    [key: string]: any;\r\n  };\r\n}\r\n\r\n// Icon loading cache and optimization\r\nconst iconCache = new Map<string, HTMLImageElement>();\r\nconst loadingIcons = new Set<string>();\r\n\r\n/**\r\n * Load marker icons with batching and caching\r\n */\r\nexport async function loadIcons(map: Map): Promise<void> {\r\n  // Get unique icons from features\r\n  const uniqueIcons = [\r\n    ...new Set(\r\n      state.mapLocations.features\r\n        .map((feature) => feature.properties.icon)\r\n        .filter((icon): icon is string => !!icon) // Filter out null/undefined icons and type guard\r\n    ),\r\n  ];\r\n\r\n  // Filter out already loaded and currently loading icons\r\n  const iconsToLoad = uniqueIcons.filter(\r\n    (iconUrl) => !map.hasImage(iconUrl) && !loadingIcons.has(iconUrl)\r\n  );\r\n\r\n  if (iconsToLoad.length === 0) return;\r\n\r\n  // Mark icons as loading\r\n  iconsToLoad.forEach((iconUrl) => loadingIcons.add(iconUrl));\r\n\r\n  // Load icons in parallel with proper error handling\r\n  const loadPromises = iconsToLoad.map((iconUrl) =>\r\n    loadSingleIcon(map, iconUrl).finally(() => loadingIcons.delete(iconUrl))\r\n  );\r\n\r\n  // Wait for all icons to load (or fail)\r\n  await Promise.allSettled(loadPromises);\r\n}\r\n\r\n/**\r\n * Load a single icon - REVERTED to direct loading for Mapbox compatibility\r\n */\r\nasync function loadSingleIcon(map: Map, iconUrl: string): Promise<void> {\r\n  try {\r\n    // Check cache first\r\n    if (iconCache.has(iconUrl)) {\r\n      const cachedImage = iconCache.get(iconUrl)!;\r\n      if (!map.hasImage(iconUrl)) {\r\n        map.addImage(iconUrl, cachedImage);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Load image directly for Mapbox compatibility\r\n    const image = await loadImageAsync(iconUrl);\r\n    iconCache.set(iconUrl, image);\r\n\r\n    if (!map.hasImage(iconUrl)) {\r\n      map.addImage(iconUrl, image);\r\n    }\r\n  } catch (error) {\r\n    // Failed to load icon - continue silently\r\n  }\r\n}\r\n\r\n/**\r\n * Load image asynchronously - restored for Mapbox compatibility\r\n */\r\nfunction loadImageAsync(url: string): Promise<HTMLImageElement> {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    img.crossOrigin = 'anonymous';\r\n    img.onload = () => resolve(img);\r\n    img.onerror = () => reject(new Error(`Failed to load icon: ${url}`));\r\n    img.src = url;\r\n  });\r\n}\r\n\r\n/**\r\n * Add custom markers to map\r\n */\r\nexport async function addMarkers(map: Map): Promise<void> {\r\n  if (state.markersAdded) return;\r\n\r\n  // Load icons first (wait for completion)\r\n  await loadIcons(map);\r\n\r\n  // Add source\r\n  map.addSource('locations', {\r\n    type: 'geojson',\r\n    data: state.mapLocations,\r\n  });\r\n\r\n  // Add layers\r\n  const layers = [\r\n    // Circle marker layer\r\n    {\r\n      id: 'location-markers',\r\n      type: 'circle' as const,\r\n      paint: {\r\n        'circle-color': [\r\n          'case',\r\n          ['==', ['get', 'type'], 'ar'],\r\n          ['get', 'arkleur'], // Use arkleur property for AR markers\r\n          ['get', 'color'], // Use normal color property for other markers\r\n        ],\r\n        'circle-radius': [\r\n          'interpolate',\r\n          ['linear'],\r\n          ['zoom'],\r\n          CONFIG.MARKER_ZOOM.min,\r\n          2,\r\n          CONFIG.MARKER_ZOOM.small,\r\n          5,\r\n          CONFIG.MARKER_ZOOM.medium,\r\n          8,\r\n          CONFIG.MARKER_ZOOM.large,\r\n          10,\r\n        ],\r\n        'circle-stroke-width': 1,\r\n        'circle-stroke-color': '#ffffff',\r\n        'circle-opacity': 0,\r\n      },\r\n    },\r\n    // Icon layer\r\n    {\r\n      id: 'location-icons',\r\n      type: 'symbol' as const,\r\n      layout: {\r\n        'icon-image': ['get', 'icon'],\r\n        'icon-size': [\r\n          'interpolate',\r\n          ['linear'],\r\n          ['zoom'],\r\n          CONFIG.MARKER_ZOOM.min,\r\n          0.05,\r\n          CONFIG.MARKER_ZOOM.small,\r\n          0.08,\r\n          CONFIG.MARKER_ZOOM.medium,\r\n          0.12,\r\n          CONFIG.MARKER_ZOOM.large,\r\n          0.15,\r\n        ],\r\n        'icon-allow-overlap': true,\r\n        'icon-anchor': 'center' as const,\r\n      },\r\n      paint: {\r\n        'icon-opacity': 0,\r\n      },\r\n    },\r\n    // Label layer\r\n    {\r\n      id: 'location-labels',\r\n      type: 'symbol' as const,\r\n      layout: {\r\n        'text-field': ['get', 'name'],\r\n        'text-size': [\r\n          'interpolate',\r\n          ['linear'],\r\n          ['zoom'],\r\n          CONFIG.MARKER_ZOOM.min,\r\n          8,\r\n          CONFIG.MARKER_ZOOM.small,\r\n          10,\r\n          CONFIG.MARKER_ZOOM.medium,\r\n          11,\r\n          CONFIG.MARKER_ZOOM.large,\r\n          12,\r\n        ],\r\n        'text-offset': [0, 1] as [number, number],\r\n        'text-anchor': 'top' as const,\r\n        'text-allow-overlap': false,\r\n      },\r\n      paint: {\r\n        'text-color': ['get', 'color'],\r\n        'text-halo-color': '#ffffff',\r\n        'text-halo-width': 2,\r\n        'text-opacity': 0,\r\n      },\r\n    },\r\n  ];\r\n\r\n  // Add each layer\r\n  layers.forEach((layer) => map.addLayer({ ...layer, source: 'locations' }));\r\n\r\n  // Setup marker hover effects\r\n  setupMarkerInteractions(map);\r\n\r\n  // Animate marker appearance\r\n  animateMarkerAppearance(map);\r\n\r\n  state.markersAdded = true;\r\n}\r\n\r\n/**\r\n * Animate marker appearance with frame limiting\r\n */\r\nfunction animateMarkerAppearance(map: Map): void {\r\n  let opacity = 0;\r\n  let lastFrameTime = 0;\r\n  const targetFPS = 30; // Limit to 30 FPS for better performance\r\n  const frameInterval = 1000 / targetFPS;\r\n\r\n  const animateMarkers = (currentTime: number): void => {\r\n    // Frame limiting - only update if enough time has passed\r\n    if (currentTime - lastFrameTime < frameInterval) {\r\n      if (opacity < 1) {\r\n        requestAnimationFrame(animateMarkers);\r\n      }\r\n      return;\r\n    }\r\n\r\n    lastFrameTime = currentTime;\r\n    opacity += 0.08; // Slightly slower animation for smoother effect\r\n\r\n    // Clamp opacity to maximum of 1.0\r\n    const clampedOpacity = Math.min(opacity, 1.0);\r\n\r\n    // Batch paint property updates for better performance\r\n    try {\r\n      if (map.getLayer('location-markers')) {\r\n        map.setPaintProperty('location-markers', 'circle-opacity', clampedOpacity);\r\n      }\r\n      if (map.getLayer('location-icons')) {\r\n        map.setPaintProperty('location-icons', 'icon-opacity', clampedOpacity);\r\n      }\r\n      if (map.getLayer('location-labels')) {\r\n        map.setPaintProperty('location-labels', 'text-opacity', clampedOpacity);\r\n      }\r\n    } catch (e) {\r\n      // Layers might have been removed during animation\r\n      return;\r\n    }\r\n\r\n    if (opacity < 1) {\r\n      requestAnimationFrame(animateMarkers);\r\n    }\r\n  };\r\n\r\n  // Start animation after a short delay\r\n  setTimeout(() => requestAnimationFrame(animateMarkers), 100);\r\n}\r\n\r\n/**\r\n * Setup marker hover effects\r\n */\r\nfunction setupMarkerInteractions(map: Map): void {\r\n  map.on('mouseenter', 'location-markers', () => {\r\n    map.getCanvas().style.cursor = 'pointer';\r\n  });\r\n\r\n  map.on('mouseleave', 'location-markers', () => {\r\n    map.getCanvas().style.cursor = '';\r\n  });\r\n}\r\n\r\n/**\r\n * Update marker visibility based on zoom level\r\n */\r\nexport function updateMarkerVisibility(map: Map, zoom: number): void {\r\n  // You can add zoom-based visibility logic here if needed\r\n  // For now, the visibility is handled by the interpolation expressions in the layer styles\r\n}\r\n\r\n/**\r\n * Create custom marker element\r\n */\r\nexport function createCustomMarker(location: LocationFeature): HTMLDivElement {\r\n  const markerEl = document.createElement('div');\r\n  markerEl.className = 'custom-marker';\r\n\r\n  // Add location-specific styling if needed\r\n  if (location.properties.color) {\r\n    markerEl.style.backgroundColor = location.properties.color;\r\n  }\r\n\r\n  return markerEl;\r\n}\r\n\r\n/**\r\n * Update markers data source\r\n */\r\nexport function updateMarkersData(map: Map): void {\r\n  const source = map.getSource('locations');\r\n  if (source && 'setData' in source) {\r\n    (source as any).setData(state.mapLocations);\r\n  }\r\n}\r\n", "// Resource management module for optimized loading and caching\r\n\r\nexport interface ResourceLoadOptions {\r\n  maxSize?: number;\r\n  quality?: number;\r\n  timeout?: number;\r\n}\r\n\r\n/**\r\n * Centralized resource manager for images, models, and other assets\r\n */\r\nexport class ResourceManager {\r\n  private static instance: ResourceManager;\r\n  private imageCache = new WeakMap<string, HTMLImageElement>();\r\n  private modelCache = new Map<string, any>();\r\n  private textureCache = new Map<string, any>();\r\n  private loadingPromises = new Map<string, Promise<any>>();\r\n  private failedResources = new Set<string>();\r\n\r\n  // Performance tracking\r\n  private loadTimes = new Map<string, number>();\r\n  private loadCounts = new Map<string, number>();\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): ResourceManager {\r\n    if (!ResourceManager.instance) {\r\n      ResourceManager.instance = new ResourceManager();\r\n    }\r\n    return ResourceManager.instance;\r\n  }\r\n\r\n  /**\r\n   * Load and optimize an image with caching\r\n   */\r\n  async loadOptimizedImage(\r\n    url: string,\r\n    options: ResourceLoadOptions = {}\r\n  ): Promise<HTMLImageElement> {\r\n    const { maxSize = 512, timeout = 10000 } = options;\r\n\r\n    // Check failed resources first\r\n    if (this.failedResources.has(url)) {\r\n      throw new Error(`Resource previously failed to load: ${url}`);\r\n    }\r\n\r\n    // Check if already loading\r\n    if (this.loadingPromises.has(url)) {\r\n      return this.loadingPromises.get(url)!;\r\n    }\r\n\r\n    // Check cache\r\n    if (this.imageCache.has(url)) {\r\n      return this.imageCache.get(url)!;\r\n    }\r\n\r\n    // Create loading promise\r\n    const loadPromise = this.loadImageWithOptimization(url, maxSize, timeout);\r\n    this.loadingPromises.set(url, loadPromise);\r\n\r\n    try {\r\n      const result = await loadPromise;\r\n      this.imageCache.set(url, result);\r\n      this.trackLoadSuccess(url);\r\n      return result;\r\n    } catch (error) {\r\n      this.failedResources.add(url);\r\n      this.trackLoadError(url);\r\n      throw error;\r\n    } finally {\r\n      this.loadingPromises.delete(url);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load image with size optimization and timeout\r\n   */\r\n  private loadImageWithOptimization(\r\n    url: string,\r\n    maxSize: number,\r\n    timeout: number\r\n  ): Promise<HTMLImageElement> {\r\n    return new Promise((resolve, reject) => {\r\n      const img = new Image();\r\n      img.crossOrigin = 'anonymous';\r\n\r\n      const timeoutId = setTimeout(() => {\r\n        img.src = ''; // Cancel loading\r\n        reject(new Error(`Image load timeout: ${url}`));\r\n      }, timeout);\r\n\r\n      img.onload = () => {\r\n        clearTimeout(timeoutId);\r\n\r\n        // Check if resizing is needed\r\n        if (Math.max(img.width, img.height) > maxSize) {\r\n          resolve(this.resizeImage(img, maxSize));\r\n        } else {\r\n          resolve(img);\r\n        }\r\n      };\r\n\r\n      img.onerror = () => {\r\n        clearTimeout(timeoutId);\r\n        reject(new Error(`Failed to load image: ${url}`));\r\n      };\r\n\r\n      img.src = url;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Resize image to fit within maxSize while maintaining aspect ratio\r\n   */\r\n  private resizeImage(img: HTMLImageElement, maxSize: number): HTMLImageElement {\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d')!;\r\n\r\n    // Calculate new dimensions\r\n    const scale = Math.min(maxSize / img.width, maxSize / img.height);\r\n    canvas.width = img.width * scale;\r\n    canvas.height = img.height * scale;\r\n\r\n    // Draw resized image\r\n    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\r\n\r\n    // Create new image from canvas\r\n    const resizedImg = new Image();\r\n    resizedImg.src = canvas.toDataURL('image/jpeg', 0.85);\r\n    return resizedImg;\r\n  }\r\n\r\n  /**\r\n   * Load 3D model with caching - FIXED for GLTF\r\n   */\r\n  async loadModel(url: string, loader: any): Promise<any> {\r\n    // Check cache first\r\n    if (this.modelCache.has(url)) {\r\n      return this.modelCache.get(url)!;\r\n    }\r\n\r\n    // Check if already loading\r\n    if (this.loadingPromises.has(url)) {\r\n      return await this.loadingPromises.get(url)!;\r\n    }\r\n\r\n    // Create loading promise\r\n    const loadPromise = new Promise((resolve, reject) => {\r\n      loader.load(\r\n        url,\r\n        (gltf: any) => {\r\n          // For GLTF, we want the whole gltf object, not just scene\r\n          resolve(gltf);\r\n        },\r\n        undefined, // onProgress\r\n        (error: any) => reject(error)\r\n      );\r\n    });\r\n\r\n    this.loadingPromises.set(url, loadPromise);\r\n\r\n    try {\r\n      const model = await loadPromise;\r\n      this.modelCache.set(url, model);\r\n      this.trackLoadSuccess(url);\r\n      return model; // Return original, don't clone GLTF\r\n    } catch (error) {\r\n      this.failedResources.add(url);\r\n      this.trackLoadError(url);\r\n      throw error;\r\n    } finally {\r\n      this.loadingPromises.delete(url);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Optimize 3D model for better performance\r\n   */\r\n  private optimizeModel(model: any): void {\r\n    model.traverse((child: any) => {\r\n      if (child.isMesh) {\r\n        // Enable frustum culling\r\n        child.frustumCulled = true;\r\n\r\n        // Optimize materials\r\n        if (child.material) {\r\n          // Reduce material precision for better performance\r\n          if (child.material.map) {\r\n            child.material.map.generateMipmaps = false;\r\n            child.material.map.minFilter = (window as any).THREE?.LinearFilter || 1006;\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Preload critical resources\r\n   */\r\n  async preloadResources(urls: string[]): Promise<void> {\r\n    const batchSize = 3; // Load 3 resources at a time\r\n    const batches: string[][] = [];\r\n\r\n    for (let i = 0; i < urls.length; i += batchSize) {\r\n      batches.push(urls.slice(i, i + batchSize));\r\n    }\r\n\r\n    for (const batch of batches) {\r\n      const promises = batch.map(\r\n        (url) => this.loadOptimizedImage(url).catch(() => null) // Continue on error\r\n      );\r\n      await Promise.all(promises);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear cache and free memory\r\n   */\r\n  cleanup(): void {\r\n    // Clear caches\r\n    this.imageCache = new WeakMap();\r\n    this.modelCache.clear();\r\n    this.textureCache.clear();\r\n    this.loadingPromises.clear();\r\n\r\n    // Clear tracking\r\n    this.loadTimes.clear();\r\n    this.loadCounts.clear();\r\n    this.failedResources.clear();\r\n  }\r\n\r\n  /**\r\n   * Get performance statistics\r\n   */\r\n  getStats(): {\r\n    cachedImages: number;\r\n    cachedModels: number;\r\n    failedResources: number;\r\n    averageLoadTime: number;\r\n  } {\r\n    const totalLoadTime = Array.from(this.loadTimes.values()).reduce((a, b) => a + b, 0);\r\n    const totalLoads = this.loadTimes.size;\r\n\r\n    return {\r\n      cachedImages: this.imageCache ? -1 : 0, // WeakMap size not accessible\r\n      cachedModels: this.modelCache.size,\r\n      failedResources: this.failedResources.size,\r\n      averageLoadTime: totalLoads > 0 ? totalLoadTime / totalLoads : 0,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Track successful load\r\n   */\r\n  private trackLoadSuccess(url: string): void {\r\n    const now = Date.now();\r\n    this.loadTimes.set(url, now);\r\n    this.loadCounts.set(url, (this.loadCounts.get(url) || 0) + 1);\r\n  }\r\n\r\n  /**\r\n   * Track load error\r\n   */\r\n  private trackLoadError(url: string): void {\r\n    // Error tracking could be extended here\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const resourceManager = ResourceManager.getInstance();\r\n", "// POI filter and interaction module\r\n\r\nimport type { Map } from 'mapbox-gl';\r\n\r\n// Filter out unwanted POI labels\r\nconst excludedNames: string[] = [\r\n  'Brasserie Mijn Streek',\r\n  'De Twee Gezusters',\r\n  'SCHUNCK Bibliotheek Heerlen Glaspaleis',\r\n  'Glaspaleis Schunck',\r\n  'Bagels & Beans',\r\n  'Terras Bagels & Beans',\r\n  'Brunch Bar',\r\n  'Berden',\r\n  'Aroma',\r\n  'Brasserie Goya',\r\n  'Poppodium Nieuwe Nor',\r\n  'Nederlands Mijnmuseum',\r\n  'Smaak & Vermaak',\r\n  'Caf\u00E9 ',\r\n  'De Kromme Toeter',\r\n  'Caf\u00E9 Pelt',\r\n  'Het Romeins Museum',\r\n  \"Pat's Tosti Bar\",\r\n  'Sint-Pancratiuskerk',\r\n  'Cafe Bluff',\r\n  // Add more businesses here if needed\r\n];\r\n\r\n// Cache for optimized POI filtering\r\nlet poiFilterApplied = false;\r\nlet cachedFilter: any[] | null = null;\r\n\r\n/**\r\n * Build POI filter once and cache it\r\n */\r\nfunction buildPOIFilter(): any[] {\r\n  if (cachedFilter) return cachedFilter;\r\n  \r\n  // Create a filter that checks BOTH properties\r\n  let filter: any[] = ['all'];\r\n\r\n  // For each name, make a NOT-condition that checks both properties\r\n  // If either matches, the POI should be hidden\r\n  excludedNames.forEach((name) => {\r\n    // Add a condition that checks BOTH properties\r\n    // If either matches, the POI should be hidden\r\n    filter.push([\r\n      'all',\r\n      ['!=', ['get', 'brand'], name], // Check on brand\r\n      ['!=', ['get', 'name'], name], // Check on name\r\n    ]);\r\n  });\r\n\r\n  // Only show POIs with a name\r\n  filter.push(['has', 'name']);\r\n  \r\n  cachedFilter = filter;\r\n  return filter;\r\n}\r\n\r\n/**\r\n * Apply POI filter to all relevant layers\r\n */\r\nfunction applyPOIFilter(map: Map): void {\r\n  const filter = buildPOIFilter();\r\n  const poiLayers: string[] = [\r\n    'poi-label',\r\n    'poi-scalerank1',\r\n    'poi-scalerank2',\r\n    'poi-scalerank3',\r\n    'poi-scalerank4',\r\n  ];\r\n  \r\n  poiLayers.forEach((layerId) => {\r\n    if (map.getLayer(layerId)) {\r\n      map.setFilter(layerId, filter);\r\n    }\r\n  });\r\n  \r\n  poiFilterApplied = true;\r\n}\r\n\r\n/**\r\n * Setup POI filtering to hide unwanted labels - OPTIMIZED VERSION\r\n * @param {Map} map - The mapbox map instance\r\n */\r\nexport function setupPOIFiltering(map: Map): void {\r\n  // Apply filter immediately if map is already loaded\r\n  if (map.loaded() && !poiFilterApplied) {\r\n    applyPOIFilter(map);\r\n    return;\r\n  }\r\n\r\n  // Otherwise wait for first style load or idle event\r\n  const handleMapReady = () => {\r\n    if (map.loaded() && !poiFilterApplied) {\r\n      applyPOIFilter(map);\r\n      // Remove listeners after applying filter once\r\n      map.off('style.load', handleMapReady);\r\n      map.off('idle', handleMapReady);\r\n    }\r\n  };\r\n\r\n  map.on('style.load', handleMapReady);\r\n  map.on('idle', handleMapReady);\r\n}", "// THREE.js layer module for 3D models and image planes\r\n\r\nimport type { Map } from 'mapbox-gl';\r\n\r\nimport { resourceManager } from './resourceManager.js';\r\n\r\n// Global declarations for THREE.js\r\ndeclare global {\r\n  interface Window {\r\n    THREE: typeof import('three');\r\n    mapboxgl: typeof import('mapbox-gl');\r\n  }\r\n}\r\n\r\n// Use THREE from global window\r\nconst { THREE } = window;\r\nconst { mapboxgl } = window;\r\n\r\ninterface ModelConfig {\r\n  id: string;\r\n  origin: [number, number]; // [lat, lng]\r\n  altitude: number;\r\n  rotate: [number, number, number];\r\n  url: string;\r\n  scale: number;\r\n  materials?: {\r\n    [materialName: string]: string; // material name -> hex color\r\n  };\r\n  textures?: {\r\n    [materialName: string]: string; // material name -> texture URL\r\n  };\r\n}\r\n\r\ninterface ImagePlaneConfig {\r\n  id: string;\r\n  origin: [number, number];\r\n  altitude: number;\r\n  rotate: [number, number, number];\r\n  imageUrl: string;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\ninterface Transform {\r\n  translateX: number;\r\n  translateY: number;\r\n  translateZ: number;\r\n  rotate: [number, number, number];\r\n  scale: number;\r\n}\r\n\r\n// 3D model configurations\r\nconst modelConfigs: ModelConfig[] = [\r\n  // {\r\n  //   id: 'schunck',\r\n  //   origin: [50.88778235149691, 5.979389928151281], // [lat, lng]\r\n  //   altitude: 0,\r\n  //   rotate: [Math.PI / 2, 0.45, 0],\r\n  //   url: 'https://cdn.jsdelivr.net/gh/Artwalters/3dmodels_heerlen@main/schunckv5.glb',\r\n  //   scale: 1.3,\r\n  // },\r\n  // {\r\n  //   id: 'theater',\r\n  //   origin: [50.886541206107225, 5.972454838314243],\r\n  //   altitude: 0,\r\n  //   rotate: [Math.PI / 2, 2.05, 0],\r\n  //   url: 'https://cdn.jsdelivr.net/gh/Artwalters/3dmodels_heerlen@main/theaterheerlenv4.glb',\r\n  //   scale: 0.6,\r\n  // },\r\n  {\r\n    id: 'woonboulevard',\r\n    origin: [50.898577, 5.948917],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/plein3.glb',\r\n    scale: 0.235,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      parking: '#dddfe0',\r\n      WB_Blue: '#0066CC',\r\n      fiber: '#8B4513',\r\n      weg: '#abb6ca',\r\n    },\r\n    textures: {\r\n      branding:\r\n        'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/logoWBV5.png',\r\n    },\r\n  },\r\n  {\r\n    id: 'ikea',\r\n    origin: [50.90036, 5.944277],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/Ikea.glb',\r\n    scale: 0.35,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      ikea_blue: '#0058AB',\r\n      ikea_yellow: '#FBD914',\r\n    },\r\n    textures: {\r\n      branding:\r\n        'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/logoWBV5.png',\r\n    },\r\n  },\r\n  {\r\n    id: 'pilaar_wb',\r\n    origin: [50.89897839003615, 5.942878450522976],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/Paal.glb',\r\n    scale: 0.8,\r\n    materials: {\r\n      ikea_blue: '#0058AB',\r\n      ikea_yellow: '#FBD914',\r\n      'Material.009': '#8C8C8C',\r\n      'Material.008': '#961e15', // Feller rood\r\n      'Material.002': '#FFFFFF',\r\n    },\r\n  },\r\n  {\r\n    id: 'wbbuilding2',\r\n    origin: [50.900156, 5.942504],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/keuken.glb',\r\n    scale: 0.35,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      grey: '#8C8C8C',\r\n      ijzerpanels: '#A8A8A8', // Licht grijs (iets donkerder)\r\n      ijzer: '#606060', // Donker grijs (iets lichter)\r\n    },\r\n    textures: {\r\n      branding:\r\n        'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/logoWBV5.png',\r\n    },\r\n  },\r\n  {\r\n    id: 'carpet_WB',\r\n    origin: [50.900573, 5.941485],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/haco.glb',\r\n    scale: 0.35,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      grey: '#8C8C8C',\r\n      ijzerpanels: '#A8A8A8', // Licht grijs (iets donkerder)\r\n      ijzer: '#606060', // Donker grijs (iets lichter)\r\n    },\r\n    textures: {\r\n      branding:\r\n        'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/logoWBV5.png',\r\n    },\r\n  },\r\n  {\r\n    id: 'goosens_WB',\r\n    origin: [50.901362, 5.941023],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/Goosens.glb',\r\n    scale: 0.33,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      grey: '#8C8C8C',\r\n      ijzerpanels: '#A8A8A8', // Licht grijs (iets donkerder)\r\n      ijzer: '#606060', // Donker grijs (iets lichter)\r\n    },\r\n    textures: {\r\n      branding:\r\n        'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/logoWBV5.png',\r\n    },\r\n  },\r\n  {\r\n    id: 'sanders_WB',\r\n    origin: [50.901511, 5.94041],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/Sanders.glb',\r\n    scale: 0.34,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      grey: '#8C8C8C',\r\n      ijzerpanels: '#A8A8A8', // Licht grijs (iets donkerder)\r\n      ijzer: '#606060', // Donker grijs (iets lichter)\r\n    },\r\n    textures: {\r\n      branding:\r\n        'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/logoWBV5.png',\r\n    },\r\n  },\r\n  {\r\n    id: 'bijstox',\r\n    origin: [50.898831, 5.947769],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 6.25, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/Stox.glb',\r\n    scale: 0.2,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      grey: '#8C8C8C',\r\n      ijzerpanels: '#A8A8A8', // Licht grijs (iets donkerder)\r\n      ijzer: '#606060', // Donker grijs (iets lichter)\r\n    },\r\n    textures: {\r\n      branding:\r\n        'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/logoWBV5.png',\r\n    },\r\n  },\r\n  {\r\n    id: 'subway',\r\n    origin: [50.900655, 5.940551],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/subway.glb',\r\n    scale: 0.33,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      grey: '#8C8C8C',\r\n      ijzerpanels: '#A8A8A8', // Licht grijs (iets donkerder)\r\n      ijzer: '#606060', // Donker grijs (iets lichter)\r\n    },\r\n    textures: {\r\n      branding:\r\n        'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf@main/logoWBV5.png',\r\n    },\r\n  },\r\n  {\r\n    id: 'kfc',\r\n    origin: [50.89855, 5.942557],\r\n    altitude: 0,\r\n    rotate: [Math.PI / 2, 5.76, 0],\r\n    url: 'https://cdn.jsdelivr.net/gh/Artwalters/woonboulevard_buildings_gltf_V3@main/KFC.glb',\r\n    scale: 0.25,\r\n    materials: {\r\n      base: '#ece6d7',\r\n      ramen: '#dae9f7',\r\n      opening: '#ffffff',\r\n      grey: '#8C8C8C',\r\n      ijzerpanels: '#A8A8A8', // Licht grijs (iets donkerder)\r\n      ijzer: '#606060', // Donker grijs (iets lichter)\r\n      wb_rood: '#DC2626', // Feller rood\r\n    },\r\n  },\r\n];\r\n\r\n// Image plane configuration\r\nconst imagePlaneConfig: ImagePlaneConfig = {\r\n  id: 'image1',\r\n  origin: [50.88801513786042, 5.980644311376565],\r\n  altitude: 6.5,\r\n  rotate: [Math.PI / 2, 0.35, 0],\r\n  imageUrl:\r\n    'https://daks2k3a4ib2z.cloudfront.net/671769e099775386585f574d/67adf2bff5be8a200ec2fa55_osgameos_mural-p-130x130q80.png',\r\n  width: 13,\r\n  height: 13,\r\n};\r\n\r\n/**\r\n * Create image plane for THREE.js\r\n * @param config - Image plane configuration\r\n * @return Promise that resolves to the image plane mesh\r\n */\r\nfunction createImagePlane(config: ImagePlaneConfig): Promise<THREE.Mesh> {\r\n  // Convert coordinates\r\n  const mercatorCoord = mapboxgl.MercatorCoordinate.fromLngLat(\r\n    [config.origin[1], config.origin[0]],\r\n    config.altitude\r\n  );\r\n\r\n  // Calculate scale\r\n  const meterScale = mercatorCoord.meterInMercatorCoordinateUnits();\r\n  const geoWidth = config.width * meterScale;\r\n  const geoHeight = config.height * meterScale;\r\n\r\n  return resourceManager.loadOptimizedImage(config.imageUrl, { maxSize: 1024 }).then((image) => {\r\n    // Create texture from optimized image\r\n    const texture = new THREE.Texture(image);\r\n    texture.needsUpdate = true;\r\n    texture.generateMipmaps = false;\r\n    texture.minFilter = THREE.LinearFilter;\r\n    texture.magFilter = THREE.LinearFilter;\r\n\r\n    // Create material\r\n    const material = new THREE.MeshBasicMaterial({\r\n      map: texture,\r\n      transparent: true,\r\n      side: THREE.DoubleSide,\r\n    });\r\n\r\n    // Create geometry\r\n    const geometry = new THREE.PlaneGeometry(geoWidth, geoHeight);\r\n    const plane = new THREE.Mesh(geometry, material);\r\n\r\n    // Store transform data\r\n    plane.userData.transform = {\r\n      translateX: mercatorCoord.x,\r\n      translateY: mercatorCoord.y,\r\n      translateZ: mercatorCoord.z,\r\n      rotate: config.rotate,\r\n      scale: 1,\r\n    } as Transform;\r\n\r\n    return plane;\r\n  });\r\n}\r\n\r\ninterface CustomLayer {\r\n  id: string;\r\n  type: 'custom';\r\n  renderingMode: '3d';\r\n  map?: Map;\r\n  scene?: THREE.Scene;\r\n  camera?: THREE.Camera;\r\n  renderer?: THREE.WebGLRenderer;\r\n  onAdd: (map: Map, gl: WebGLRenderingContext) => void;\r\n  render: (gl: WebGLRenderingContext, matrix: number[]) => void;\r\n}\r\n\r\n/**\r\n * Create custom THREE.js layer\r\n * @return Custom layer object for Mapbox\r\n */\r\nexport function createThreeJSLayer(): CustomLayer {\r\n  return {\r\n    id: '3d-models',\r\n    type: 'custom',\r\n    renderingMode: '3d',\r\n\r\n    onAdd: function (map: Map, gl: WebGLRenderingContext) {\r\n      this.map = map;\r\n      this.scene = new THREE.Scene();\r\n      this.camera = new THREE.Camera();\r\n\r\n      // Setup lighting\r\n      const ambientLight = new THREE.AmbientLight(0xffffff, 0.57);\r\n      this.scene.add(ambientLight);\r\n\r\n      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.55);\r\n      directionalLight.color.setHex(0xfcfcfc);\r\n\r\n      // Position light\r\n      const azimuth = 210 * (Math.PI / 180);\r\n      const polar = 50 * (Math.PI / 180);\r\n      directionalLight.position\r\n        .set(\r\n          Math.sin(azimuth) * Math.sin(polar),\r\n          Math.cos(azimuth) * Math.sin(polar),\r\n          Math.cos(polar)\r\n        )\r\n        .normalize();\r\n      this.scene.add(directionalLight);\r\n\r\n      // Setup renderer\r\n      this.renderer = new THREE.WebGLRenderer({\r\n        canvas: map.getCanvas(),\r\n        context: gl,\r\n        antialias: true,\r\n      });\r\n      this.renderer.autoClear = false;\r\n\r\n      // Load 3D models with Draco compression support\r\n      const loader = new (THREE as any).GLTFLoader();\r\n\r\n      // Setup Draco loader for compressed models\r\n      const dracoLoader = new (THREE as any).DRACOLoader();\r\n      dracoLoader.setDecoderPath('https://unpkg.com/three@0.126.0/examples/js/libs/draco/');\r\n      loader.setDRACOLoader(dracoLoader);\r\n\r\n      modelConfigs.forEach((config) => {\r\n        // Convert coordinates\r\n        const mercCoord = mapboxgl.MercatorCoordinate.fromLngLat(\r\n          [config.origin[1], config.origin[0]],\r\n          config.altitude\r\n        );\r\n\r\n        // Load model using resource manager\r\n        resourceManager\r\n          .loadModel(config.url, loader)\r\n          .then((gltf: any) => {\r\n            const scene3D = gltf.scene;\r\n\r\n            // Apply flat shading and custom colors to all meshes\r\n            scene3D.traverse((child: any) => {\r\n              if (child.isMesh) {\r\n                // Apply custom material colors if defined (but preserve textures)\r\n                if (config.materials && child.material.name) {\r\n                  // Try exact match first, then try basename\r\n                  let materialColor = config.materials[child.material.name];\r\n                  let matchType = 'exact';\r\n                  const baseMaterialName = child.material.name.split('.')[0];\r\n\r\n                  if (!materialColor) {\r\n                    // Strip Blender suffix (e.g., \"ramen.004\" -> \"ramen\")\r\n                    materialColor = config.materials[baseMaterialName];\r\n                    matchType = 'basename';\r\n                  }\r\n\r\n                  // Check for custom texture\r\n                  let textureUrl = config.textures?.[child.material.name];\r\n                  if (!textureUrl && config.textures) {\r\n                    textureUrl = config.textures[baseMaterialName];\r\n                  }\r\n\r\n                  // Convert windows to glossy material with blue tint\r\n                  if (baseMaterialName === 'ramen') {\r\n                    // Create new MeshPhysicalMaterial for frosted glass effect\r\n                    const glassMaterial = new THREE.MeshPhysicalMaterial({\r\n                      color: '#9eb8c9', // Meer grijsblauw\r\n                      emissive: '#6b8fa3', // Grijsblauw gloei effect\r\n                      emissiveIntensity: 0.7, // Tussen sterkte\r\n                      transparent: false, // Transparantie aan\r\n                      opacity: 0.9, // Minder transparant\r\n                      metalness: 0.4, // Minimale metalness\r\n                      roughness: 0.9, // Hoge roughness voor frosted effect\r\n                      transmission: 0.5, // Licht transmissie voor glas effect\r\n                      thickness: 0.5, // Glas dikte voor realistisch effect\r\n                      side: THREE.DoubleSide, // Render both sides to fix normal issues\r\n                    });\r\n                    child.material = glassMaterial;\r\n                  } else if (textureUrl) {\r\n                    // Load and apply custom texture\r\n                    const textureLoader = new THREE.TextureLoader();\r\n                    textureLoader.load(\r\n                      textureUrl,\r\n                      (texture) => {\r\n                        // Flip texture on Y-axis (common fix for GLB models)\r\n                        texture.flipY = false;\r\n                        // Set texture wrapping\r\n                        texture.wrapS = THREE.RepeatWrapping;\r\n                        texture.wrapT = THREE.RepeatWrapping;\r\n                        // Set base color to white so texture is visible\r\n                        child.material.color.set(0xffffff);\r\n                        // Apply texture\r\n                        child.material.map = texture;\r\n                        // Remove emissive if present\r\n                        if (child.material.emissive) {\r\n                          child.material.emissive.set(0x000000);\r\n                        }\r\n                        child.material.needsUpdate = true;\r\n                      },\r\n                      undefined,\r\n                      (error) => {\r\n                        console.error(\r\n                          `Error loading texture ${textureUrl} for ${child.material.name}:`,\r\n                          error\r\n                        );\r\n                      }\r\n                    );\r\n                    child.material.flatShading = true;\r\n                  } else if (materialColor) {\r\n                    // Apply flat shading only to non-window materials\r\n                    child.material.flatShading = true;\r\n                    // Only apply color if there's no texture map (preserve PNG images)\r\n                    if (!child.material.map) {\r\n                      child.material.color.setStyle(materialColor);\r\n                    }\r\n                  }\r\n                } else {\r\n                  // Apply flat shading to materials without custom colors\r\n                  child.material.flatShading = true;\r\n                }\r\n\r\n                child.material.needsUpdate = true;\r\n              }\r\n            });\r\n\r\n            // Store transform data\r\n            scene3D.userData.transform = {\r\n              translateX: mercCoord.x,\r\n              translateY: mercCoord.y,\r\n              translateZ: mercCoord.z,\r\n              rotate: config.rotate,\r\n              scale: mercCoord.meterInMercatorCoordinateUnits() * config.scale,\r\n            } as Transform;\r\n\r\n            this.scene!.add(scene3D);\r\n          })\r\n          .catch((err: any) => {\r\n            // Error loading model - handled by resource manager\r\n          });\r\n      });\r\n\r\n      // Load image plane\r\n      createImagePlane(imagePlaneConfig)\r\n        .then((plane) => {\r\n          this.scene!.add(plane);\r\n        })\r\n        .catch((err) => {\r\n          /* Error loading image plane */\r\n        });\r\n    },\r\n\r\n    render: function (gl: WebGLRenderingContext, matrix: number[]) {\r\n      // Get Mapbox matrix\r\n      const mapMatrix = new THREE.Matrix4().fromArray(matrix);\r\n\r\n      // Apply transforms to each object (skip lights)\r\n      this.scene!.traverse((child) => {\r\n        // Skip lights - they should stay in world space\r\n        if (child instanceof THREE.Light) {\r\n          return;\r\n        }\r\n\r\n        if (child.userData.transform) {\r\n          const t = child.userData.transform as Transform;\r\n\r\n          // Create transform matrices\r\n          const translation = new THREE.Matrix4().makeTranslation(\r\n            t.translateX,\r\n            t.translateY,\r\n            t.translateZ\r\n          );\r\n          const scaling = new THREE.Matrix4().makeScale(t.scale, -t.scale, t.scale);\r\n          const rotX = new THREE.Matrix4().makeRotationX(t.rotate[0]);\r\n          const rotY = new THREE.Matrix4().makeRotationY(t.rotate[1]);\r\n          const rotZ = new THREE.Matrix4().makeRotationZ(t.rotate[2]);\r\n\r\n          // Combine transforms\r\n          const modelMatrix = new THREE.Matrix4()\r\n            .multiply(translation)\r\n            .multiply(scaling)\r\n            .multiply(rotX)\r\n            .multiply(rotY)\r\n            .multiply(rotZ);\r\n\r\n          // Apply transformation\r\n          child.matrix = new THREE.Matrix4().copy(mapMatrix).multiply(modelMatrix);\r\n          child.matrixAutoUpdate = false;\r\n        }\r\n      });\r\n\r\n      // Render scene\r\n      this.renderer!.resetState();\r\n      this.renderer!.render(this.scene!, this.camera!);\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Setup THREE.js layer on map\r\n * @param map - The mapbox map instance\r\n */\r\nexport function setupThreeJSLayer(map: Map): void {\r\n  // Add THREE.js layer when map style is loaded\r\n  map.on('style.load', () => {\r\n    const customLayer = createThreeJSLayer();\r\n    map.addLayer(customLayer);\r\n  });\r\n}\r\n\r\n/**\r\n * Add coordinate helper to map\r\n * Click anywhere on the map to see lat/lng coordinates in bottom-right corner\r\n * @param map - The mapbox map instance\r\n */\r\nexport function addCoordinateHelper(map: Map): void {\r\n  // Create display element\r\n  const coordDisplay = document.createElement('div');\r\n  coordDisplay.id = 'coord-helper';\r\n  coordDisplay.style.cssText = `\r\n    position: absolute;\r\n    bottom: 10px;\r\n    right: 10px;\r\n    background: rgba(0, 0, 0, 0.8);\r\n    color: white;\r\n    padding: 10px 15px;\r\n    border-radius: 4px;\r\n    font-family: monospace;\r\n    font-size: 12px;\r\n    z-index: 1000;\r\n    pointer-events: none;\r\n    display: none;\r\n  `;\r\n  document.body.appendChild(coordDisplay);\r\n\r\n  // Store the current marker\r\n  let currentMarker: mapboxgl.Marker | null = null;\r\n\r\n  // Add click handler\r\n  map.on('click', (e) => {\r\n    const { lng, lat } = e.lngLat;\r\n    const coordText = `[${lat.toFixed(6)}, ${lng.toFixed(6)}]`;\r\n\r\n    // Remove previous marker if it exists\r\n    if (currentMarker) {\r\n      currentMarker.remove();\r\n    }\r\n\r\n    // Create red dot marker\r\n    const markerElement = document.createElement('div');\r\n    markerElement.style.cssText = `\r\n      width: 12px;\r\n      height: 12px;\r\n      background-color: #ff0000;\r\n      border-radius: 50%;\r\n      border: 2px solid white;\r\n      box-shadow: 0 2px 4px rgba(0,0,0,0.3);\r\n    `;\r\n\r\n    // Add marker to map\r\n    currentMarker = new mapboxgl.Marker({ element: markerElement })\r\n      .setLngLat([lng, lat])\r\n      .addTo(map);\r\n\r\n    // Copy to clipboard\r\n    navigator.clipboard\r\n      .writeText(coordText)\r\n      .then(() => {\r\n        coordDisplay.innerHTML = `\r\n        <div style=\"margin-bottom: 5px;\"><strong>Coordinates:</strong></div>\r\n        <div>Lat: ${lat.toFixed(6)}</div>\r\n        <div>Lng: ${lng.toFixed(6)}</div>\r\n        <div style=\"margin-top: 5px; color: #4CAF50;\">${coordText}</div>\r\n        <div style=\"margin-top: 5px; color: #FFD700; font-size: 11px;\">\u2713 Copied to clipboard!</div>\r\n      `;\r\n      })\r\n      .catch(() => {\r\n        coordDisplay.innerHTML = `\r\n        <div style=\"margin-bottom: 5px;\"><strong>Coordinates:</strong></div>\r\n        <div>Lat: ${lat.toFixed(6)}</div>\r\n        <div>Lng: ${lng.toFixed(6)}</div>\r\n        <div style=\"margin-top: 5px; color: #4CAF50;\">${coordText}</div>\r\n      `;\r\n      });\r\n\r\n    coordDisplay.style.display = 'block';\r\n  });\r\n}\r\n", "// Simple 3D toggle module\r\n\r\nimport type { Map } from 'mapbox-gl';\r\n\r\n// Global declaration for the map variable\r\ndeclare global {\r\n  interface Window {\r\n    map: Map;\r\n  }\r\n}\r\n\r\n// Simple state\r\nlet is3DEnabled = true;\r\n\r\n/**\r\n * Toggle 3D layers visibility\r\n * @param enable - Whether to enable 3D layers\r\n */\r\nexport function toggle3DLayers(enable: boolean): void {\r\n  is3DEnabled = enable;\r\n\r\n  // Save setting\r\n  localStorage.setItem('heerlen_map_3d_enabled', enable.toString());\r\n\r\n  // Update button appearance\r\n  updateToggleButtonState();\r\n\r\n  // Toggle only the custom 3D models layer\r\n  if (window.map && window.map.getLayer('3d-models')) {\r\n    window.map.setLayoutProperty('3d-models', 'visibility', enable ? 'visible' : 'none');\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Update button state based on current settings\r\n */\r\nfunction updateToggleButtonState(): void {\r\n  const toggleButton = document.querySelector('.toggle-3d-button') as HTMLButtonElement;\r\n  if (!toggleButton) {\r\n    return;\r\n  }\r\n\r\n  toggleButton.classList.toggle('is-active', is3DEnabled);\r\n  toggleButton.setAttribute('aria-pressed', is3DEnabled.toString());\r\n  toggleButton.title = is3DEnabled ? '3D uit' : '3D aan';\r\n  \r\n  // Simple 3D icon\r\n  toggleButton.innerHTML = is3DEnabled\r\n    ? `<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\"><path fill=\"currentColor\" d=\"M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9M12 4.15l-6.04 3.4 6.04 3.4 6.04-3.4L12 4.15Z\"/></svg>`\r\n    : `<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\"><path fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" d=\"M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18-.21 0-.41-.06-.57-.18l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18.21 0 .41.06.57.18l7.9 4.44c.32.17.53.5.53.88v9M12 4.15l-6.04 3.4 6.04 3.4 6.04-3.4L12 4.15Z\"/></svg>`;\r\n}\r\n\r\n/**\r\n * Load settings from localStorage\r\n */\r\nfunction loadSettings(): void {\r\n  const stored = localStorage.getItem('heerlen_map_3d_enabled');\r\n\r\n  if (stored !== null) {\r\n    is3DEnabled = stored === 'true';\r\n  }\r\n}\r\n\r\n/**\r\n * Create and add the 3D toggle control\r\n * @param map - The mapbox map instance\r\n */\r\nfunction add3DToggleControl(map: Map): void {\r\n  // Remove existing control if any\r\n  const existingControl = document.querySelector('.mapboxgl-ctrl-group .toggle-3d-button');\r\n  if (existingControl) {\r\n    const parentGroup = existingControl.closest('.mapboxgl-ctrl-group');\r\n    if (parentGroup) parentGroup.remove();\r\n  }\r\n  \r\n  const container = document.createElement('div');\r\n  container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';\r\n  \r\n  const button = document.createElement('button');\r\n  button.className = 'mapboxgl-ctrl-icon toggle-3d-button';\r\n  button.type = 'button';\r\n  button.setAttribute('aria-label', '3D aan/uit');\r\n  \r\n  // Set initial state\r\n  updateToggleButtonState();\r\n  \r\n  // Add click handler\r\n  button.addEventListener('click', () => {\r\n    toggle3DLayers(!is3DEnabled);\r\n  });\r\n  \r\n  container.appendChild(button);\r\n  const controlContainer = document.querySelector('.mapboxgl-ctrl-top-right');\r\n  if (controlContainer) {\r\n    controlContainer.appendChild(container);\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize 3D settings\r\n * @param map - The mapbox map instance\r\n */\r\nexport function initialize3DSettings(map: Map): void {\r\n  // Make map available to other functions\r\n  window.map = map;\r\n\r\n  // Load settings\r\n  loadSettings();\r\n\r\n  // Add control when map is ready\r\n  map.once('load', () => {\r\n    add3DToggleControl(map);\r\n\r\n    // Wait for the 3D models layer to be added\r\n    let initialized = false;\r\n\r\n    const initToggle = (): void => {\r\n      if (initialized) return;\r\n\r\n      if (map.getLayer('3d-models')) {\r\n        initialized = true;\r\n        toggle3DLayers(is3DEnabled);\r\n      }\r\n    };\r\n\r\n    // Try multiple ways to detect when layer is ready\r\n    map.on('idle', initToggle);\r\n    map.on('styledata', initToggle);\r\n\r\n    // Also try immediately\r\n    setTimeout(initToggle, 100);\r\n    setTimeout(initToggle, 500);\r\n    setTimeout(initToggle, 1000);\r\n  });\r\n}", "// Tour/walkthrough module\r\n\r\nimport type { Map } from 'mapbox-gl';\r\nimport { CONFIG } from './config.js';\r\n\r\n// Global declarations for external libraries\r\ndeclare global {\r\n  interface Window {\r\n    mapboxgl: typeof import('mapbox-gl');\r\n    Shepherd: any;\r\n    activeTour?: any;\r\n    tourWaitingForMarkerClick?: boolean;\r\n    markerClickFallbackTimer?: number;\r\n    markerClickListener?: () => void;\r\n    tourCleanup?: () => void;\r\n  }\r\n}\r\n\r\n// Language detection function\r\nfunction detectLanguage(): 'nl' | 'en' | 'de' {\r\n  const path = window.location.pathname;\r\n  if (path.includes('/en/')) return 'en';\r\n  if (path.includes('/de/')) return 'de';\r\n  return 'nl'; // Default to Dutch\r\n}\r\n\r\n// Translations object\r\nconst translations = {\r\n  nl: {\r\n    welcomeMessage: 'Welkom in <strong>Heerlen</strong> deze kaart heeft veel unieke functies die ik je graag uitleg',\r\n    startTour: 'Start tour',\r\n    skipTour: 'Skip tour',\r\n    helpButtonTitle: 'Start rondleiding',\r\n    helpButtonAriaLabel: 'Start kaart rondleiding',\r\n    tourSteps: {\r\n      welcome: 'Ontdek <strong>Heerlen</strong> met deze interactieve kaart. We leiden je even rond!.',\r\n      mapControls: 'Gebruik deze <strong>knoppen</strong> om in/uit te zoomen en de kaart te draaien.',\r\n      filters: 'gebruik <strong>filters</strong> om per categorie te zoeken en te ontdekken!',\r\n      geolocation: 'Klik hier om je <strong>locatie</strong> aan te zetten en direct te zien waar jij je bevindt op de kaart.',\r\n      tryMarker: 'klik op een van de <strong>gekleurde</strong> rondjes.',\r\n      markerInstruction: 'Klik op een marker om door te gaan',\r\n      markerHint: 'Klik op \"Skip\" als je geen marker kunt vinden',\r\n      popupInfo: 'Bekijk <strong>informatie</strong> over deze plek en druk op de <strong>like-knop</strong> om deze locatie op te slaan.',\r\n      likeHeart: 'Klik op het <strong>hartje</strong> om al je opgeslagen favoriete locaties te bekijken.',\r\n      finish: 'Je bent nu klaar om <strong>Heerlen te verkennen</strong>! Klik op markers om locaties te ontdekken. Je kunt deze rondleiding opnieuw starten via het <strong>?</strong> icoon.'\r\n    },\r\n    buttons: {\r\n      start: 'Start',\r\n      skip: 'Skip',\r\n      back: '\u2190',\r\n      next: '\u2192',\r\n      ready: 'Klaar'\r\n    },\r\n    progressBarClose: 'Sluit rondleiding'\r\n  },\r\n  en: {\r\n    welcomeMessage: 'Welcome to <strong>Heerlen</strong>! This map has many unique features that I\\'d like to show you',\r\n    startTour: 'Start tour',\r\n    skipTour: 'Skip tour',\r\n    helpButtonTitle: 'Start tour',\r\n    helpButtonAriaLabel: 'Start map tour',\r\n    tourSteps: {\r\n      welcome: 'Discover <strong>Heerlen</strong> with this interactive map. Let me show you around!',\r\n      mapControls: 'Use these <strong>buttons</strong> to zoom in/out and rotate the map.',\r\n      filters: 'Use <strong>filters</strong> to search and discover by category!',\r\n      geolocation: 'Click here to enable your <strong>location</strong> and see where you are on the map.',\r\n      tryMarker: 'Click on one of the <strong>colored</strong> circles.',\r\n      markerInstruction: 'Click on a marker to continue',\r\n      markerHint: 'Click \"Skip\" if you can\\'t find a marker',\r\n      popupInfo: 'View <strong>information</strong> about this place and click the <strong>like button</strong> to save this location.',\r\n      likeHeart: 'Click on the <strong>heart</strong> to view all your saved favorite locations.',\r\n      finish: 'You\\'re now ready to <strong>explore Heerlen</strong>! Click on markers to discover locations. You can restart this tour anytime via the <strong>?</strong> icon.'\r\n    },\r\n    buttons: {\r\n      start: 'Start',\r\n      skip: 'Skip',\r\n      back: '\u2190',\r\n      next: '\u2192',\r\n      ready: 'Done'\r\n    },\r\n    progressBarClose: 'Close tour'\r\n  },\r\n  de: {\r\n    welcomeMessage: 'Willkommen in <strong>Heerlen</strong>! Diese Karte hat viele einzigartige Funktionen, die ich Ihnen gerne zeigen m\u00F6chte',\r\n    startTour: 'Tour starten',\r\n    skipTour: 'Tour \u00FCberspringen',\r\n    helpButtonTitle: 'Tour starten',\r\n    helpButtonAriaLabel: 'Kartentour starten',\r\n    tourSteps: {\r\n      welcome: 'Entdecken Sie <strong>Heerlen</strong> mit dieser interaktiven Karte. Lassen Sie mich Ihnen alles zeigen!',\r\n      mapControls: 'Verwenden Sie diese <strong>Tasten</strong> zum Zoomen und Drehen der Karte.',\r\n      filters: 'Verwenden Sie <strong>Filter</strong>, um nach Kategorien zu suchen und zu entdecken!',\r\n      geolocation: 'Klicken Sie hier, um Ihren <strong>Standort</strong> zu aktivieren und zu sehen, wo Sie sich auf der Karte befinden.',\r\n      tryMarker: 'Klicken Sie auf einen der <strong>farbigen</strong> Kreise.',\r\n      markerInstruction: 'Klicken Sie auf einen Marker, um fortzufahren',\r\n      markerHint: 'Klicken Sie auf \"\u00DCberspringen\", wenn Sie keinen Marker finden k\u00F6nnen',\r\n      popupInfo: 'Sehen Sie sich <strong>Informationen</strong> \u00FCber diesen Ort an und klicken Sie auf die <strong>Like-Schaltfl\u00E4che</strong>, um diesen Ort zu speichern.',\r\n      likeHeart: 'Klicken Sie auf das <strong>Herz</strong>, um alle Ihre gespeicherten Lieblingsorte anzuzeigen.',\r\n      finish: 'Sie sind jetzt bereit, <strong>Heerlen zu erkunden</strong>! Klicken Sie auf Marker, um Orte zu entdecken. Sie k\u00F6nnen diese Tour jederzeit \u00FCber das <strong>?</strong> Symbol neu starten.'\r\n    },\r\n    buttons: {\r\n      start: 'Start',\r\n      skip: '\u00DCberspringen',\r\n      back: '\u2190',\r\n      next: '\u2192',\r\n      ready: 'Fertig'\r\n    },\r\n    progressBarClose: 'Tour schlie\u00DFen'\r\n  }\r\n};\r\n\r\n// Tour cleanup tracking\r\nlet tourIntervals: Set<number> = new Set();\r\nlet tourTimeouts: Set<number> = new Set();\r\nlet tourEventListeners: Array<{element: any, event: string, handler: Function}> = [];\r\n\r\ninterface TourStep {\r\n  id: string;\r\n  attachTo?: {\r\n    element: Element;\r\n    on: string;\r\n  } | null;\r\n  text: string;\r\n  buttons?: Array<{\r\n    text: string;\r\n    action: () => void;\r\n    classes: string;\r\n  }>;\r\n  when?: {\r\n    show?: () => void;\r\n    hide?: () => void;\r\n  };\r\n  canClickTarget?: boolean;\r\n  advanceOn?: null;\r\n}\r\n\r\n/**\r\n * Initialize tour functionality\r\n * @param map - The mapbox map instance\r\n */\r\nexport function initializeTour(map: Map): void {\r\n  // Check if mapboxgl is available\r\n  if (typeof window.mapboxgl !== 'undefined') {\r\n    // Load external CSS file\r\n    loadTourStylesheet();\r\n\r\n    // Wait for map to fully initialize using a more reliable method\r\n    const checkMapReady = setInterval(function () {\r\n      const mapContainer = document.getElementById('map');\r\n      // Check if map container exists and map has been rendered\r\n      if (mapContainer && mapContainer.querySelector('.mapboxgl-canvas') && map && map.loaded()) {\r\n        clearInterval(checkMapReady);\r\n        tourIntervals.delete(checkMapReady);\r\n\r\n        // Give map additional time to render all elements properly\r\n        const setupTimeout = setTimeout(function () {\r\n          tourTimeouts.delete(setupTimeout);\r\n          setupTourSystem(map);\r\n        }, 2000);\r\n        tourTimeouts.add(setupTimeout);\r\n      }\r\n    }, 500);\r\n    tourIntervals.add(checkMapReady);\r\n  }\r\n}\r\n\r\n/**\r\n * Load the external CSS file for tour styles\r\n */\r\nfunction loadTourStylesheet(): void {\r\n  if (!document.getElementById('tour-styles')) {\r\n    const linkElem = document.createElement('link');\r\n    linkElem.id = 'tour-styles';\r\n    linkElem.rel = 'stylesheet';\r\n    linkElem.type = 'text/css';\r\n    linkElem.href = 'tour-styles.css'; // Path to your CSS file\r\n    document.head.appendChild(linkElem);\r\n  }\r\n}\r\n\r\n/**\r\n * Setup the tour system\r\n * @param map - The mapbox map instance\r\n */\r\nfunction setupTourSystem(map: Map): void {\r\n  // Check if guide was already shown\r\n  const walkthroughShown = localStorage.getItem('heerlenMapWalkthroughShown');\r\n\r\n  // Create persistent help button regardless of first visit\r\n  addHelpButton(map);\r\n\r\n  // Show tour on first visit or if manually triggered\r\n  if (!walkthroughShown || window.location.hash === '#tutorial') {\r\n    // Show a welcome message before starting tour\r\n    showWelcomeMessage(function () {\r\n      startTour(map);\r\n      localStorage.setItem('heerlenMapWalkthroughShown', 'true');\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Add welcome message overlay with animation\r\n * @param callback - Callback function to execute after welcome\r\n */\r\nfunction showWelcomeMessage(callback: () => void): void {\r\n  const lang = detectLanguage();\r\n  const t = translations[lang];\r\n  \r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'welcome-overlay';\r\n  overlay.innerHTML = `\r\n    <div class=\"welcome-card\">\r\n      <p>${t.welcomeMessage}</p>\r\n      <div class=\"welcome-buttons\">\r\n        <button class=\"welcome-start-btn\">${t.startTour}</button>\r\n        <button class=\"welcome-skip-btn\">${t.skipTour}</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n  document.body.appendChild(overlay);\r\n\r\n  // Animate entrance\r\n  setTimeout(() => {\r\n    overlay.style.opacity = '1';\r\n    const card = overlay.querySelector('.welcome-card') as HTMLElement;\r\n    card.style.transform = 'translateY(0)';\r\n    card.style.opacity = '1';\r\n  }, 100);\r\n\r\n  // Handle button clicks\r\n  overlay.querySelector('.welcome-start-btn')!.addEventListener('click', function () {\r\n    overlay.style.opacity = '0';\r\n    setTimeout(() => {\r\n      overlay.remove();\r\n      callback();\r\n    }, 500);\r\n  });\r\n\r\n  overlay.querySelector('.welcome-skip-btn')!.addEventListener('click', function () {\r\n    overlay.style.opacity = '0';\r\n    setTimeout(() => {\r\n      overlay.remove();\r\n      // Also set localStorage when skipping, so tour doesn't show again\r\n      localStorage.setItem('heerlenMapWalkthroughShown', 'true');\r\n    }, 500);\r\n  });\r\n}\r\n\r\n/**\r\n * Add help button to trigger tour manually\r\n * @param map - The mapbox map instance\r\n */\r\nfunction addHelpButton(map: Map): void {\r\n  const lang = detectLanguage();\r\n  const t = translations[lang];\r\n\r\n  // Remove existing help button if any\r\n  const existingContainer = document.querySelector('.help-button-container');\r\n  if (existingContainer) {\r\n    existingContainer.remove();\r\n  }\r\n\r\n  const helpButton = document.createElement('button');\r\n  helpButton.className = 'help-button';\r\n  helpButton.innerHTML = '?';\r\n  helpButton.title = t.helpButtonTitle;\r\n  helpButton.setAttribute('aria-label', t.helpButtonAriaLabel);\r\n\r\n  helpButton.addEventListener('click', () => {\r\n    if (window.activeTour && window.activeTour.isActive()) {\r\n      // If tour is already active, resume it\r\n      const currentStep = window.activeTour.getCurrentStep();\r\n      if (currentStep) {\r\n        window.activeTour.show(currentStep.id);\r\n      } else {\r\n        window.activeTour.start();\r\n      }\r\n    } else {\r\n      // Start a new tour\r\n      startTour(map);\r\n    }\r\n  });\r\n\r\n  // Place next to other controls with better positioning\r\n  const controlContainer = document.querySelector('.mapboxgl-ctrl-top-right');\r\n  if (controlContainer) {\r\n    const helpControl = document.createElement('div');\r\n    helpControl.className = 'mapboxgl-ctrl help-button-container';\r\n    helpControl.appendChild(helpButton);\r\n    controlContainer.appendChild(helpControl);\r\n  }\r\n}\r\n\r\n/**\r\n * Main tour function\r\n * @param map - The mapbox map instance\r\n */\r\nexport function startTour(map: Map): void {\r\n  const lang = detectLanguage();\r\n  const t = translations[lang];\r\n  // Create tour with enhanced options\r\n  const tour = new window.Shepherd.Tour({\r\n    useModalOverlay: false,\r\n    defaultStepOptions: {\r\n      cancelIcon: {\r\n        enabled: true,\r\n      },\r\n      classes: 'shepherd-theme-heerlen',\r\n      scrollTo: false,\r\n      title: null, // No titles, just content\r\n      popperOptions: {\r\n        modifiers: [\r\n          {\r\n            name: 'offset',\r\n            options: {\r\n              offset: [0, 12],\r\n            },\r\n          },\r\n          {\r\n            name: 'preventOverflow',\r\n            options: {\r\n              boundary: document.body,\r\n              padding: 10,\r\n            },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  });\r\n\r\n  // Add click outside handler for tour\r\n  const handleClickOutside = (event: MouseEvent) => {\r\n    // Check if tour is active\r\n    if (!tour || !tour.isActive()) return;\r\n    \r\n    const target = event.target as HTMLElement;\r\n    \r\n    // Check if click was directly on the overlay\r\n    if (target.classList.contains('shepherd-modal-overlay-container')) {\r\n      tour.cancel();\r\n      return;\r\n    }\r\n    \r\n    // Check if click was on tour elements\r\n    const isShepherdElement = target.closest('.shepherd-element');\r\n    const isHelpButton = target.closest('.help-button');\r\n    const isProgressBar = target.closest('.shepherd-progress-bar');\r\n    const isWelcomeOverlay = target.closest('.welcome-overlay');\r\n    const isInsidePopup = target.closest('.shepherd-content, .shepherd-text, .shepherd-footer, .shepherd-button');\r\n    \r\n    // If clicked outside the actual tour popup content, cancel tour\r\n    if (!isShepherdElement && !isHelpButton && !isProgressBar && !isWelcomeOverlay && !isInsidePopup) {\r\n      tour.cancel();\r\n    }\r\n  };\r\n\r\n  // Add drag handler to close tour\r\n  const handleMapDrag = () => {\r\n    if (tour && tour.isActive()) {\r\n      tour.cancel();\r\n    }\r\n  };\r\n\r\n  // Set up event listeners when tour starts\r\n  tour.on('start', () => {\r\n    // Add click outside listener\r\n    setTimeout(() => {\r\n      document.addEventListener('click', handleClickOutside);\r\n    }, 100);\r\n    \r\n    // Add map drag listener\r\n    map.on('dragstart', handleMapDrag);\r\n  });\r\n\r\n  // Clean up event listeners when tour ends\r\n  tour.on('cancel', () => {\r\n    document.removeEventListener('click', handleClickOutside);\r\n    map.off('dragstart', handleMapDrag);\r\n  });\r\n\r\n  tour.on('complete', () => {\r\n    document.removeEventListener('click', handleClickOutside);\r\n    map.off('dragstart', handleMapDrag);\r\n  });\r\n\r\n  // Store tour reference globally\r\n  window.activeTour = tour;\r\n\r\n  // Function to enable modal overlay with enhanced animation\r\n  function enableOverlay(): void {\r\n    const overlay = document.querySelector('.shepherd-modal-overlay-container') as HTMLElement;\r\n    if (overlay) {\r\n      overlay.style.transition = 'opacity 0.3s ease';\r\n      overlay.classList.add('shepherd-modal-is-visible');\r\n      overlay.style.pointerEvents = 'auto';\r\n      \r\n      // Add direct click handler on overlay\r\n      overlay.onclick = (e) => {\r\n        // Only close if clicked directly on overlay, not on tour popup\r\n        if (e.target === overlay) {\r\n          tour.cancel();\r\n        }\r\n      };\r\n    }\r\n  }\r\n\r\n  // Function to disable modal overlay\r\n  function disableOverlay(): void {\r\n    const overlay = document.querySelector('.shepherd-modal-overlay-container') as HTMLElement;\r\n    if (overlay) {\r\n      overlay.classList.remove('shepherd-modal-is-visible');\r\n      overlay.style.pointerEvents = 'none';\r\n      overlay.onclick = null; // Clean up click handler\r\n    }\r\n  }\r\n\r\n  // Enhanced element targeting function that handles cases where elements don't exist\r\n  function safelyGetElement(selector: string, fallbackSelector?: string): { element: Element; on: string } | null {\r\n    const element = document.querySelector(selector);\r\n    if (element) {\r\n      return { element, on: 'bottom' };\r\n    }\r\n    if (fallbackSelector) {\r\n      const fallback = document.querySelector(fallbackSelector);\r\n      if (fallback) {\r\n        return { element: fallback, on: 'bottom' };\r\n      }\r\n    }\r\n    // If no element found, return null and skip attachment\r\n    return null;\r\n  }\r\n\r\n  // Step 1: Welcome (with overlay) - no title\r\n  tour.addStep({\r\n    id: 'welcome',\r\n    text: t.tourSteps.welcome,\r\n    buttons: [\r\n      {\r\n        text: t.buttons.start,\r\n        action: tour.next,\r\n        classes: 'shepherd-button-primary',\r\n      },\r\n    ],\r\n    when: {\r\n      show: enableOverlay,\r\n    },\r\n  });\r\n\r\n  // Steps with proper element targeting and fallbacks - minimalist style without titles\r\n  const tourSteps: Array<{\r\n    id: string;\r\n    attachTo: { element: Element; on: string } | null;\r\n    text: string;\r\n  }> = [\r\n    {\r\n      id: 'map-controls',\r\n      attachTo: safelyGetElement('.mapboxgl-ctrl-top-right', '.mapboxgl-ctrl-group'),\r\n      text: t.tourSteps.mapControls,\r\n    },\r\n    {\r\n      id: 'filters',\r\n      attachTo: safelyGetElement('.filter-switch-wrap-top', '.filter-btn'),\r\n      text: t.tourSteps.filters,\r\n    },\r\n    {\r\n      id: 'geolocation',\r\n      attachTo: safelyGetElement('.mapboxgl-ctrl-geolocate', '.mapboxgl-ctrl-bottom-right'),\r\n      text: t.tourSteps.geolocation,\r\n    },\r\n  ];\r\n\r\n  // Add each step with proper error handling\r\n  tourSteps.forEach((stepConfig) => {\r\n    // Skip steps with attachments that couldn't be found\r\n    if (stepConfig.attachTo) {\r\n      tour.addStep({\r\n        ...stepConfig,\r\n        buttons: [\r\n          {\r\n            text: t.buttons.back,\r\n            action: tour.back,\r\n            classes: 'shepherd-button-secondary',\r\n          },\r\n          {\r\n            text: t.buttons.next,\r\n            action: tour.next,\r\n            classes: 'shepherd-button-primary',\r\n          },\r\n        ],\r\n        when: {\r\n          show: enableOverlay,\r\n          hide: () => {\r\n            // Pulse the target element when showing the step\r\n            const target = stepConfig.attachTo?.element;\r\n            if (target) {\r\n              target.classList.add('tour-highlight-pulse');\r\n\r\n              // Remove pulse after animation completes\r\n              setTimeout(() => {\r\n                target.classList.remove('tour-highlight-pulse');\r\n              }, 1000);\r\n            }\r\n          },\r\n        },\r\n      });\r\n    }\r\n  });\r\n\r\n  // Marker instruction step with minimalist design\r\n  tour.addStep({\r\n    id: 'try-marker',\r\n    text: `\r\n      <div class=\"tour-marker-instruction\">\r\n        <p>${t.tourSteps.tryMarker}</p>\r\n        <div class=\"marker-animation\">\r\n          <span class=\"pulse-dot\"></span>\r\n          <span class=\"instruction-arrow\">\u2193</span>\r\n        </div>\r\n      </div>\r\n    `,\r\n    buttons: [\r\n      {\r\n        text: t.buttons.back,\r\n        action: tour.back,\r\n        classes: 'shepherd-button-secondary',\r\n      },\r\n      {\r\n        text: t.buttons.skip,\r\n        action: () => {\r\n          window.tourWaitingForMarkerClick = false;\r\n          tour.show('popup-info');\r\n        },\r\n        classes: 'shepherd-button-secondary',\r\n      },\r\n    ],\r\n    when: {\r\n      show: function () {\r\n        disableOverlay(); // Disable overlay to allow marker clicking\r\n\r\n        // Show floating message to encourage clicking a marker\r\n        const message = document.createElement('div');\r\n        message.className = 'tour-instruction-message';\r\n        message.textContent = t.tourSteps.markerInstruction;\r\n        document.body.appendChild(message);\r\n\r\n        // Set a timeout to remove the message after animation completes\r\n        setTimeout(() => {\r\n          if (message.parentNode) {\r\n            message.parentNode.removeChild(message);\r\n          }\r\n        }, 4000);\r\n\r\n        // Automatically click a random visible marker after a short delay\r\n        setTimeout(() => {\r\n          const features = map.queryRenderedFeatures({ \r\n            layers: ['location-markers', 'location-icons'] \r\n          });\r\n          \r\n          if (features.length > 0) {\r\n            // Select a random feature from the visible markers\r\n            const randomIndex = Math.floor(Math.random() * features.length);\r\n            const selectedFeature = features[randomIndex];\r\n            const coordinates = selectedFeature.geometry.coordinates as [number, number];\r\n            \r\n            // Fire the click event programmatically\r\n            map.fire('click', {\r\n              lngLat: coordinates,\r\n              point: map.project(coordinates),\r\n              features: [selectedFeature],\r\n              originalEvent: new MouseEvent('click')\r\n            } as any);\r\n            \r\n            // Move to the next step after the popup appears\r\n            setTimeout(() => {\r\n              if (tour.getCurrentStep() && tour.getCurrentStep().id === 'try-marker') {\r\n                enableOverlay(); // Re-enable overlay for next steps\r\n                tour.show('popup-info');\r\n              }\r\n            }, 800);\r\n          }\r\n        }, 500);\r\n\r\n        // Mark this step as waiting for marker click\r\n        window.tourWaitingForMarkerClick = true;\r\n\r\n        // Create a fallback to next step in case the user can't find a marker to click\r\n        window.markerClickFallbackTimer = window.setTimeout(() => {\r\n          if (window.tourWaitingForMarkerClick) {\r\n            // If user hasn't clicked after 15 seconds, show hint message\r\n            const hintMessage = document.createElement('div');\r\n            hintMessage.className = 'tour-instruction-message';\r\n            hintMessage.textContent = t.tourSteps.markerHint;\r\n            document.body.appendChild(hintMessage);\r\n\r\n            setTimeout(() => {\r\n              if (hintMessage.parentNode) {\r\n                hintMessage.parentNode.removeChild(hintMessage);\r\n              }\r\n            }, 5000);\r\n          }\r\n        }, 15000);\r\n      },\r\n      hide: function () {\r\n        // Clear any fallback timers when leaving this step\r\n        if (window.markerClickFallbackTimer) {\r\n          clearTimeout(window.markerClickFallbackTimer);\r\n        }\r\n\r\n        // Remove any lingering instruction messages\r\n        const messages = document.querySelectorAll('.tour-instruction-message');\r\n        messages.forEach((msg) => {\r\n          if (msg.parentNode) {\r\n            msg.parentNode.removeChild(msg);\r\n          }\r\n        });\r\n      },\r\n    },\r\n    // Prevent advancing with keyboard navigation\r\n    canClickTarget: false,\r\n    advanceOn: null,\r\n  });\r\n\r\n  // Popup info step\r\n  tour.addStep({\r\n    id: 'popup-info',\r\n    attachTo: function () {\r\n      const popup = document.querySelector('.mapboxgl-popup-content');\r\n      return popup ? { element: popup, on: 'top' } : null;\r\n    },\r\n    text: t.tourSteps.popupInfo,\r\n    buttons: [\r\n      {\r\n        text: t.buttons.back,\r\n        action: tour.back,\r\n        classes: 'shepherd-button-secondary',\r\n      },\r\n      {\r\n        text: t.buttons.next,\r\n        action: tour.next,\r\n        classes: 'shepherd-button-primary',\r\n      },\r\n    ],\r\n    when: {\r\n      show: function () {\r\n        enableOverlay();\r\n\r\n        // If popup doesn't exist, try to create one automatically\r\n        if (!document.querySelector('.mapboxgl-popup-content') && map) {\r\n          // Find a visible marker and simulate a click\r\n          const marker = document.querySelector('.mapboxgl-marker, .mapboxgl-user-location-dot');\r\n          if (marker) {\r\n            // Try to simulate a click on this marker\r\n            (marker as HTMLElement).click();\r\n\r\n            // If that didn't work, try plan B:\r\n            setTimeout(() => {\r\n              // If still no popup, use a fallback approach\r\n              if (\r\n                !document.querySelector('.mapboxgl-popup-content') &&\r\n                map.getLayer('location-markers')\r\n              ) {\r\n                const features = map.queryRenderedFeatures({ layers: ['location-markers'] });\r\n                if (features.length > 0) {\r\n                  const feature = features[0];\r\n                  map.fire('click', {\r\n                    lngLat: feature.geometry.coordinates,\r\n                    point: map.project(feature.geometry.coordinates as [number, number]),\r\n                    features: [feature],\r\n                  } as any);\r\n                }\r\n              }\r\n            }, 300);\r\n          }\r\n        }\r\n      },\r\n      hide: disableOverlay,\r\n    },\r\n  });\r\n\r\n  // Add the heart favorites step - minimalist style\r\n  const heartAttachment = safelyGetElement('.jetboost-favorites-total', '.heart-svg.w-embed');\r\n\r\n  if (heartAttachment) {\r\n    tour.addStep({\r\n      id: 'like-heart-svg',\r\n      attachTo: heartAttachment,\r\n      text: t.tourSteps.likeHeart,\r\n      buttons: [\r\n        {\r\n          text: t.buttons.back,\r\n          action: tour.back,\r\n          classes: 'shepherd-button-secondary',\r\n        },\r\n        {\r\n          text: t.buttons.next,\r\n          action: tour.next,\r\n          classes: 'shepherd-button-primary',\r\n        },\r\n      ],\r\n      when: {\r\n        show: () => {\r\n          enableOverlay();\r\n          // Pulse the target element when showing the step\r\n          const target = document.querySelector('.jetboost-favorites-total');\r\n          if (target) {\r\n            target.classList.add('tour-highlight-pulse');\r\n\r\n            // Remove pulse after animation completes\r\n            setTimeout(() => {\r\n              target.classList.remove('tour-highlight-pulse');\r\n            }, 1000);\r\n          }\r\n        },\r\n        hide: disableOverlay,\r\n      },\r\n    });\r\n  }\r\n\r\n  // Final step - minimalist style\r\n  tour.addStep({\r\n    id: 'finish',\r\n    text: t.tourSteps.finish,\r\n    buttons: [\r\n      {\r\n        text: t.buttons.ready,\r\n        action: tour.complete,\r\n        classes: 'shepherd-button-primary',\r\n      },\r\n    ],\r\n    when: { show: enableOverlay },\r\n  });\r\n\r\n  // Progress bar for better user understanding of tour length\r\n  tour.on('start', () => {\r\n    addProgressBar(tour);\r\n  });\r\n\r\n  // Setup marker click listener to advance tour if needed\r\n  function setupMarkerClickListener(): void {\r\n    // Remove previous listener if it exists\r\n    if (window.markerClickListener) {\r\n      map.off('click', 'location-markers', window.markerClickListener);\r\n    }\r\n\r\n    // Create new listener\r\n    window.markerClickListener = () => {\r\n      if (window.tourWaitingForMarkerClick) {\r\n        window.tourWaitingForMarkerClick = false;\r\n        clearTimeout(window.markerClickFallbackTimer!);\r\n\r\n        // Give time for popup to appear\r\n        setTimeout(() => {\r\n          if (tour.getCurrentStep() && tour.getCurrentStep().id === 'try-marker') {\r\n            enableOverlay(); // Re-enable overlay for next steps\r\n            tour.show('popup-info');\r\n          }\r\n        }, 500);\r\n      }\r\n    };\r\n\r\n    // Add listener\r\n    map.on('click', 'location-markers', window.markerClickListener);\r\n  }\r\n\r\n  // Setup the marker click listener\r\n  setupMarkerClickListener();\r\n\r\n  // Clean up when tour completes or is cancelled\r\n  function cleanupTour(): void {\r\n    window.tourWaitingForMarkerClick = false;\r\n    if (window.markerClickFallbackTimer) {\r\n      clearTimeout(window.markerClickFallbackTimer);\r\n    }\r\n\r\n    const messages = document.querySelectorAll('.tour-instruction-message');\r\n    messages.forEach((msg) => {\r\n      if (msg.parentNode) {\r\n        msg.parentNode.removeChild(msg);\r\n      }\r\n    });\r\n\r\n    const progressBar = document.querySelector('.shepherd-progress-bar');\r\n    if (progressBar && progressBar.parentNode) {\r\n      progressBar.parentNode.removeChild(progressBar);\r\n    }\r\n  }\r\n\r\n  tour.on('complete', cleanupTour);\r\n  tour.on('cancel', cleanupTour);\r\n\r\n  // Start the tour\r\n  tour.start();\r\n}\r\n\r\n/**\r\n * Add progress bar to show tour progress\r\n * @param tour - The tour instance\r\n */\r\nfunction addProgressBar(tour: any): void {\r\n  const lang = detectLanguage();\r\n  const t = translations[lang];\r\n  \r\n  // Remove existing progress bar if any\r\n  const existingBar = document.querySelector('.shepherd-progress-bar');\r\n  if (existingBar) {\r\n    existingBar.remove();\r\n  }\r\n\r\n  // Create progress bar container\r\n  const progressContainer = document.createElement('div');\r\n  progressContainer.className = 'shepherd-progress-bar'; // Keep the flexbox layout\r\n\r\n  // Create the inner progress bar element\r\n  const progressInner = document.createElement('div');\r\n  progressInner.className = 'progress-inner';\r\n  progressInner.innerHTML = `<div class=\"progress-fill\"></div>`; // Only the bar itself\r\n\r\n  // Create the close button\r\n  const closeButton = document.createElement('button');\r\n  closeButton.className = 'progress-bar-close-btn'; // Use your existing CSS class\r\n  closeButton.innerHTML = '\u00D7'; // The 'x' symbol (HTML entity)\r\n  closeButton.setAttribute('aria-label', t.progressBarClose); // For accessibility\r\n  closeButton.title = t.progressBarClose; // Tooltip\r\n\r\n  // Add click event listener to cancel the tour\r\n  closeButton.addEventListener('click', () => {\r\n    tour.cancel(); // Or tour.complete() if you prefer that\r\n  });\r\n\r\n  // Append the inner progress bar AND the close button to the container\r\n  progressContainer.appendChild(progressInner); // First the bar\r\n  progressContainer.appendChild(closeButton); // Then the button next to it (thanks to flexbox)\r\n\r\n  // Append the whole container to the body\r\n  document.body.appendChild(progressContainer);\r\n\r\n  // Update progress bar when step changes - minimalist with no text\r\n  function updateProgress(): void {\r\n    const currentStep = tour.getCurrentStep();\r\n    if (!currentStep) return;\r\n\r\n    const stepIndex = tour.steps.indexOf(currentStep);\r\n    const totalSteps = tour.steps.length;\r\n    // Small adjustment for better progression: start at 0% for the first step\r\n    const progress = totalSteps > 1 ? Math.round((stepIndex / (totalSteps - 1)) * 100) : 100;\r\n\r\n    const fill = progressContainer.querySelector('.progress-fill') as HTMLElement;\r\n    // Make sure fill exists before adjusting style\r\n    if (fill) {\r\n      fill.style.width = `${progress}%`;\r\n    }\r\n  }\r\n\r\n  // Add event listeners for progress updates\r\n  tour.on('show', updateProgress);\r\n\r\n  // Initial update\r\n  updateProgress();\r\n}\r\n\r\nexport function endTour(): void {\r\n  localStorage.setItem('heerlen-tour-completed', 'true');\r\n  \r\n  // Clean up tour resources\r\n  if (window.tourCleanup) {\r\n    window.tourCleanup();\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up all tour resources to prevent memory leaks\r\n */\r\nexport function cleanupTour(): void {\r\n  // Clear all intervals\r\n  tourIntervals.forEach(id => clearInterval(id));\r\n  tourIntervals.clear();\r\n  \r\n  // Clear all timeouts\r\n  tourTimeouts.forEach(id => clearTimeout(id));  \r\n  tourTimeouts.clear();\r\n  \r\n  // Remove all event listeners\r\n  tourEventListeners.forEach(({element, event, handler}) => {\r\n    element.removeEventListener(event, handler);\r\n  });\r\n  tourEventListeners.length = 0;\r\n  \r\n  // Clear global tour variables\r\n  if (window.markerClickFallbackTimer) {\r\n    clearTimeout(window.markerClickFallbackTimer);\r\n    delete window.markerClickFallbackTimer;\r\n  }\r\n  \r\n  if (window.activeTour) {\r\n    try {\r\n      window.activeTour.cancel();\r\n    } catch (e) {\r\n      // Tour might already be cleaned up\r\n    }\r\n    delete window.activeTour;\r\n  }\r\n  \r\n  delete window.tourWaitingForMarkerClick;\r\n  delete window.markerClickListener;\r\n  delete window.tourCleanup;\r\n}\r\n\r\n// Set global cleanup function\r\nwindow.tourCleanup = cleanupTour;"],
  "mappings": "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",
  "names": ["state", "detectLanguage", "gradient", "animateGradient", "createPopupContent", "html", "detectLanguage", "location", "state", "popup", "setupPopupInteractions", "popupTranslations", "state", "state", "state", "category", "state", "center", "t", "state", "state", "mapboxgl", "detectLanguage", "cleanupTour", "location", "state"]
}
